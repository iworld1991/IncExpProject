{smcl}
{com}{sf}{ul off}{txt}{.-}
      name:  {res}<unnamed>
       {txt}log:  {res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/indSCE_Maro_log.smcl
  {txt}log type:  {res}smcl
 {txt}opened on:  {res}30 Apr 2020, 18:26:06
{txt}
{com}. 
. use "${c -(}folder{c )-}/SCE/IncExpSCEIndMacroM.dta"
{txt}
{com}. 
. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. clear

. 
. 
. import excel "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData/laus.xlsx", sheet("Sheet1") firstrow
{res}
{com}. gen month_new = .
{txt}(26622 missing values generated)

{com}. replace month_new =1 if month=="Jan"
{txt}(2244 real changes made)

{com}. replace month_new = 2 if month =="Feb"
{txt}(2244 real changes made)

{com}. replace month_new = 3 if month=="Mar"
{txt}(2244 real changes made)

{com}. replace month_new = 4 if month=="Apr"
{txt}(2244 real changes made)

{com}. replace month_new = 5 if month == "May"
{txt}(2244 real changes made)

{com}. replace month_new = 6 if month =="Jun"
{txt}(2244 real changes made)

{com}. replace month_new = 7 if month=="Jul"
{txt}(2193 real changes made)

{com}. replace month_new = 8 if month =="Aug"
{txt}(2193 real changes made)

{com}. replace month_new = 9 if month=="Sep"
{txt}(2193 real changes made)

{com}. replace month_new =10 if month=="Oct"
{txt}(2193 real changes made)

{com}. replace month_new = 11 if month =="Nov"
{txt}(2193 real changes made)

{com}. replace month_new = 12 if month =="Dec"
{txt}(2193 real changes made)

{com}. drop month

. rename month_new month
{res}
{com}. order state year month

. save stateM.dta,replace
{txt}(note: file stateM.dta not found)
file stateM.dta saved

{com}. do "/var/folders/k3/fzq0vzzx2b56ypvhsddgs7hr0000gn/T//SD02567.000000"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{txt}
{com}. label var Q41 "years of living in the current residence"
{txt}
{com}. label var Q42 "years of living in the current states"
{txt}
{com}. label var Q43 "own/rent/other a house(1/2/3)"
{txt}
{com}. label var Q43a "my/spounser/both's name under which current residence is owned/rent"
{txt}
{com}. label var Q44 "own other homes(1/0)"
{txt}
{com}. label var Q45b "health condition(1-5 from good to poor)"
{txt}
{com}. label var Q45new_1 ""
{txt}
{com}. label var Q45new_2 ""
{txt}
{com}. label var Q45new_3 ""
{txt}
{com}. label var Q45new_4 ""
{txt}
{com}. label var Q45new_5 ""
{txt}
{com}. label var Q45new_6 ""
{txt}
{com}. label var Q45new_7 ""
{txt}
{com}. label var Q45new_8 ""
{txt}
{com}. label var Q45new_9 ""
{txt}
{com}. label var Q46 "financial decision making of household(1-5, together to individual)"
{txt}
{com}. label var Q47 "total pre-tax household income from y-1 to y(1-11, low to high)"
{txt}
{com}. label var D1 "same household as last year(1/0)"
{txt}
{com}. label var D3 "date of moving to the current residence(month/year)"
{txt}
{com}. label var D6 "total pre-tax household income from y-1 to y(1-11,low to high)"
{txt}
{com}. label var D2new_1 "memeber in the current resident:spounse/partner"
{txt}
{com}. label var D2new_2 "memeber in the current resident: child >25"
{txt}
{com}. label var D2new_3 "memeber in the current resident: child 18-24"
{txt}
{com}. label var D2new_4 "memeber in the current resident: child 6-17"
{txt}
{com}. label var D2new_5 "memeber in the current resident: child <=5 "
{txt}
{com}. label var D2new_6 "memeber in the current resident: own/sponse's parents"
{txt}
{com}. label var D2new_7 "memeber in the current resident:other relatives"
{txt}
{com}. label var D2new_8 "memeber in the current resident:non-relatives"
{txt}
{com}. label var DSAME "same job as last year in survey"
{txt}
{com}. label var DQ38 "living as a partner or married with some one(1/0)"
{txt}
{com}. label var Q48 "interesting/uninteresting of the questions in the survey(1/0)"
{txt}
{com}. 
. 
. ** Only keep useful variables so that the data file is smaller. 
. 
. global keeplist date year month userid tenure weight ///        
>        Q24_cent25 Q24_cent50 Q24_cent75 Q24_var Q24_mean Q24_iqr ///
>            Q24_bin1 Q24_bin2 Q24_bin3 Q24_bin4 Q24_bin5 Q24_bin6 Q24_bin7 Q24_bin8 Q24_bin9 Q24_bin10 ///
>            Q32 Q33 Q34 Q35_1 Q35_2 Q35_3 Q35_4 Q35_5 Q35_6 Q36 Q37 Q38 ///
>            HH2_1 HH2_2 HH2_3 HH2_4 HH2_5 HH2_6 HH2_7 HH2_8 HH2_9 HH2_10 HH2_11 ///
>            _STATE Q41 Q42 Q43 Q43a Q44 Q45b ///
>            Q45new_1 Q45new_2 Q45new_3 Q45new_4 Q45new_5 Q45new_6 Q45new_7 Q45new_8 Q45new_9 ///
>            Q46 Q47 D1 D3 D6 D2new_1 D2new_2 D2new_3 D2new_4 D2new_5 D2new_6 D2new_7 D2new_8 D2newdk_1 DSAME DQ38 ///
>            DHH2_1 DHH2_2 DHH2_3 DHH2_4 DHH2_5 DHH2_6 DHH2_7 DHH2_8 DHH2_9 DHH2_10 DHH2_11 DHH2_11_other D5b Q48 QRA1 QRA2 ///
>            _AGE_CAT _NUM_CAT _REGION_CAT _COMMUTING_ZONE _EDU_CAT _HH_INC_CAT ///
>            Q1 Q2 Q3 Q4new Q5new Q6new Q9_mean Q9_var ///
>            Q10_1 Q10_2 Q10_3 Q10_4 Q10_5 Q10_6 Q10_7 Q10_8 Q10_9 Q10_10 Q11 Q12new Q13new Q14new ///
>            Q25v2 Q25v2part2 Q31v2 Q31v2part2 C1_mean C1_var ///
>            Q26v2 Q26v2part2
{txt}
{com}.  
. keep ${c -(}keeplist{c )-}
{txt}
{com}. 
. 
. *************************
. *** Merge with state level 
. *************************
. 
. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. table _STATE

{txt}{hline 10}{c TT}{hline 11}
state     {c |}
(2-digit  {c |}
code)     {c |}      Freq.
{hline 10}{c +}{hline 11}
       AK {c |}        {res}112
       {txt}AL {c |}      {res}1,222
       {txt}AR {c |}        {res}888
       {txt}AZ {c |}      {res}2,294
       {txt}CA {c |}      {res}8,962
       {txt}CO {c |}      {res}1,954
       {txt}CT {c |}      {res}1,177
       {txt}DC {c |}        {res}286
       {txt}DE {c |}        {res}241
       {txt}FL {c |}      {res}5,981
       {txt}GA {c |}      {res}2,400
       {txt}HI {c |}        {res}293
       {txt}IA {c |}      {res}1,062
       {txt}ID {c |}        {res}653
       {txt}IL {c |}      {res}4,080
       {txt}IN {c |}      {res}1,756
       {txt}KS {c |}        {res}862
       {txt}KY {c |}      {res}1,244
       {txt}LA {c |}      {res}1,013
       {txt}MA {c |}      {res}2,108
       {txt}MD {c |}      {res}1,702
       {txt}ME {c |}        {res}691
       {txt}MI {c |}      {res}3,421
       {txt}MN {c |}      {res}2,378
       {txt}MO {c |}      {res}1,937
       {txt}MS {c |}        {res}600
       {txt}MT {c |}        {res}311
       {txt}NC {c |}      {res}2,920
       {txt}ND {c |}        {res}272
       {txt}NE {c |}        {res}628
       {txt}NH {c |}        {res}528
       {txt}NJ {c |}      {res}3,266
       {txt}NM {c |}        {res}459
       {txt}NV {c |}        {res}774
       {txt}NY {c |}      {res}5,585
       {txt}OH {c |}      {res}3,872
       {txt}OK {c |}        {res}960
       {txt}OR {c |}      {res}1,712
       {txt}PA {c |}      {res}5,245
       {txt}RI {c |}        {res}260
       {txt}SC {c |}      {res}1,185
       {txt}SD {c |}        {res}247
       {txt}TN {c |}      {res}1,827
       {txt}TX {c |}      {res}6,767
       {txt}UT {c |}        {res}817
       {txt}VA {c |}      {res}2,356
       {txt}VT {c |}        {res}188
       {txt}WA {c |}      {res}2,706
       {txt}WI {c |}      {res}2,102
       {txt}WV {c |}        {res}382
       {txt}WY {c |}        {res}173
{txt}{hline 10}{c BT}{hline 11}

{com}. clear

. 
. import excel "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData/data_quarter.xlsx", sheet("Sheet1") firstrow
{res}
{com}. help expand

. expand 3
{txt}(14076 observations created)

{com}. sort state year quarter

. gen month = .
{txt}(21114 missing values generated)

{com}. drop month 

. bysort state year quarter: gen month =_n

. drop month 

. bysort state year quarter: gen month =(quarter-1)*3+_n

. sort state year quarter month 

. order state statecode year quarter month

. save stateQ.dta,replace
{txt}(note: file stateQ.dta not found)
file stateQ.dta saved

{com}. do "/var/folders/k3/fzq0vzzx2b56ypvhsddgs7hr0000gn/T//SD02567.000000"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. set more off 
{txt}
{com}. 
. clear
{txt}
{com}. import excel "${c -(}folder{c )-}laus.xlsx", sheet("Sheet1") firstrow
{res}{txt}
{com}. gen month_new = .
{txt}(26622 missing values generated)

{com}. replace month_new =1 if month=="Jan"
{txt}(2244 real changes made)

{com}. replace month_new = 2 if month =="Feb"
{txt}(2244 real changes made)

{com}. replace month_new = 3 if month=="Mar"
{txt}(2244 real changes made)

{com}. replace month_new = 4 if month=="Apr"
{txt}(2244 real changes made)

{com}. replace month_new = 5 if month == "May"
{txt}(2244 real changes made)

{com}. replace month_new = 6 if month =="Jun"
{txt}(2244 real changes made)

{com}. replace month_new = 7 if month=="Jul"
{txt}(2193 real changes made)

{com}. replace month_new = 8 if month =="Aug"
{txt}(2193 real changes made)

{com}. replace month_new = 9 if month=="Sep"
{txt}(2193 real changes made)

{com}. replace month_new =10 if month=="Oct"
{txt}(2193 real changes made)

{com}. replace month_new = 11 if month =="Nov"
{txt}(2193 real changes made)

{com}. replace month_new = 12 if month =="Dec"
{txt}(2193 real changes made)

{com}. drop month
{txt}
{com}. rename month_new month
{res}{txt}
{com}. order state year month
{txt}
{com}. save stateM.dta,replace
{txt}(note: file stateM.dta not found)
file stateM.dta saved

{com}. 
. import excel "${c -(}folder{c )-}data_quarter.xlsx", sheet("Sheet1") firstrow,clear
{err}invalid 'clear' 
{txt}{search r(198):r(198);}

end of do-file

{search r(198):r(198);}

{com}. do "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/DoFile/Step00_PrepareStateData.do"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. set more off 
{txt}
{com}. 
. /*
> import excel "${c -(}folder{c )-}laus.xlsx", sheet("Sheet1") firstrow clear
> 
> gen month_new = .
> replace month_new =1 if month=="Jan"
> replace month_new = 2 if month =="Feb"
> replace month_new = 3 if month=="Mar"
> replace month_new = 4 if month=="Apr"
> replace month_new = 5 if month == "May"
> replace month_new = 6 if month =="Jun"
> replace month_new = 7 if month=="Jul"
> replace month_new = 8 if month =="Aug"
> replace month_new = 9 if month=="Sep"
> replace month_new =10 if month=="Oct"
> replace month_new = 11 if month =="Nov"
> replace month_new = 12 if month =="Dec"
> drop month
> rename month_new month
> order state year month
> save stateM.dta,replace
> */
. 
. 
. import excel "${c -(}folder{c )-}data_quarter.xlsx", sheet("Sheet1") firstrow clear
{res}{txt}
{com}. 
. expand 3
{txt}(14076 observations created)

{com}. sort state year quarter
{txt}
{com}. bysort state year quarter: gen month =(quarter-1)*3+_n
{txt}
{com}. order state statecode year quarter month
{txt}
{com}. save stateQ.dta,replace
{txt}(note: file stateQ.dta not found)
file stateQ.dta saved

{com}. 
. 
. use stateQ.dta,replace 
{txt}
{com}. merge 1:1 state year month using "${c -(}folder{c )-}stateM.dta", keep(master using) 
{res}{txt}{p 0 7 2}
(note: variable
state was 
str2, now str20 to accommodate using data's values)
{p_end}

{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}          47,736
{txt}{col 9}from master{col 30}{res}          21,114{txt}  (_merge==1)
{col 9}from using{col 30}{res}          26,622{txt}  (_merge==2)

{col 5}matched{col 30}{res}               0{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename _merge state_merge
{res}{txt}
{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/var/folders/k3/fzq0vzzx2b56ypvhsddgs7hr0000gn/T//SD02567.000000"
{txt}
{com}. 
. save stateM,replace 
{txt}file stateM.dta saved

{com}. rm "stateQ.dta"
{txt}
{com}. 
{txt}end of do-file

{com}. do "/var/folders/k3/fzq0vzzx2b56ypvhsddgs7hr0000gn/T//SD02567.000000"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. rename _STATE state 
{res}{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{err}variable _STATE not found
{txt}{search r(111):r(111);}

end of do-file

{search r(111):r(111);}

{com}. do "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/DoFile/Step01_CleaningSCE.do"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{txt}
{com}. label var Q41 "years of living in the current residence"
{txt}
{com}. label var Q42 "years of living in the current states"
{txt}
{com}. label var Q43 "own/rent/other a house(1/2/3)"
{txt}
{com}. label var Q43a "my/spounser/both's name under which current residence is owned/rent"
{txt}
{com}. label var Q44 "own other homes(1/0)"
{txt}
{com}. label var Q45b "health condition(1-5 from good to poor)"
{txt}
{com}. label var Q45new_1 ""
{txt}
{com}. label var Q45new_2 ""
{txt}
{com}. label var Q45new_3 ""
{txt}
{com}. label var Q45new_4 ""
{txt}
{com}. label var Q45new_5 ""
{txt}
{com}. label var Q45new_6 ""
{txt}
{com}. label var Q45new_7 ""
{txt}
{com}. label var Q45new_8 ""
{txt}
{com}. label var Q45new_9 ""
{txt}
{com}. label var Q46 "financial decision making of household(1-5, together to individual)"
{txt}
{com}. label var Q47 "total pre-tax household income from y-1 to y(1-11, low to high)"
{txt}
{com}. label var D1 "same household as last year(1/0)"
{txt}
{com}. label var D3 "date of moving to the current residence(month/year)"
{txt}
{com}. label var D6 "total pre-tax household income from y-1 to y(1-11,low to high)"
{txt}
{com}. label var D2new_1 "memeber in the current resident:spounse/partner"
{txt}
{com}. label var D2new_2 "memeber in the current resident: child >25"
{txt}
{com}. label var D2new_3 "memeber in the current resident: child 18-24"
{txt}
{com}. label var D2new_4 "memeber in the current resident: child 6-17"
{txt}
{com}. label var D2new_5 "memeber in the current resident: child <=5 "
{txt}
{com}. label var D2new_6 "memeber in the current resident: own/sponse's parents"
{txt}
{com}. label var D2new_7 "memeber in the current resident:other relatives"
{txt}
{com}. label var D2new_8 "memeber in the current resident:non-relatives"
{txt}
{com}. label var DSAME "same job as last year in survey"
{txt}
{com}. label var DQ38 "living as a partner or married with some one(1/0)"
{txt}
{com}. label var Q48 "interesting/uninteresting of the questions in the survey(1/0)"
{txt}
{com}. 
. 
. ** Only keep useful variables so that the data file is smaller. 
. 
. global keeplist date year month userid tenure weight ///        
>        Q24_cent25 Q24_cent50 Q24_cent75 Q24_var Q24_mean Q24_iqr ///
>            Q24_bin1 Q24_bin2 Q24_bin3 Q24_bin4 Q24_bin5 Q24_bin6 Q24_bin7 Q24_bin8 Q24_bin9 Q24_bin10 ///
>            Q32 Q33 Q34 Q35_1 Q35_2 Q35_3 Q35_4 Q35_5 Q35_6 Q36 Q37 Q38 ///
>            HH2_1 HH2_2 HH2_3 HH2_4 HH2_5 HH2_6 HH2_7 HH2_8 HH2_9 HH2_10 HH2_11 ///
>            _STATE Q41 Q42 Q43 Q43a Q44 Q45b ///
>            Q45new_1 Q45new_2 Q45new_3 Q45new_4 Q45new_5 Q45new_6 Q45new_7 Q45new_8 Q45new_9 ///
>            Q46 Q47 D1 D3 D6 D2new_1 D2new_2 D2new_3 D2new_4 D2new_5 D2new_6 D2new_7 D2new_8 D2newdk_1 DSAME DQ38 ///
>            DHH2_1 DHH2_2 DHH2_3 DHH2_4 DHH2_5 DHH2_6 DHH2_7 DHH2_8 DHH2_9 DHH2_10 DHH2_11 DHH2_11_other D5b Q48 QRA1 QRA2 ///
>            _AGE_CAT _NUM_CAT _REGION_CAT _COMMUTING_ZONE _EDU_CAT _HH_INC_CAT ///
>            Q1 Q2 Q3 Q4new Q5new Q6new Q9_mean Q9_var ///
>            Q10_1 Q10_2 Q10_3 Q10_4 Q10_5 Q10_6 Q10_7 Q10_8 Q10_9 Q10_10 Q11 Q12new Q13new Q14new ///
>            Q25v2 Q25v2part2 Q31v2 Q31v2part2 C1_mean C1_var ///
>            Q26v2 Q26v2part2
{txt}
{com}.  
. keep ${c -(}keeplist{c )-}
{txt}
{com}. 
. 
. *************************
. *** Merge with state level 
. *************************
. 
. rename _STATE state 
{res}{txt}
{com}. 
. merge 1:1 state year month using "${c -(}otherdata{c )-}stateM.dta",keep(master)
{res}{err}{p 0 4 2}
variable{err}s{err} state
year
month
do not uniquely identify observations in the
master data
{p_end}
{txt}{search r(459):r(459);}

end of do-file

{search r(459):r(459);}

{com}. do "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/DoFile/Step01_CleaningSCE.do"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{txt}
{com}. label var Q41 "years of living in the current residence"
{txt}
{com}. label var Q42 "years of living in the current states"
{txt}
{com}. label var Q43 "own/rent/other a house(1/2/3)"
{txt}
{com}. label var Q43a "my/spounser/both's name under which current residence is owned/rent"
{txt}
{com}. label var Q44 "own other homes(1/0)"
{txt}
{com}. label var Q45b "health condition(1-5 from good to poor)"
{txt}
{com}. label var Q45new_1 ""
{txt}
{com}. label var Q45new_2 ""
{txt}
{com}. label var Q45new_3 ""
{txt}
{com}. label var Q45new_4 ""
{txt}
{com}. label var Q45new_5 ""
{txt}
{com}. label var Q45new_6 ""
{txt}
{com}. label var Q45new_7 ""
{txt}
{com}. label var Q45new_8 ""
{txt}
{com}. label var Q45new_9 ""
{txt}
{com}. label var Q46 "financial decision making of household(1-5, together to individual)"
{txt}
{com}. label var Q47 "total pre-tax household income from y-1 to y(1-11, low to high)"
{txt}
{com}. label var D1 "same household as last year(1/0)"
{txt}
{com}. label var D3 "date of moving to the current residence(month/year)"
{txt}
{com}. label var D6 "total pre-tax household income from y-1 to y(1-11,low to high)"
{txt}
{com}. label var D2new_1 "memeber in the current resident:spounse/partner"
{txt}
{com}. label var D2new_2 "memeber in the current resident: child >25"
{txt}
{com}. label var D2new_3 "memeber in the current resident: child 18-24"
{txt}
{com}. label var D2new_4 "memeber in the current resident: child 6-17"
{txt}
{com}. label var D2new_5 "memeber in the current resident: child <=5 "
{txt}
{com}. label var D2new_6 "memeber in the current resident: own/sponse's parents"
{txt}
{com}. label var D2new_7 "memeber in the current resident:other relatives"
{txt}
{com}. label var D2new_8 "memeber in the current resident:non-relatives"
{txt}
{com}. label var DSAME "same job as last year in survey"
{txt}
{com}. label var DQ38 "living as a partner or married with some one(1/0)"
{txt}
{com}. label var Q48 "interesting/uninteresting of the questions in the survey(1/0)"
{txt}
{com}. 
. 
. ** Only keep useful variables so that the data file is smaller. 
. 
. global keeplist date year month userid tenure weight ///        
>        Q24_cent25 Q24_cent50 Q24_cent75 Q24_var Q24_mean Q24_iqr ///
>            Q24_bin1 Q24_bin2 Q24_bin3 Q24_bin4 Q24_bin5 Q24_bin6 Q24_bin7 Q24_bin8 Q24_bin9 Q24_bin10 ///
>            Q32 Q33 Q34 Q35_1 Q35_2 Q35_3 Q35_4 Q35_5 Q35_6 Q36 Q37 Q38 ///
>            HH2_1 HH2_2 HH2_3 HH2_4 HH2_5 HH2_6 HH2_7 HH2_8 HH2_9 HH2_10 HH2_11 ///
>            _STATE Q41 Q42 Q43 Q43a Q44 Q45b ///
>            Q45new_1 Q45new_2 Q45new_3 Q45new_4 Q45new_5 Q45new_6 Q45new_7 Q45new_8 Q45new_9 ///
>            Q46 Q47 D1 D3 D6 D2new_1 D2new_2 D2new_3 D2new_4 D2new_5 D2new_6 D2new_7 D2new_8 D2newdk_1 DSAME DQ38 ///
>            DHH2_1 DHH2_2 DHH2_3 DHH2_4 DHH2_5 DHH2_6 DHH2_7 DHH2_8 DHH2_9 DHH2_10 DHH2_11 DHH2_11_other D5b Q48 QRA1 QRA2 ///
>            _AGE_CAT _NUM_CAT _REGION_CAT _COMMUTING_ZONE _EDU_CAT _HH_INC_CAT ///
>            Q1 Q2 Q3 Q4new Q5new Q6new Q9_mean Q9_var ///
>            Q10_1 Q10_2 Q10_3 Q10_4 Q10_5 Q10_6 Q10_7 Q10_8 Q10_9 Q10_10 Q11 Q12new Q13new Q14new ///
>            Q25v2 Q25v2part2 Q31v2 Q31v2part2 C1_mean C1_var ///
>            Q26v2 Q26v2part2
{txt}
{com}.  
. keep ${c -(}keeplist{c )-}
{txt}
{com}. 
. 
. *************************
. *** Merge with state level 
. *************************
. 
. rename _STATE state 
{res}{txt}
{com}. 
. merge m:1 state year month using "${c -(}otherdata{c )-}stateM.dta",keep(master)
{res}{txt}{p 0 7 2}
(note: variable
state was 
str2, now str20 to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
month was 
byte, now float to accommodate using data's values)
{p_end}

{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}          95,034
{txt}{col 9}from master{col 30}{res}          95,034{txt}  (_merge==1)
{col 9}from using{col 30}{res}               0{txt}  (_merge==2)

{col 5}matched{col 30}{res}               0{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename _merge sce_state_merge 
{res}{txt}
{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. table state

{txt}{hline 10}{c TT}{hline 11}
state     {c |}
(2-digit  {c |}
code)     {c |}      Freq.
{hline 10}{c +}{hline 11}
       AK {c |}        {res}112
       {txt}AL {c |}      {res}1,222
       {txt}AR {c |}        {res}888
       {txt}AZ {c |}      {res}2,294
       {txt}CA {c |}      {res}8,962
       {txt}CO {c |}      {res}1,954
       {txt}CT {c |}      {res}1,177
       {txt}DC {c |}        {res}286
       {txt}DE {c |}        {res}241
       {txt}FL {c |}      {res}5,981
       {txt}GA {c |}      {res}2,400
       {txt}HI {c |}        {res}293
       {txt}IA {c |}      {res}1,062
       {txt}ID {c |}        {res}653
       {txt}IL {c |}      {res}4,080
       {txt}IN {c |}      {res}1,756
       {txt}KS {c |}        {res}862
       {txt}KY {c |}      {res}1,244
       {txt}LA {c |}      {res}1,013
       {txt}MA {c |}      {res}2,108
       {txt}MD {c |}      {res}1,702
       {txt}ME {c |}        {res}691
       {txt}MI {c |}      {res}3,421
       {txt}MN {c |}      {res}2,378
       {txt}MO {c |}      {res}1,937
       {txt}MS {c |}        {res}600
       {txt}MT {c |}        {res}311
       {txt}NC {c |}      {res}2,920
       {txt}ND {c |}        {res}272
       {txt}NE {c |}        {res}628
       {txt}NH {c |}        {res}528
       {txt}NJ {c |}      {res}3,266
       {txt}NM {c |}        {res}459
       {txt}NV {c |}        {res}774
       {txt}NY {c |}      {res}5,585
       {txt}OH {c |}      {res}3,872
       {txt}OK {c |}        {res}960
       {txt}OR {c |}      {res}1,712
       {txt}PA {c |}      {res}5,245
       {txt}RI {c |}        {res}260
       {txt}SC {c |}      {res}1,185
       {txt}SD {c |}        {res}247
       {txt}TN {c |}      {res}1,827
       {txt}TX {c |}      {res}6,767
       {txt}UT {c |}        {res}817
       {txt}VA {c |}      {res}2,356
       {txt}VT {c |}        {res}188
       {txt}WA {c |}      {res}2,706
       {txt}WI {c |}      {res}2,102
       {txt}WV {c |}        {res}382
       {txt}WY {c |}        {res}173
{txt}{hline 10}{c BT}{hline 11}

{com}. do "/var/folders/k3/fzq0vzzx2b56ypvhsddgs7hr0000gn/T//SD02567.000000"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{txt}
{com}. label var Q41 "years of living in the current residence"
{txt}
{com}. label var Q42 "years of living in the current states"
{txt}
{com}. label var Q43 "own/rent/other a house(1/2/3)"
{txt}
{com}. label var Q43a "my/spounser/both's name under which current residence is owned/rent"
{txt}
{com}. label var Q44 "own other homes(1/0)"
{txt}
{com}. label var Q45b "health condition(1-5 from good to poor)"
{txt}
{com}. label var Q45new_1 ""
{txt}
{com}. label var Q45new_2 ""
{txt}
{com}. label var Q45new_3 ""
{txt}
{com}. label var Q45new_4 ""
{txt}
{com}. label var Q45new_5 ""
{txt}
{com}. label var Q45new_6 ""
{txt}
{com}. label var Q45new_7 ""
{txt}
{com}. label var Q45new_8 ""
{txt}
{com}. label var Q45new_9 ""
{txt}
{com}. label var Q46 "financial decision making of household(1-5, together to individual)"
{txt}
{com}. label var Q47 "total pre-tax household income from y-1 to y(1-11, low to high)"
{txt}
{com}. label var D1 "same household as last year(1/0)"
{txt}
{com}. label var D3 "date of moving to the current residence(month/year)"
{txt}
{com}. label var D6 "total pre-tax household income from y-1 to y(1-11,low to high)"
{txt}
{com}. label var D2new_1 "memeber in the current resident:spounse/partner"
{txt}
{com}. label var D2new_2 "memeber in the current resident: child >25"
{txt}
{com}. label var D2new_3 "memeber in the current resident: child 18-24"
{txt}
{com}. label var D2new_4 "memeber in the current resident: child 6-17"
{txt}
{com}. label var D2new_5 "memeber in the current resident: child <=5 "
{txt}
{com}. label var D2new_6 "memeber in the current resident: own/sponse's parents"
{txt}
{com}. label var D2new_7 "memeber in the current resident:other relatives"
{txt}
{com}. label var D2new_8 "memeber in the current resident:non-relatives"
{txt}
{com}. label var DSAME "same job as last year in survey"
{txt}
{com}. label var DQ38 "living as a partner or married with some one(1/0)"
{txt}
{com}. label var Q48 "interesting/uninteresting of the questions in the survey(1/0)"
{txt}
{com}. 
. 
. ** Only keep useful variables so that the data file is smaller. 
. 
. global keeplist date year month userid tenure weight ///        
>        Q24_cent25 Q24_cent50 Q24_cent75 Q24_var Q24_mean Q24_iqr ///
>            Q24_bin1 Q24_bin2 Q24_bin3 Q24_bin4 Q24_bin5 Q24_bin6 Q24_bin7 Q24_bin8 Q24_bin9 Q24_bin10 ///
>            Q32 Q33 Q34 Q35_1 Q35_2 Q35_3 Q35_4 Q35_5 Q35_6 Q36 Q37 Q38 ///
>            HH2_1 HH2_2 HH2_3 HH2_4 HH2_5 HH2_6 HH2_7 HH2_8 HH2_9 HH2_10 HH2_11 ///
>            _STATE Q41 Q42 Q43 Q43a Q44 Q45b ///
>            Q45new_1 Q45new_2 Q45new_3 Q45new_4 Q45new_5 Q45new_6 Q45new_7 Q45new_8 Q45new_9 ///
>            Q46 Q47 D1 D3 D6 D2new_1 D2new_2 D2new_3 D2new_4 D2new_5 D2new_6 D2new_7 D2new_8 D2newdk_1 DSAME DQ38 ///
>            DHH2_1 DHH2_2 DHH2_3 DHH2_4 DHH2_5 DHH2_6 DHH2_7 DHH2_8 DHH2_9 DHH2_10 DHH2_11 DHH2_11_other D5b Q48 QRA1 QRA2 ///
>            _AGE_CAT _NUM_CAT _REGION_CAT _COMMUTING_ZONE _EDU_CAT _HH_INC_CAT ///
>            Q1 Q2 Q3 Q4new Q5new Q6new Q9_mean Q9_var ///
>            Q10_1 Q10_2 Q10_3 Q10_4 Q10_5 Q10_6 Q10_7 Q10_8 Q10_9 Q10_10 Q11 Q12new Q13new Q14new ///
>            Q25v2 Q25v2part2 Q31v2 Q31v2part2 C1_mean C1_var ///
>            Q26v2 Q26v2part2
{txt}
{com}.  
. keep ${c -(}keeplist{c )-}
{txt}
{com}. 
. 
. *************************
. *** Merge with state level 
. *************************
. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. count state
{err}varlist not allowed
{txt}{search r(101):r(101);}

{com}. count if _STATE
{err}type mismatch
{txt}{search r(109):r(109);}

{com}. count if _STATE!=.
{err}type mismatch
{txt}{search r(109):r(109);}

{com}. count if _STATE!=""
{res}94859

{com}. count if _STATE==""
{res}  175

{com}. table _STATE

{txt}{hline 10}{c TT}{hline 11}
state     {c |}
(2-digit  {c |}
code)     {c |}      Freq.
{hline 10}{c +}{hline 11}
       AK {c |}        {res}112
       {txt}AL {c |}      {res}1,222
       {txt}AR {c |}        {res}888
       {txt}AZ {c |}      {res}2,294
       {txt}CA {c |}      {res}8,962
       {txt}CO {c |}      {res}1,954
       {txt}CT {c |}      {res}1,177
       {txt}DC {c |}        {res}286
       {txt}DE {c |}        {res}241
       {txt}FL {c |}      {res}5,981
       {txt}GA {c |}      {res}2,400
       {txt}HI {c |}        {res}293
       {txt}IA {c |}      {res}1,062
       {txt}ID {c |}        {res}653
       {txt}IL {c |}      {res}4,080
       {txt}IN {c |}      {res}1,756
       {txt}KS {c |}        {res}862
       {txt}KY {c |}      {res}1,244
       {txt}LA {c |}      {res}1,013
       {txt}MA {c |}      {res}2,108
       {txt}MD {c |}      {res}1,702
       {txt}ME {c |}        {res}691
       {txt}MI {c |}      {res}3,421
       {txt}MN {c |}      {res}2,378
       {txt}MO {c |}      {res}1,937
       {txt}MS {c |}        {res}600
       {txt}MT {c |}        {res}311
       {txt}NC {c |}      {res}2,920
       {txt}ND {c |}        {res}272
       {txt}NE {c |}        {res}628
       {txt}NH {c |}        {res}528
       {txt}NJ {c |}      {res}3,266
       {txt}NM {c |}        {res}459
       {txt}NV {c |}        {res}774
       {txt}NY {c |}      {res}5,585
       {txt}OH {c |}      {res}3,872
       {txt}OK {c |}        {res}960
       {txt}OR {c |}      {res}1,712
       {txt}PA {c |}      {res}5,245
       {txt}RI {c |}        {res}260
       {txt}SC {c |}      {res}1,185
       {txt}SD {c |}        {res}247
       {txt}TN {c |}      {res}1,827
       {txt}TX {c |}      {res}6,767
       {txt}UT {c |}        {res}817
       {txt}VA {c |}      {res}2,356
       {txt}VT {c |}        {res}188
       {txt}WA {c |}      {res}2,706
       {txt}WI {c |}      {res}2,102
       {txt}WV {c |}        {res}382
       {txt}WY {c |}        {res}173
{txt}{hline 10}{c BT}{hline 11}

{com}. describe _STATE

              {txt}storage   display    value
variable name   type    format     label      variable label
{hline}
{p 0 48}{res}{bind:_STATE         }{txt}{bind: str2    }{bind:{txt}%9s       }{space 1}{bind:         }{bind:  }{res}{res}state (2-digit code){p_end}

{com}. clear

. use "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData/stateM.dta"

. table state

{txt}{hline 21}{c TT}{hline 11}
               state {c |}      Freq.
{hline 21}{c +}{hline 11}
                  AK {c |}        {res}414
                  {txt}AL {c |}        {res}414
                  {txt}AR {c |}        {res}414
                  {txt}AZ {c |}        {res}414
             {txt}Alabama {c |}        {res}522
              {txt}Alaska {c |}        {res}522
             {txt}Arizona {c |}        {res}522
            {txt}Arkansas {c |}        {res}522
                  {txt}CA {c |}        {res}414
                  {txt}CO {c |}        {res}414
                  {txt}CT {c |}        {res}414
          {txt}California {c |}        {res}522
            {txt}Colorado {c |}        {res}522
         {txt}Connecticut {c |}        {res}522
                  {txt}DC {c |}        {res}414
                  {txt}DE {c |}        {res}414
            {txt}Delaware {c |}        {res}522
{txt}District of Columbia {c |}        {res}522
                  {txt}FL {c |}        {res}414
             {txt}Florida {c |}        {res}522
                  {txt}GA {c |}        {res}414
             {txt}Georgia {c |}        {res}522
                  {txt}HI {c |}        {res}414
              {txt}Hawaii {c |}        {res}522
                  {txt}IA {c |}        {res}414
                  {txt}ID {c |}        {res}414
                  {txt}IL {c |}        {res}414
                  {txt}IN {c |}        {res}414
               {txt}Idaho {c |}        {res}522
            {txt}Illinois {c |}        {res}522
             {txt}Indiana {c |}        {res}522
                {txt}Iowa {c |}        {res}522
                  {txt}KS {c |}        {res}414
                  {txt}KY {c |}        {res}414
              {txt}Kansas {c |}        {res}522
            {txt}Kentucky {c |}        {res}522
                  {txt}LA {c |}        {res}414
           {txt}Louisiana {c |}        {res}522
                  {txt}MA {c |}        {res}414
                  {txt}MD {c |}        {res}414
                  {txt}ME {c |}        {res}414
                  {txt}MI {c |}        {res}414
                  {txt}MN {c |}        {res}414
                  {txt}MO {c |}        {res}414
                  {txt}MS {c |}        {res}414
                  {txt}MT {c |}        {res}414
               {txt}Maine {c |}        {res}522
            {txt}Maryland {c |}        {res}522
       {txt}Massachusetts {c |}        {res}522
            {txt}Michigan {c |}        {res}522
           {txt}Minnesota {c |}        {res}522
         {txt}Mississippi {c |}        {res}522
            {txt}Missouri {c |}        {res}522
             {txt}Montana {c |}        {res}522
                  {txt}NC {c |}        {res}414
                  {txt}ND {c |}        {res}414
                  {txt}NE {c |}        {res}414
                  {txt}NH {c |}        {res}414
                  {txt}NJ {c |}        {res}414
                  {txt}NM {c |}        {res}414
                  {txt}NV {c |}        {res}414
                  {txt}NY {c |}        {res}414
            {txt}Nebraska {c |}        {res}522
              {txt}Nevada {c |}        {res}522
       {txt}New Hampshire {c |}        {res}522
          {txt}New Jersey {c |}        {res}522
          {txt}New Mexico {c |}        {res}522
            {txt}New York {c |}        {res}522
      {txt}North Carolina {c |}        {res}522
        {txt}North Dakota {c |}        {res}522
                  {txt}OH {c |}        {res}414
                  {txt}OK {c |}        {res}414
                  {txt}OR {c |}        {res}414
                {txt}Ohio {c |}        {res}522
            {txt}Oklahoma {c |}        {res}522
              {txt}Oregon {c |}        {res}522
                  {txt}PA {c |}        {res}414
        {txt}Pennsylvania {c |}        {res}522
                  {txt}RI {c |}        {res}414
        {txt}Rhode Island {c |}        {res}522
                  {txt}SC {c |}        {res}414
                  {txt}SD {c |}        {res}414
      {txt}South Carolina {c |}        {res}522
        {txt}South Dakota {c |}        {res}522
                  {txt}TN {c |}        {res}414
                  {txt}TX {c |}        {res}414
           {txt}Tennessee {c |}        {res}522
               {txt}Texas {c |}        {res}522
                  {txt}UT {c |}        {res}414
                {txt}Utah {c |}        {res}522
                  {txt}VA {c |}        {res}414
                  {txt}VT {c |}        {res}414
             {txt}Vermont {c |}        {res}522
            {txt}Virginia {c |}        {res}522
                  {txt}WA {c |}        {res}414
                  {txt}WI {c |}        {res}414
                  {txt}WV {c |}        {res}414
                  {txt}WY {c |}        {res}414
          {txt}Washington {c |}        {res}522
       {txt}West Virginia {c |}        {res}522
           {txt}Wisconsin {c |}        {res}522
             {txt}Wyoming {c |}        {res}522
{txt}{hline 21}{c BT}{hline 11}

{com}. clear

. do "/var/folders/k3/fzq0vzzx2b56ypvhsddgs7hr0000gn/T//SD02567.000000"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. import excel "${c -(}folder{c )-}laus.xlsx", sheet("Sheet1") firstrow clear
{res}{txt}
{com}. 
. gen month_new = .
{txt}(26622 missing values generated)

{com}. replace month_new =1 if month=="Jan"
{txt}(2244 real changes made)

{com}. replace month_new = 2 if month =="Feb"
{txt}(2244 real changes made)

{com}. replace month_new = 3 if month=="Mar"
{txt}(2244 real changes made)

{com}. replace month_new = 4 if month=="Apr"
{txt}(2244 real changes made)

{com}. replace month_new = 5 if month == "May"
{txt}(2244 real changes made)

{com}. replace month_new = 6 if month =="Jun"
{txt}(2244 real changes made)

{com}. replace month_new = 7 if month=="Jul"
{txt}(2193 real changes made)

{com}. replace month_new = 8 if month =="Aug"
{txt}(2193 real changes made)

{com}. replace month_new = 9 if month=="Sep"
{txt}(2193 real changes made)

{com}. replace month_new =10 if month=="Oct"
{txt}(2193 real changes made)

{com}. replace month_new = 11 if month =="Nov"
{txt}(2193 real changes made)

{com}. replace month_new = 12 if month =="Dec"
{txt}(2193 real changes made)

{com}. drop month
{txt}
{com}. rename month_new month
{res}{txt}
{com}. order state year month
{txt}
{com}. save stateM.dta,replace
{txt}file stateM.dta saved

{com}. */
. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. rename state statename 
{res}
{com}. rename stateabbr state
{res}
{com}. save stateM.dta,replace
{txt}file stateM.dta saved

{com}. 
. do "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/DoFile/Step00_PrepareStateData.do"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. set more off 
{txt}
{com}. 
. /*
> import excel "${c -(}folder{c )-}laus.xlsx", sheet("Sheet1") firstrow clear
> 
> gen month_new = .
> replace month_new =1 if month=="Jan"
> replace month_new = 2 if month =="Feb"
> replace month_new = 3 if month=="Mar"
> replace month_new = 4 if month=="Apr"
> replace month_new = 5 if month == "May"
> replace month_new = 6 if month =="Jun"
> replace month_new = 7 if month=="Jul"
> replace month_new = 8 if month =="Aug"
> replace month_new = 9 if month=="Sep"
> replace month_new =10 if month=="Oct"
> replace month_new = 11 if month =="Nov"
> replace month_new = 12 if month =="Dec"
> drop month
> rename month_new month
> order state year month
> 
> rename state statename 
> rename stateabbr state
> save stateM.dta,replace
> */
. 
. 
. import excel "${c -(}folder{c )-}data_quarter.xlsx", sheet("Sheet1") firstrow clear
{res}{txt}
{com}. 
. expand 3
{txt}(14076 observations created)

{com}. sort state year quarter
{txt}
{com}. bysort state year quarter: gen month =(quarter-1)*3+_n
{txt}
{com}. order state statecode year quarter month
{txt}
{com}. save stateQ.dta,replace
{txt}(note: file stateQ.dta not found)
file stateQ.dta saved

{com}. 
. 
. use stateQ.dta,replace 
{txt}
{com}. merge 1:1 state year month using "${c -(}folder{c )-}stateM.dta", keep(master using) 
{res}
{txt}{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}           5,508
{txt}{col 9}from master{col 30}{res}               0{txt}  (_merge==1)
{col 9}from using{col 30}{res}           5,508{txt}  (_merge==2)

{col 5}matched{col 30}{res}               0{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename _merge state_merge
{res}{txt}
{com}. 
. ******************
. ** date *********
. ******************
. 
. save stateM,replace 
{txt}file stateM.dta saved

{com}. rm "stateQ.dta"
{txt}
{com}. 
{txt}end of do-file

{com}. table state

{txt}{hline 10}{c TT}{hline 11}
    state {c |}      Freq.
{hline 10}{c +}{hline 11}
       AK {c |}        {res}108
       {txt}AL {c |}        {res}108
       {txt}AR {c |}        {res}108
       {txt}AZ {c |}        {res}108
       {txt}CA {c |}        {res}108
       {txt}CO {c |}        {res}108
       {txt}CT {c |}        {res}108
       {txt}DC {c |}        {res}108
       {txt}DE {c |}        {res}108
       {txt}FL {c |}        {res}108
       {txt}GA {c |}        {res}108
       {txt}HI {c |}        {res}108
       {txt}IA {c |}        {res}108
       {txt}ID {c |}        {res}108
       {txt}IL {c |}        {res}108
       {txt}IN {c |}        {res}108
       {txt}KS {c |}        {res}108
       {txt}KY {c |}        {res}108
       {txt}LA {c |}        {res}108
       {txt}MA {c |}        {res}108
       {txt}MD {c |}        {res}108
       {txt}ME {c |}        {res}108
       {txt}MI {c |}        {res}108
       {txt}MN {c |}        {res}108
       {txt}MO {c |}        {res}108
       {txt}MS {c |}        {res}108
       {txt}MT {c |}        {res}108
       {txt}NC {c |}        {res}108
       {txt}ND {c |}        {res}108
       {txt}NE {c |}        {res}108
       {txt}NH {c |}        {res}108
       {txt}NJ {c |}        {res}108
       {txt}NM {c |}        {res}108
       {txt}NV {c |}        {res}108
       {txt}NY {c |}        {res}108
       {txt}OH {c |}        {res}108
       {txt}OK {c |}        {res}108
       {txt}OR {c |}        {res}108
       {txt}PA {c |}        {res}108
       {txt}RI {c |}        {res}108
       {txt}SC {c |}        {res}108
       {txt}SD {c |}        {res}108
       {txt}TN {c |}        {res}108
       {txt}TX {c |}        {res}108
       {txt}UT {c |}        {res}108
       {txt}VA {c |}        {res}108
       {txt}VT {c |}        {res}108
       {txt}WA {c |}        {res}108
       {txt}WI {c |}        {res}108
       {txt}WV {c |}        {res}108
       {txt}WY {c |}        {res}108
{txt}{hline 10}{c BT}{hline 11}

{com}. unique state
{txt}Number of unique values of state is  {res}51
{txt}Number of records is  {res}5508

{com}. table month 

{txt}{hline 10}{c TT}{hline 11}
    month {c |}      Freq.
{hline 10}{c +}{hline 11}
        1 {c |}        {res}459
        {txt}2 {c |}        {res}459
        {txt}3 {c |}        {res}459
        {txt}4 {c |}        {res}459
        {txt}5 {c |}        {res}459
        {txt}6 {c |}        {res}459
        {txt}7 {c |}        {res}459
        {txt}8 {c |}        {res}459
        {txt}9 {c |}        {res}459
       {txt}10 {c |}        {res}459
       {txt}11 {c |}        {res}459
       {txt}12 {c |}        {res}459
{txt}{hline 10}{c BT}{hline 11}

{com}. clear

. do "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/DoFile/Step01_CleaningSCE.do"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{txt}
{com}. label var Q41 "years of living in the current residence"
{txt}
{com}. label var Q42 "years of living in the current states"
{txt}
{com}. label var Q43 "own/rent/other a house(1/2/3)"
{txt}
{com}. label var Q43a "my/spounser/both's name under which current residence is owned/rent"
{txt}
{com}. label var Q44 "own other homes(1/0)"
{txt}
{com}. label var Q45b "health condition(1-5 from good to poor)"
{txt}
{com}. label var Q45new_1 ""
{txt}
{com}. label var Q45new_2 ""
{txt}
{com}. label var Q45new_3 ""
{txt}
{com}. label var Q45new_4 ""
{txt}
{com}. label var Q45new_5 ""
{txt}
{com}. label var Q45new_6 ""
{txt}
{com}. label var Q45new_7 ""
{txt}
{com}. label var Q45new_8 ""
{txt}
{com}. label var Q45new_9 ""
{txt}
{com}. label var Q46 "financial decision making of household(1-5, together to individual)"
{txt}
{com}. label var Q47 "total pre-tax household income from y-1 to y(1-11, low to high)"
{txt}
{com}. label var D1 "same household as last year(1/0)"
{txt}
{com}. label var D3 "date of moving to the current residence(month/year)"
{txt}
{com}. label var D6 "total pre-tax household income from y-1 to y(1-11,low to high)"
{txt}
{com}. label var D2new_1 "memeber in the current resident:spounse/partner"
{txt}
{com}. label var D2new_2 "memeber in the current resident: child >25"
{txt}
{com}. label var D2new_3 "memeber in the current resident: child 18-24"
{txt}
{com}. label var D2new_4 "memeber in the current resident: child 6-17"
{txt}
{com}. label var D2new_5 "memeber in the current resident: child <=5 "
{txt}
{com}. label var D2new_6 "memeber in the current resident: own/sponse's parents"
{txt}
{com}. label var D2new_7 "memeber in the current resident:other relatives"
{txt}
{com}. label var D2new_8 "memeber in the current resident:non-relatives"
{txt}
{com}. label var DSAME "same job as last year in survey"
{txt}
{com}. label var DQ38 "living as a partner or married with some one(1/0)"
{txt}
{com}. label var Q48 "interesting/uninteresting of the questions in the survey(1/0)"
{txt}
{com}. 
. 
. ** Only keep useful variables so that the data file is smaller. 
. 
. global keeplist date year month userid tenure weight ///        
>        Q24_cent25 Q24_cent50 Q24_cent75 Q24_var Q24_mean Q24_iqr ///
>            Q24_bin1 Q24_bin2 Q24_bin3 Q24_bin4 Q24_bin5 Q24_bin6 Q24_bin7 Q24_bin8 Q24_bin9 Q24_bin10 ///
>            Q32 Q33 Q34 Q35_1 Q35_2 Q35_3 Q35_4 Q35_5 Q35_6 Q36 Q37 Q38 ///
>            HH2_1 HH2_2 HH2_3 HH2_4 HH2_5 HH2_6 HH2_7 HH2_8 HH2_9 HH2_10 HH2_11 ///
>            _STATE Q41 Q42 Q43 Q43a Q44 Q45b ///
>            Q45new_1 Q45new_2 Q45new_3 Q45new_4 Q45new_5 Q45new_6 Q45new_7 Q45new_8 Q45new_9 ///
>            Q46 Q47 D1 D3 D6 D2new_1 D2new_2 D2new_3 D2new_4 D2new_5 D2new_6 D2new_7 D2new_8 D2newdk_1 DSAME DQ38 ///
>            DHH2_1 DHH2_2 DHH2_3 DHH2_4 DHH2_5 DHH2_6 DHH2_7 DHH2_8 DHH2_9 DHH2_10 DHH2_11 DHH2_11_other D5b Q48 QRA1 QRA2 ///
>            _AGE_CAT _NUM_CAT _REGION_CAT _COMMUTING_ZONE _EDU_CAT _HH_INC_CAT ///
>            Q1 Q2 Q3 Q4new Q5new Q6new Q9_mean Q9_var ///
>            Q10_1 Q10_2 Q10_3 Q10_4 Q10_5 Q10_6 Q10_7 Q10_8 Q10_9 Q10_10 Q11 Q12new Q13new Q14new ///
>            Q25v2 Q25v2part2 Q31v2 Q31v2part2 C1_mean C1_var ///
>            Q26v2 Q26v2part2
{txt}
{com}.  
. keep ${c -(}keeplist{c )-}
{txt}
{com}. 
. 
. *************************
. *** Merge with state level 
. *************************
. 
. rename _STATE state 
{res}{txt}
{com}. 
. merge m:1 state year month using "${c -(}otherdata{c )-}stateM.dta",keep(master)
{res}{txt}{p 0 7 2}
(note: variable
state was 
str2, now str20 to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
month was 
byte, now float to accommodate using data's values)
{p_end}

{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}          95,034
{txt}{col 9}from master{col 30}{res}          95,034{txt}  (_merge==1)
{col 9}from using{col 30}{res}               0{txt}  (_merge==2)

{col 5}matched{col 30}{res}               0{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename _merge sce_state_merge 
{res}{txt}
{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. use "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData/stateM.dta", clear

. do "/var/folders/k3/fzq0vzzx2b56ypvhsddgs7hr0000gn/T//SD02567.000000"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. import excel "${c -(}folder{c )-}laus.xlsx", sheet("Sheet1") firstrow clear
{res}{txt}
{com}. 
. gen month_new = .
{txt}(26622 missing values generated)

{com}. replace month_new =1 if month=="Jan"
{txt}(2244 real changes made)

{com}. replace month_new = 2 if month =="Feb"
{txt}(2244 real changes made)

{com}. replace month_new = 3 if month=="Mar"
{txt}(2244 real changes made)

{com}. replace month_new = 4 if month=="Apr"
{txt}(2244 real changes made)

{com}. replace month_new = 5 if month == "May"
{txt}(2244 real changes made)

{com}. replace month_new = 6 if month =="Jun"
{txt}(2244 real changes made)

{com}. replace month_new = 7 if month=="Jul"
{txt}(2193 real changes made)

{com}. replace month_new = 8 if month =="Aug"
{txt}(2193 real changes made)

{com}. replace month_new = 9 if month=="Sep"
{txt}(2193 real changes made)

{com}. replace month_new =10 if month=="Oct"
{txt}(2193 real changes made)

{com}. replace month_new = 11 if month =="Nov"
{txt}(2193 real changes made)

{com}. replace month_new = 12 if month =="Dec"
{txt}(2193 real changes made)

{com}. drop month
{txt}
{com}. rename month_new month
{res}{txt}
{com}. order state year month
{txt}
{com}. 
. rename state statename 
{res}{txt}
{com}. rename stateabbr state
{res}{txt}
{com}. save stateM.dta,replace
{txt}file stateM.dta saved

{com}. 
. 
. import excel "${c -(}folder{c )-}data_quarter.xlsx", sheet("Sheet1") firstrow clear
{res}{txt}
{com}. 
. expand 3
{txt}(14076 observations created)

{com}. sort state year quarter
{txt}
{com}. bysort state year quarter: gen month =(quarter-1)*3+_n
{txt}
{com}. order state statecode year quarter month
{txt}
{com}. save stateQ.dta,replace
{txt}(note: file stateQ.dta not found)
file stateQ.dta saved

{com}. 
. use stateQ.dta,replace 
{txt}
{com}. merge 1:1 state year month using "${c -(}folder{c )-}stateM.dta", keep(master using) 
{res}
{txt}{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}           5,508
{txt}{col 9}from master{col 30}{res}               0{txt}  (_merge==1)
{col 9}from using{col 30}{res}           5,508{txt}  (_merge==2)

{col 5}matched{col 30}{res}               0{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename _merge state_merge
{res}{txt}
{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/var/folders/k3/fzq0vzzx2b56ypvhsddgs7hr0000gn/T//SD02567.000000"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. import excel "${c -(}folder{c )-}laus.xlsx", sheet("Sheet1") firstrow clear
{res}{txt}
{com}. 
. gen month_new = .
{txt}(26622 missing values generated)

{com}. replace month_new =1 if month=="Jan"
{txt}(2244 real changes made)

{com}. replace month_new = 2 if month =="Feb"
{txt}(2244 real changes made)

{com}. replace month_new = 3 if month=="Mar"
{txt}(2244 real changes made)

{com}. replace month_new = 4 if month=="Apr"
{txt}(2244 real changes made)

{com}. replace month_new = 5 if month == "May"
{txt}(2244 real changes made)

{com}. replace month_new = 6 if month =="Jun"
{txt}(2244 real changes made)

{com}. replace month_new = 7 if month=="Jul"
{txt}(2193 real changes made)

{com}. replace month_new = 8 if month =="Aug"
{txt}(2193 real changes made)

{com}. replace month_new = 9 if month=="Sep"
{txt}(2193 real changes made)

{com}. replace month_new =10 if month=="Oct"
{txt}(2193 real changes made)

{com}. replace month_new = 11 if month =="Nov"
{txt}(2193 real changes made)

{com}. replace month_new = 12 if month =="Dec"
{txt}(2193 real changes made)

{com}. drop month
{txt}
{com}. rename month_new month
{res}{txt}
{com}. order state year month
{txt}
{com}. 
. rename state statename 
{res}{txt}
{com}. rename stateabbr state
{res}{txt}
{com}. save stateM.dta,replace
{txt}file stateM.dta saved

{com}. 
. 
. import excel "${c -(}folder{c )-}data_quarter.xlsx", sheet("Sheet1") firstrow clear
{res}{txt}
{com}. 
. expand 3
{txt}(14076 observations created)

{com}. sort state year quarter
{txt}
{com}. bysort state year quarter: gen month =(quarter-1)*3+_n
{txt}
{com}. order state statecode year quarter month
{txt}
{com}. save stateQ.dta,replace
{txt}file stateQ.dta saved

{com}. 
. use stateQ.dta,replace 
{txt}
{com}. 
. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. use "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData/stateM.dta"

. merge 1:1 state year month using "stateQ.dta",keep(master using)
{res}
{txt}{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}           5,508
{txt}{col 9}from master{col 30}{res}           5,508{txt}  (_merge==1)
{col 9}from using{col 30}{res}               0{txt}  (_merge==2)

{col 5}matched{col 30}{res}               0{txt}  (_merge==3)
{col 5}{hline 41}

{com}. do "/var/folders/k3/fzq0vzzx2b56ypvhsddgs7hr0000gn/T//SD02567.000000"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. import excel "${c -(}folder{c )-}laus.xlsx", sheet("Sheet1") firstrow clear
{res}{txt}
{com}. 
. gen month_new = .
{txt}(26622 missing values generated)

{com}. replace month_new =1 if month=="Jan"
{txt}(2244 real changes made)

{com}. replace month_new = 2 if month =="Feb"
{txt}(2244 real changes made)

{com}. replace month_new = 3 if month=="Mar"
{txt}(2244 real changes made)

{com}. replace month_new = 4 if month=="Apr"
{txt}(2244 real changes made)

{com}. replace month_new = 5 if month == "May"
{txt}(2244 real changes made)

{com}. replace month_new = 6 if month =="Jun"
{txt}(2244 real changes made)

{com}. replace month_new = 7 if month=="Jul"
{txt}(2193 real changes made)

{com}. replace month_new = 8 if month =="Aug"
{txt}(2193 real changes made)

{com}. replace month_new = 9 if month=="Sep"
{txt}(2193 real changes made)

{com}. replace month_new =10 if month=="Oct"
{txt}(2193 real changes made)

{com}. replace month_new = 11 if month =="Nov"
{txt}(2193 real changes made)

{com}. replace month_new = 12 if month =="Dec"
{txt}(2193 real changes made)

{com}. drop month
{txt}
{com}. rename month_new month
{res}{txt}
{com}. order state year month
{txt}
{com}. 
. rename state statename 
{res}{txt}
{com}. rename stateabbr state
{res}{txt}
{com}. save stateM.dta,replace
{txt}file stateM.dta saved

{com}. 
. 
. import excel "${c -(}folder{c )-}data_quarter.xlsx", sheet("Sheet1") firstrow clear
{res}{txt}
{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. table quarter

{txt}{hline 10}{c TT}{hline 11}
  quarter {c |}      Freq.
{hline 10}{c +}{hline 11}
        1 {c |}      {res}1,785
        {txt}2 {c |}      {res}1,785
        {txt}3 {c |}      {res}1,734
        {txt}4 {c |}      {res}1,734
{txt}{hline 10}{c BT}{hline 11}

{com}. do "/var/folders/k3/fzq0vzzx2b56ypvhsddgs7hr0000gn/T//SD02567.000000"
{txt}
{com}. expand 3
{txt}(14076 observations created)

{com}. sort state year quarter
{txt}
{com}. bysort state year quarter: gen month =(quarter-1)*3+_n
{txt}
{com}. order state statecode year quarter month
{txt}
{com}. 
{txt}end of do-file

{com}. table year

{txt}{hline 10}{c TT}{hline 11}
     year {c |}      Freq.
{hline 10}{c +}{hline 11}
     1985 {c |}        {res}612
     {txt}1986 {c |}        {res}612
     {txt}1987 {c |}        {res}612
     {txt}1988 {c |}        {res}612
     {txt}1989 {c |}        {res}612
     {txt}1990 {c |}        {res}612
     {txt}1991 {c |}        {res}612
     {txt}1992 {c |}        {res}612
     {txt}1993 {c |}        {res}612
     {txt}1994 {c |}        {res}612
     {txt}1995 {c |}        {res}612
     {txt}1996 {c |}        {res}612
     {txt}1997 {c |}        {res}612
     {txt}1998 {c |}        {res}612
     {txt}1999 {c |}        {res}612
     {txt}2000 {c |}        {res}612
     {txt}2001 {c |}        {res}612
     {txt}2002 {c |}        {res}612
     {txt}2003 {c |}        {res}612
     {txt}2004 {c |}        {res}612
     {txt}2005 {c |}        {res}612
     {txt}2006 {c |}        {res}612
     {txt}2007 {c |}        {res}612
     {txt}2008 {c |}        {res}612
     {txt}2009 {c |}        {res}612
     {txt}2010 {c |}        {res}612
     {txt}2011 {c |}        {res}612
     {txt}2012 {c |}        {res}612
     {txt}2013 {c |}        {res}612
     {txt}2014 {c |}        {res}612
     {txt}2015 {c |}        {res}612
     {txt}2016 {c |}        {res}612
     {txt}2017 {c |}        {res}612
     {txt}2018 {c |}        {res}612
     {txt}2019 {c |}        {res}306
{txt}{hline 10}{c BT}{hline 11}

{com}. merge 1:1 state year month using "${c -(}folder{c )-}stateM.dta", keep(master using) 
{res}
{txt}{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}           5,508
{txt}{col 9}from master{col 30}{res}               0{txt}  (_merge==1)
{col 9}from using{col 30}{res}           5,508{txt}  (_merge==2)

{col 5}matched{col 30}{res}               0{txt}  (_merge==3)
{col 5}{hline 41}

{com}. 
. merge 1:1 state year using "${c -(}folder{c )-}stateM.dta", keep(master using) 
{res}{err}_merge already defined
{txt}{search r(110):r(110);}

{com}. use "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData/stateM.dta", clear

. table year 

{txt}{hline 10}{c TT}{hline 11}
     year {c |}      Freq.
{hline 10}{c +}{hline 11}
     1976 {c |}        {res}612
     {txt}1977 {c |}        {res}612
     {txt}1978 {c |}        {res}612
     {txt}1979 {c |}        {res}612
     {txt}1980 {c |}        {res}612
     {txt}1981 {c |}        {res}612
     {txt}1982 {c |}        {res}612
     {txt}1983 {c |}        {res}612
     {txt}1984 {c |}        {res}612
     {txt}1985 {c |}        {res}612
     {txt}1986 {c |}        {res}612
     {txt}1987 {c |}        {res}612
     {txt}1988 {c |}        {res}612
     {txt}1989 {c |}        {res}612
     {txt}1990 {c |}        {res}612
     {txt}1991 {c |}        {res}612
     {txt}1992 {c |}        {res}612
     {txt}1993 {c |}        {res}612
     {txt}1994 {c |}        {res}612
     {txt}1995 {c |}        {res}612
     {txt}1996 {c |}        {res}612
     {txt}1997 {c |}        {res}612
     {txt}1998 {c |}        {res}612
     {txt}1999 {c |}        {res}612
     {txt}2000 {c |}        {res}612
     {txt}2001 {c |}        {res}612
     {txt}2002 {c |}        {res}612
     {txt}2003 {c |}        {res}612
     {txt}2004 {c |}        {res}612
     {txt}2005 {c |}        {res}612
     {txt}2006 {c |}        {res}612
     {txt}2007 {c |}        {res}612
     {txt}2008 {c |}        {res}612
     {txt}2009 {c |}        {res}612
     {txt}2010 {c |}        {res}612
     {txt}2011 {c |}        {res}612
     {txt}2012 {c |}        {res}612
     {txt}2013 {c |}        {res}612
     {txt}2014 {c |}        {res}612
     {txt}2015 {c |}        {res}612
     {txt}2016 {c |}        {res}612
     {txt}2017 {c |}        {res}612
     {txt}2018 {c |}        {res}612
     {txt}2019 {c |}        {res}306
{txt}{hline 10}{c BT}{hline 11}

{com}. table state

{txt}{hline 10}{c TT}{hline 11}
stateabbr {c |}      Freq.
{hline 10}{c +}{hline 11}
       AK {c |}        {res}522
       {txt}AL {c |}        {res}522
       {txt}AR {c |}        {res}522
       {txt}AZ {c |}        {res}522
       {txt}CA {c |}        {res}522
       {txt}CO {c |}        {res}522
       {txt}CT {c |}        {res}522
       {txt}DC {c |}        {res}522
       {txt}DE {c |}        {res}522
       {txt}FL {c |}        {res}522
       {txt}GA {c |}        {res}522
       {txt}HI {c |}        {res}522
       {txt}IA {c |}        {res}522
       {txt}ID {c |}        {res}522
       {txt}IL {c |}        {res}522
       {txt}IN {c |}        {res}522
       {txt}KS {c |}        {res}522
       {txt}KY {c |}        {res}522
       {txt}LA {c |}        {res}522
       {txt}MA {c |}        {res}522
       {txt}MD {c |}        {res}522
       {txt}ME {c |}        {res}522
       {txt}MI {c |}        {res}522
       {txt}MN {c |}        {res}522
       {txt}MO {c |}        {res}522
       {txt}MS {c |}        {res}522
       {txt}MT {c |}        {res}522
       {txt}NC {c |}        {res}522
       {txt}ND {c |}        {res}522
       {txt}NE {c |}        {res}522
       {txt}NH {c |}        {res}522
       {txt}NJ {c |}        {res}522
       {txt}NM {c |}        {res}522
       {txt}NV {c |}        {res}522
       {txt}NY {c |}        {res}522
       {txt}OH {c |}        {res}522
       {txt}OK {c |}        {res}522
       {txt}OR {c |}        {res}522
       {txt}PA {c |}        {res}522
       {txt}RI {c |}        {res}522
       {txt}SC {c |}        {res}522
       {txt}SD {c |}        {res}522
       {txt}TN {c |}        {res}522
       {txt}TX {c |}        {res}522
       {txt}UT {c |}        {res}522
       {txt}VA {c |}        {res}522
       {txt}VT {c |}        {res}522
       {txt}WA {c |}        {res}522
       {txt}WI {c |}        {res}522
       {txt}WV {c |}        {res}522
       {txt}WY {c |}        {res}522
{txt}{hline 10}{c BT}{hline 11}

{com}. keep state 

. duplcates drop 
{err}unrecognized command:  duplcates
{txt}{search r(199):r(199);}

{com}. duplicates drop,force
{err}options not allowed
{txt}{search r(101):r(101);}

{com}. duplicates drop

{p 0 4}{txt}Duplicates in terms of {txt} all variables{p_end}

(26571 observations deleted)

{com}. merge 1:m state using "stateQ.dta",keep(master using)
{res}
{txt}{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}               0
{txt}{col 5}matched{col 30}{res}               0{txt}  (_merge==3)
{col 5}{hline 41}

{com}. use "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData/stateM.dta", clear

. duplicates state drop
{err}illegal {cmd}duplicates {err}subcommand
{txt}{search r(198):r(198);}

{com}. duplicates state, drop
{err}illegal {cmd}duplicates {err}subcommand
{txt}{search r(198):r(198);}

{com}. help duplicates

. duplicates drop state
{err}force option required with {cmd}duplicates drop {it}varlist{rm}
{txt}{search r(198):r(198);}

{com}. duplicates drop state,force

{p 0 4}{txt}Duplicates in terms of {res} state{p_end}

{txt}(26571 observations deleted)

{com}. count 
{res}   51

{com}. merge 1:m state using "stateQ.dta",keep(master using)
{res}
{txt}{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}               0
{txt}{col 5}matched{col 30}{res}               0{txt}  (_merge==3)
{col 5}{hline 41}

{com}. clear

. do "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/DoFile/Step00_PrepareStateData.do"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. import excel "${c -(}folder{c )-}laus.xlsx", sheet("Sheet1") firstrow clear
{res}{txt}
{com}. 
. gen month_new = .
{txt}(26622 missing values generated)

{com}. replace month_new =1 if month=="Jan"
{txt}(2244 real changes made)

{com}. replace month_new = 2 if month =="Feb"
{txt}(2244 real changes made)

{com}. replace month_new = 3 if month=="Mar"
{txt}(2244 real changes made)

{com}. replace month_new = 4 if month=="Apr"
{txt}(2244 real changes made)

{com}. replace month_new = 5 if month == "May"
{txt}(2244 real changes made)

{com}. replace month_new = 6 if month =="Jun"
{txt}(2244 real changes made)

{com}. replace month_new = 7 if month=="Jul"
{txt}(2193 real changes made)

{com}. replace month_new = 8 if month =="Aug"
{txt}(2193 real changes made)

{com}. replace month_new = 9 if month=="Sep"
{txt}(2193 real changes made)

{com}. replace month_new =10 if month=="Oct"
{txt}(2193 real changes made)

{com}. replace month_new = 11 if month =="Nov"
{txt}(2193 real changes made)

{com}. replace month_new = 12 if month =="Dec"
{txt}(2193 real changes made)

{com}. drop month
{txt}
{com}. rename month_new month
{res}{txt}
{com}. order state year month
{txt}
{com}. 
. rename state statename 
{res}{txt}
{com}. rename stateabbr state
{res}{txt}
{com}. save stateM.dta,replace
{txt}file stateM.dta saved

{com}. 
. /*
> import excel "${c -(}folder{c )-}data_quarter.xlsx", sheet("Sheet1") firstrow clear
> 
> expand 3
> sort state year quarter
> bysort state year quarter: gen month =(quarter-1)*3+_n
> order state statecode year quarter month
> 
> merge 1:1 state year month using "${c -(}folder{c )-}stateM.dta", keep(master using) 
> rename _merge state_merge
> */
. ******************
. ** date       ****
. ******************
. 
. save stateM,replace 
{txt}file stateM.dta saved

{com}. rm "stateQ.dta"
{txt}
{com}. 
{txt}end of do-file

{com}. do "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/DoFile/Step01_CleaningSCE.do"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{txt}
{com}. label var Q41 "years of living in the current residence"
{txt}
{com}. label var Q42 "years of living in the current states"
{txt}
{com}. label var Q43 "own/rent/other a house(1/2/3)"
{txt}
{com}. label var Q43a "my/spounser/both's name under which current residence is owned/rent"
{txt}
{com}. label var Q44 "own other homes(1/0)"
{txt}
{com}. label var Q45b "health condition(1-5 from good to poor)"
{txt}
{com}. label var Q45new_1 ""
{txt}
{com}. label var Q45new_2 ""
{txt}
{com}. label var Q45new_3 ""
{txt}
{com}. label var Q45new_4 ""
{txt}
{com}. label var Q45new_5 ""
{txt}
{com}. label var Q45new_6 ""
{txt}
{com}. label var Q45new_7 ""
{txt}
{com}. label var Q45new_8 ""
{txt}
{com}. label var Q45new_9 ""
{txt}
{com}. label var Q46 "financial decision making of household(1-5, together to individual)"
{txt}
{com}. label var Q47 "total pre-tax household income from y-1 to y(1-11, low to high)"
{txt}
{com}. label var D1 "same household as last year(1/0)"
{txt}
{com}. label var D3 "date of moving to the current residence(month/year)"
{txt}
{com}. label var D6 "total pre-tax household income from y-1 to y(1-11,low to high)"
{txt}
{com}. label var D2new_1 "memeber in the current resident:spounse/partner"
{txt}
{com}. label var D2new_2 "memeber in the current resident: child >25"
{txt}
{com}. label var D2new_3 "memeber in the current resident: child 18-24"
{txt}
{com}. label var D2new_4 "memeber in the current resident: child 6-17"
{txt}
{com}. label var D2new_5 "memeber in the current resident: child <=5 "
{txt}
{com}. label var D2new_6 "memeber in the current resident: own/sponse's parents"
{txt}
{com}. label var D2new_7 "memeber in the current resident:other relatives"
{txt}
{com}. label var D2new_8 "memeber in the current resident:non-relatives"
{txt}
{com}. label var DSAME "same job as last year in survey"
{txt}
{com}. label var DQ38 "living as a partner or married with some one(1/0)"
{txt}
{com}. label var Q48 "interesting/uninteresting of the questions in the survey(1/0)"
{txt}
{com}. 
. 
. ** Only keep useful variables so that the data file is smaller. 
. 
. global keeplist date year month userid tenure weight ///        
>        Q24_cent25 Q24_cent50 Q24_cent75 Q24_var Q24_mean Q24_iqr ///
>            Q24_bin1 Q24_bin2 Q24_bin3 Q24_bin4 Q24_bin5 Q24_bin6 Q24_bin7 Q24_bin8 Q24_bin9 Q24_bin10 ///
>            Q32 Q33 Q34 Q35_1 Q35_2 Q35_3 Q35_4 Q35_5 Q35_6 Q36 Q37 Q38 ///
>            HH2_1 HH2_2 HH2_3 HH2_4 HH2_5 HH2_6 HH2_7 HH2_8 HH2_9 HH2_10 HH2_11 ///
>            _STATE Q41 Q42 Q43 Q43a Q44 Q45b ///
>            Q45new_1 Q45new_2 Q45new_3 Q45new_4 Q45new_5 Q45new_6 Q45new_7 Q45new_8 Q45new_9 ///
>            Q46 Q47 D1 D3 D6 D2new_1 D2new_2 D2new_3 D2new_4 D2new_5 D2new_6 D2new_7 D2new_8 D2newdk_1 DSAME DQ38 ///
>            DHH2_1 DHH2_2 DHH2_3 DHH2_4 DHH2_5 DHH2_6 DHH2_7 DHH2_8 DHH2_9 DHH2_10 DHH2_11 DHH2_11_other D5b Q48 QRA1 QRA2 ///
>            _AGE_CAT _NUM_CAT _REGION_CAT _COMMUTING_ZONE _EDU_CAT _HH_INC_CAT ///
>            Q1 Q2 Q3 Q4new Q5new Q6new Q9_mean Q9_var ///
>            Q10_1 Q10_2 Q10_3 Q10_4 Q10_5 Q10_6 Q10_7 Q10_8 Q10_9 Q10_10 Q11 Q12new Q13new Q14new ///
>            Q25v2 Q25v2part2 Q31v2 Q31v2part2 C1_mean C1_var ///
>            Q26v2 Q26v2part2
{txt}
{com}.  
. keep ${c -(}keeplist{c )-}
{txt}
{com}. 
. 
. *************************
. *** Merge with state level 
. *************************
. 
. rename _STATE state 
{res}{txt}
{com}. 
. merge m:1 state year month using "${c -(}otherdata{c )-}stateM.dta",keep(master)
{res}{txt}{p 0 7 2}
(note: variable
state was 
str2, now str20 to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
month was 
byte, now float to accommodate using data's values)
{p_end}

{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}          95,034
{txt}{col 9}from master{col 30}{res}          95,034{txt}  (_merge==1)
{col 9}from using{col 30}{res}               0{txt}  (_merge==2)

{col 5}matched{col 30}{res}               0{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename _merge sce_state_merge 
{res}{txt}
{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. table state

{txt}{hline 10}{c TT}{hline 11}
state     {c |}
(2-digit  {c |}
code)     {c |}      Freq.
{hline 10}{c +}{hline 11}
       AK {c |}        {res}112
       {txt}AL {c |}      {res}1,222
       {txt}AR {c |}        {res}888
       {txt}AZ {c |}      {res}2,294
       {txt}CA {c |}      {res}8,962
       {txt}CO {c |}      {res}1,954
       {txt}CT {c |}      {res}1,177
       {txt}DC {c |}        {res}286
       {txt}DE {c |}        {res}241
       {txt}FL {c |}      {res}5,981
       {txt}GA {c |}      {res}2,400
       {txt}HI {c |}        {res}293
       {txt}IA {c |}      {res}1,062
       {txt}ID {c |}        {res}653
       {txt}IL {c |}      {res}4,080
       {txt}IN {c |}      {res}1,756
       {txt}KS {c |}        {res}862
       {txt}KY {c |}      {res}1,244
       {txt}LA {c |}      {res}1,013
       {txt}MA {c |}      {res}2,108
       {txt}MD {c |}      {res}1,702
       {txt}ME {c |}        {res}691
       {txt}MI {c |}      {res}3,421
       {txt}MN {c |}      {res}2,378
       {txt}MO {c |}      {res}1,937
       {txt}MS {c |}        {res}600
       {txt}MT {c |}        {res}311
       {txt}NC {c |}      {res}2,920
       {txt}ND {c |}        {res}272
       {txt}NE {c |}        {res}628
       {txt}NH {c |}        {res}528
       {txt}NJ {c |}      {res}3,266
       {txt}NM {c |}        {res}459
       {txt}NV {c |}        {res}774
       {txt}NY {c |}      {res}5,585
       {txt}OH {c |}      {res}3,872
       {txt}OK {c |}        {res}960
       {txt}OR {c |}      {res}1,712
       {txt}PA {c |}      {res}5,245
       {txt}RI {c |}        {res}260
       {txt}SC {c |}      {res}1,185
       {txt}SD {c |}        {res}247
       {txt}TN {c |}      {res}1,827
       {txt}TX {c |}      {res}6,767
       {txt}UT {c |}        {res}817
       {txt}VA {c |}      {res}2,356
       {txt}VT {c |}        {res}188
       {txt}WA {c |}      {res}2,706
       {txt}WI {c |}      {res}2,102
       {txt}WV {c |}        {res}382
       {txt}WY {c |}        {res}173
{txt}{hline 10}{c BT}{hline 11}

{com}. use "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData/stateM.dta", clear

. table state

{txt}{hline 10}{c TT}{hline 11}
stateabbr {c |}      Freq.
{hline 10}{c +}{hline 11}
       AK {c |}        {res}522
       {txt}AL {c |}        {res}522
       {txt}AR {c |}        {res}522
       {txt}AZ {c |}        {res}522
       {txt}CA {c |}        {res}522
       {txt}CO {c |}        {res}522
       {txt}CT {c |}        {res}522
       {txt}DC {c |}        {res}522
       {txt}DE {c |}        {res}522
       {txt}FL {c |}        {res}522
       {txt}GA {c |}        {res}522
       {txt}HI {c |}        {res}522
       {txt}IA {c |}        {res}522
       {txt}ID {c |}        {res}522
       {txt}IL {c |}        {res}522
       {txt}IN {c |}        {res}522
       {txt}KS {c |}        {res}522
       {txt}KY {c |}        {res}522
       {txt}LA {c |}        {res}522
       {txt}MA {c |}        {res}522
       {txt}MD {c |}        {res}522
       {txt}ME {c |}        {res}522
       {txt}MI {c |}        {res}522
       {txt}MN {c |}        {res}522
       {txt}MO {c |}        {res}522
       {txt}MS {c |}        {res}522
       {txt}MT {c |}        {res}522
       {txt}NC {c |}        {res}522
       {txt}ND {c |}        {res}522
       {txt}NE {c |}        {res}522
       {txt}NH {c |}        {res}522
       {txt}NJ {c |}        {res}522
       {txt}NM {c |}        {res}522
       {txt}NV {c |}        {res}522
       {txt}NY {c |}        {res}522
       {txt}OH {c |}        {res}522
       {txt}OK {c |}        {res}522
       {txt}OR {c |}        {res}522
       {txt}PA {c |}        {res}522
       {txt}RI {c |}        {res}522
       {txt}SC {c |}        {res}522
       {txt}SD {c |}        {res}522
       {txt}TN {c |}        {res}522
       {txt}TX {c |}        {res}522
       {txt}UT {c |}        {res}522
       {txt}VA {c |}        {res}522
       {txt}VT {c |}        {res}522
       {txt}WA {c |}        {res}522
       {txt}WI {c |}        {res}522
       {txt}WV {c |}        {res}522
       {txt}WY {c |}        {res}522
{txt}{hline 10}{c BT}{hline 11}

{com}. duplicates report state year month

{p 0 4}{txt}Duplicates in terms of {res} state year month{p_end}

{txt}{hline 10}{c TT}{hline 27}
   copies {c |} observations       surplus
{hline 10}{c +}{hline 27}
        1 {c |}        {res}26622             0
{txt}{hline 10}{c BT}{hline 27}

{com}. do "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/DoFile/Step01_CleaningSCE.do"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{err}{hline 2}Break{hline 2}
{txt}{search r(1):r(1);}

end of do-file

{err}{hline 2}Break{hline 2}
{txt}{search r(1):r(1);}

{com}. do "/var/folders/k3/fzq0vzzx2b56ypvhsddgs7hr0000gn/T//SD02567.000000"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{txt}
{com}. label var Q41 "years of living in the current residence"
{txt}
{com}. label var Q42 "years of living in the current states"
{txt}
{com}. label var Q43 "own/rent/other a house(1/2/3)"
{txt}
{com}. label var Q43a "my/spounser/both's name under which current residence is owned/rent"
{txt}
{com}. label var Q44 "own other homes(1/0)"
{txt}
{com}. label var Q45b "health condition(1-5 from good to poor)"
{txt}
{com}. label var Q45new_1 ""
{txt}
{com}. label var Q45new_2 ""
{txt}
{com}. label var Q45new_3 ""
{txt}
{com}. label var Q45new_4 ""
{txt}
{com}. label var Q45new_5 ""
{txt}
{com}. label var Q45new_6 ""
{txt}
{com}. label var Q45new_7 ""
{txt}
{com}. label var Q45new_8 ""
{txt}
{com}. label var Q45new_9 ""
{txt}
{com}. label var Q46 "financial decision making of household(1-5, together to individual)"
{txt}
{com}. label var Q47 "total pre-tax household income from y-1 to y(1-11, low to high)"
{txt}
{com}. label var D1 "same household as last year(1/0)"
{txt}
{com}. label var D3 "date of moving to the current residence(month/year)"
{txt}
{com}. label var D6 "total pre-tax household income from y-1 to y(1-11,low to high)"
{txt}
{com}. label var D2new_1 "memeber in the current resident:spounse/partner"
{txt}
{com}. label var D2new_2 "memeber in the current resident: child >25"
{txt}
{com}. label var D2new_3 "memeber in the current resident: child 18-24"
{txt}
{com}. label var D2new_4 "memeber in the current resident: child 6-17"
{txt}
{com}. label var D2new_5 "memeber in the current resident: child <=5 "
{txt}
{com}. label var D2new_6 "memeber in the current resident: own/sponse's parents"
{txt}
{com}. label var D2new_7 "memeber in the current resident:other relatives"
{txt}
{com}. label var D2new_8 "memeber in the current resident:non-relatives"
{txt}
{com}. label var DSAME "same job as last year in survey"
{txt}
{com}. label var DQ38 "living as a partner or married with some one(1/0)"
{txt}
{com}. label var Q48 "interesting/uninteresting of the questions in the survey(1/0)"
{txt}
{com}. 
. 
. ** Only keep useful variables so that the data file is smaller. 
. 
. global keeplist date year month userid tenure weight ///        
>        Q24_cent25 Q24_cent50 Q24_cent75 Q24_var Q24_mean Q24_iqr ///
>            Q24_bin1 Q24_bin2 Q24_bin3 Q24_bin4 Q24_bin5 Q24_bin6 Q24_bin7 Q24_bin8 Q24_bin9 Q24_bin10 ///
>            Q32 Q33 Q34 Q35_1 Q35_2 Q35_3 Q35_4 Q35_5 Q35_6 Q36 Q37 Q38 ///
>            HH2_1 HH2_2 HH2_3 HH2_4 HH2_5 HH2_6 HH2_7 HH2_8 HH2_9 HH2_10 HH2_11 ///
>            _STATE Q41 Q42 Q43 Q43a Q44 Q45b ///
>            Q45new_1 Q45new_2 Q45new_3 Q45new_4 Q45new_5 Q45new_6 Q45new_7 Q45new_8 Q45new_9 ///
>            Q46 Q47 D1 D3 D6 D2new_1 D2new_2 D2new_3 D2new_4 D2new_5 D2new_6 D2new_7 D2new_8 D2newdk_1 DSAME DQ38 ///
>            DHH2_1 DHH2_2 DHH2_3 DHH2_4 DHH2_5 DHH2_6 DHH2_7 DHH2_8 DHH2_9 DHH2_10 DHH2_11 DHH2_11_other D5b Q48 QRA1 QRA2 ///
>            _AGE_CAT _NUM_CAT _REGION_CAT _COMMUTING_ZONE _EDU_CAT _HH_INC_CAT ///
>            Q1 Q2 Q3 Q4new Q5new Q6new Q9_mean Q9_var ///
>            Q10_1 Q10_2 Q10_3 Q10_4 Q10_5 Q10_6 Q10_7 Q10_8 Q10_9 Q10_10 Q11 Q12new Q13new Q14new ///
>            Q25v2 Q25v2part2 Q31v2 Q31v2part2 C1_mean C1_var ///
>            Q26v2 Q26v2part2
{txt}
{com}.  
. keep ${c -(}keeplist{c )-}
{txt}
{com}. 
. *************************
. *** Merge with state level 
. *************************
. 
. rename _STATE state 
{res}{txt}
{com}. 
. merge m:m year month using "${c -(}otherdata{c )-}stateM.dta",keep(master)
{res}{txt}{p 0 7 2}
(note: variable
state was 
str2, now str20 to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
month was 
byte, now float to accommodate using data's values)
{p_end}

{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}               0
{txt}{col 5}matched{col 30}{res}               0{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename _merge sce_state_merge 
{res}{txt}
{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. help merge 

. help merge

. do "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/DoFile/Step01_CleaningSCE.do"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{txt}
{com}. label var Q41 "years of living in the current residence"
{txt}
{com}. label var Q42 "years of living in the current states"
{txt}
{com}. label var Q43 "own/rent/other a house(1/2/3)"
{txt}
{com}. label var Q43a "my/spounser/both's name under which current residence is owned/rent"
{txt}
{com}. label var Q44 "own other homes(1/0)"
{txt}
{com}. label var Q45b "health condition(1-5 from good to poor)"
{txt}
{com}. label var Q45new_1 ""
{txt}
{com}. label var Q45new_2 ""
{txt}
{com}. label var Q45new_3 ""
{txt}
{com}. label var Q45new_4 ""
{txt}
{com}. label var Q45new_5 ""
{txt}
{com}. label var Q45new_6 ""
{txt}
{com}. label var Q45new_7 ""
{txt}
{com}. label var Q45new_8 ""
{txt}
{com}. label var Q45new_9 ""
{txt}
{com}. label var Q46 "financial decision making of household(1-5, together to individual)"
{txt}
{com}. label var Q47 "total pre-tax household income from y-1 to y(1-11, low to high)"
{txt}
{com}. label var D1 "same household as last year(1/0)"
{txt}
{com}. label var D3 "date of moving to the current residence(month/year)"
{txt}
{com}. label var D6 "total pre-tax household income from y-1 to y(1-11,low to high)"
{txt}
{com}. label var D2new_1 "memeber in the current resident:spounse/partner"
{txt}
{com}. label var D2new_2 "memeber in the current resident: child >25"
{txt}
{com}. label var D2new_3 "memeber in the current resident: child 18-24"
{txt}
{com}. label var D2new_4 "memeber in the current resident: child 6-17"
{txt}
{com}. label var D2new_5 "memeber in the current resident: child <=5 "
{txt}
{com}. label var D2new_6 "memeber in the current resident: own/sponse's parents"
{txt}
{com}. label var D2new_7 "memeber in the current resident:other relatives"
{txt}
{com}. label var D2new_8 "memeber in the current resident:non-relatives"
{txt}
{com}. label var DSAME "same job as last year in survey"
{txt}
{com}. label var DQ38 "living as a partner or married with some one(1/0)"
{txt}
{com}. label var Q48 "interesting/uninteresting of the questions in the survey(1/0)"
{txt}
{com}. 
. 
. ** Only keep useful variables so that the data file is smaller. 
. 
. global keeplist date year month userid tenure weight ///        
>        Q24_cent25 Q24_cent50 Q24_cent75 Q24_var Q24_mean Q24_iqr ///
>            Q24_bin1 Q24_bin2 Q24_bin3 Q24_bin4 Q24_bin5 Q24_bin6 Q24_bin7 Q24_bin8 Q24_bin9 Q24_bin10 ///
>            Q32 Q33 Q34 Q35_1 Q35_2 Q35_3 Q35_4 Q35_5 Q35_6 Q36 Q37 Q38 ///
>            HH2_1 HH2_2 HH2_3 HH2_4 HH2_5 HH2_6 HH2_7 HH2_8 HH2_9 HH2_10 HH2_11 ///
>            _STATE Q41 Q42 Q43 Q43a Q44 Q45b ///
>            Q45new_1 Q45new_2 Q45new_3 Q45new_4 Q45new_5 Q45new_6 Q45new_7 Q45new_8 Q45new_9 ///
>            Q46 Q47 D1 D3 D6 D2new_1 D2new_2 D2new_3 D2new_4 D2new_5 D2new_6 D2new_7 D2new_8 D2newdk_1 DSAME DQ38 ///
>            DHH2_1 DHH2_2 DHH2_3 DHH2_4 DHH2_5 DHH2_6 DHH2_7 DHH2_8 DHH2_9 DHH2_10 DHH2_11 DHH2_11_other D5b Q48 QRA1 QRA2 ///
>            _AGE_CAT _NUM_CAT _REGION_CAT _COMMUTING_ZONE _EDU_CAT _HH_INC_CAT ///
>            Q1 Q2 Q3 Q4new Q5new Q6new Q9_mean Q9_var ///
>            Q10_1 Q10_2 Q10_3 Q10_4 Q10_5 Q10_6 Q10_7 Q10_8 Q10_9 Q10_10 Q11 Q12new Q13new Q14new ///
>            Q25v2 Q25v2part2 Q31v2 Q31v2part2 C1_mean C1_var ///
>            Q26v2 Q26v2part2
{txt}
{com}.  
. keep ${c -(}keeplist{c )-}
{txt}
{com}. 
. *************************
. *** Merge with state level 
. *************************
. 
. rename _STATE state 
{res}{txt}
{com}. 
. merge m:1 state year month using "${c -(}otherdata{c )-}stateM.dta",keep(match)
{res}{txt}{p 0 7 2}
(note: variable
state was 
str2, now str20 to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
month was 
byte, now float to accommodate using data's values)
{p_end}

{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}               0
{txt}{col 5}matched{col 30}{res}               0{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename _merge sce_state_merge 
{res}{txt}
{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/var/folders/k3/fzq0vzzx2b56ypvhsddgs7hr0000gn/T//SD02567.000000"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. import excel "${c -(}folder{c )-}laus.xlsx", sheet("Sheet1") firstrow clear
{res}{txt}
{com}. 
. gen month_new = .
{txt}(26622 missing values generated)

{com}. replace month_new =1 if month=="Jan"
{txt}(2244 real changes made)

{com}. replace month_new = 2 if month =="Feb"
{txt}(2244 real changes made)

{com}. replace month_new = 3 if month=="Mar"
{txt}(2244 real changes made)

{com}. replace month_new = 4 if month=="Apr"
{txt}(2244 real changes made)

{com}. replace month_new = 5 if month == "May"
{txt}(2244 real changes made)

{com}. replace month_new = 6 if month =="Jun"
{txt}(2244 real changes made)

{com}. replace month_new = 7 if month=="Jul"
{txt}(2193 real changes made)

{com}. replace month_new = 8 if month =="Aug"
{txt}(2193 real changes made)

{com}. replace month_new = 9 if month=="Sep"
{txt}(2193 real changes made)

{com}. replace month_new =10 if month=="Oct"
{txt}(2193 real changes made)

{com}. replace month_new = 11 if month =="Nov"
{txt}(2193 real changes made)

{com}. replace month_new = 12 if month =="Dec"
{txt}(2193 real changes made)

{com}. drop month
{txt}
{com}. rename month_new month
{res}{txt}
{com}. order state year month
{txt}
{com}. 
. rename state statename 
{res}{txt}
{com}. rename stateabbr state
{res}{txt}
{com}. save stateM.dta,replace
{txt}file stateM.dta saved

{com}. 
. 
. import excel "${c -(}folder{c )-}data_quarter.xlsx", sheet("Sheet1") firstrow clear
{res}{txt}
{com}. 
. expand 3
{txt}(14076 observations created)

{com}. sort state year quarter
{txt}
{com}. bysort state year quarter: gen month =(quarter-1)*3+_n
{txt}
{com}. order state statecode year quarter month
{txt}
{com}. 
. merge 1:1 state year month using "${c -(}folder{c )-}stateM.dta", keep(match master using) 
{res}
{txt}{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}           5,508
{txt}{col 9}from master{col 30}{res}               0{txt}  (_merge==1)
{col 9}from using{col 30}{res}           5,508{txt}  (_merge==2)

{col 5}matched{col 30}{res}          21,114{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename _merge state_merge
{res}{txt}
{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/DoFile/Step00_PrepareStateData.do"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. import excel "${c -(}folder{c )-}laus.xlsx", sheet("Sheet1") firstrow clear
{res}{txt}
{com}. 
. gen month_new = .
{txt}(26622 missing values generated)

{com}. replace month_new =1 if month=="Jan"
{txt}(2244 real changes made)

{com}. replace month_new = 2 if month =="Feb"
{txt}(2244 real changes made)

{com}. replace month_new = 3 if month=="Mar"
{txt}(2244 real changes made)

{com}. replace month_new = 4 if month=="Apr"
{txt}(2244 real changes made)

{com}. replace month_new = 5 if month == "May"
{txt}(2244 real changes made)

{com}. replace month_new = 6 if month =="Jun"
{txt}(2244 real changes made)

{com}. replace month_new = 7 if month=="Jul"
{txt}(2193 real changes made)

{com}. replace month_new = 8 if month =="Aug"
{txt}(2193 real changes made)

{com}. replace month_new = 9 if month=="Sep"
{txt}(2193 real changes made)

{com}. replace month_new =10 if month=="Oct"
{txt}(2193 real changes made)

{com}. replace month_new = 11 if month =="Nov"
{txt}(2193 real changes made)

{com}. replace month_new = 12 if month =="Dec"
{txt}(2193 real changes made)

{com}. drop month
{txt}
{com}. rename month_new month
{res}{txt}
{com}. order state year month
{txt}
{com}. 
. rename state statename 
{res}{txt}
{com}. rename stateabbr state
{res}{txt}
{com}. save stateM.dta,replace
{txt}file stateM.dta saved

{com}. 
. 
. import excel "${c -(}folder{c )-}data_quarter.xlsx", sheet("Sheet1") firstrow clear
{res}{txt}
{com}. 
. expand 3
{txt}(14076 observations created)

{com}. sort state year quarter
{txt}
{com}. bysort state year quarter: gen month =(quarter-1)*3+_n
{txt}
{com}. order state statecode year quarter month
{txt}
{com}. 
. merge 1:1 state year month using "${c -(}folder{c )-}stateM.dta", keep(match master using) 
{res}
{txt}{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}           5,508
{txt}{col 9}from master{col 30}{res}               0{txt}  (_merge==1)
{col 9}from using{col 30}{res}           5,508{txt}  (_merge==2)

{col 5}matched{col 30}{res}          21,114{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename _merge state_merge
{res}{txt}
{com}. 
. ******************
. ** date       ****
. ******************
. 
. save stateM,replace 
{txt}file stateM.dta saved

{com}. rm "stateQ.dta"
{err}{p 0 4 2}
file stateQ.dta
not found
{p_end}
{txt}{search r(601):r(601);}

end of do-file

{search r(601):r(601);}

{com}. rm stateQ
{err}{p 0 4 2}
file stateQ
not found
{p_end}
{txt}{search r(601):r(601);}

{com}. 
. count 
{res}26622

{com}. unique state
{txt}Number of unique values of state is  {res}51
{txt}Number of records is  {res}26622

{com}. unique year
{txt}Number of unique values of year is  {res}44
{txt}Number of records is  {res}26622

{com}. unique month 
{txt}Number of unique values of month is  {res}12
{txt}Number of records is  {res}26622

{com}. clear

. use "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData/stateM.dta"

. clear

. do "/var/folders/k3/fzq0vzzx2b56ypvhsddgs7hr0000gn/T//SD02567.000000"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{txt}
{com}. label var Q41 "years of living in the current residence"
{txt}
{com}. label var Q42 "years of living in the current states"
{txt}
{com}. label var Q43 "own/rent/other a house(1/2/3)"
{txt}
{com}. label var Q43a "my/spounser/both's name under which current residence is owned/rent"
{txt}
{com}. label var Q44 "own other homes(1/0)"
{txt}
{com}. label var Q45b "health condition(1-5 from good to poor)"
{txt}
{com}. label var Q45new_1 ""
{txt}
{com}. label var Q45new_2 ""
{txt}
{com}. label var Q45new_3 ""
{txt}
{com}. label var Q45new_4 ""
{txt}
{com}. label var Q45new_5 ""
{txt}
{com}. label var Q45new_6 ""
{txt}
{com}. label var Q45new_7 ""
{txt}
{com}. label var Q45new_8 ""
{txt}
{com}. label var Q45new_9 ""
{txt}
{com}. label var Q46 "financial decision making of household(1-5, together to individual)"
{txt}
{com}. label var Q47 "total pre-tax household income from y-1 to y(1-11, low to high)"
{txt}
{com}. label var D1 "same household as last year(1/0)"
{txt}
{com}. label var D3 "date of moving to the current residence(month/year)"
{txt}
{com}. label var D6 "total pre-tax household income from y-1 to y(1-11,low to high)"
{txt}
{com}. label var D2new_1 "memeber in the current resident:spounse/partner"
{txt}
{com}. label var D2new_2 "memeber in the current resident: child >25"
{txt}
{com}. label var D2new_3 "memeber in the current resident: child 18-24"
{txt}
{com}. label var D2new_4 "memeber in the current resident: child 6-17"
{txt}
{com}. label var D2new_5 "memeber in the current resident: child <=5 "
{txt}
{com}. label var D2new_6 "memeber in the current resident: own/sponse's parents"
{txt}
{com}. label var D2new_7 "memeber in the current resident:other relatives"
{txt}
{com}. label var D2new_8 "memeber in the current resident:non-relatives"
{txt}
{com}. label var DSAME "same job as last year in survey"
{txt}
{com}. label var DQ38 "living as a partner or married with some one(1/0)"
{txt}
{com}. label var Q48 "interesting/uninteresting of the questions in the survey(1/0)"
{txt}
{com}. 
. 
. ** Only keep useful variables so that the data file is smaller. 
. 
. global keeplist date year month userid tenure weight ///        
>        Q24_cent25 Q24_cent50 Q24_cent75 Q24_var Q24_mean Q24_iqr ///
>            Q24_bin1 Q24_bin2 Q24_bin3 Q24_bin4 Q24_bin5 Q24_bin6 Q24_bin7 Q24_bin8 Q24_bin9 Q24_bin10 ///
>            Q32 Q33 Q34 Q35_1 Q35_2 Q35_3 Q35_4 Q35_5 Q35_6 Q36 Q37 Q38 ///
>            HH2_1 HH2_2 HH2_3 HH2_4 HH2_5 HH2_6 HH2_7 HH2_8 HH2_9 HH2_10 HH2_11 ///
>            _STATE Q41 Q42 Q43 Q43a Q44 Q45b ///
>            Q45new_1 Q45new_2 Q45new_3 Q45new_4 Q45new_5 Q45new_6 Q45new_7 Q45new_8 Q45new_9 ///
>            Q46 Q47 D1 D3 D6 D2new_1 D2new_2 D2new_3 D2new_4 D2new_5 D2new_6 D2new_7 D2new_8 D2newdk_1 DSAME DQ38 ///
>            DHH2_1 DHH2_2 DHH2_3 DHH2_4 DHH2_5 DHH2_6 DHH2_7 DHH2_8 DHH2_9 DHH2_10 DHH2_11 DHH2_11_other D5b Q48 QRA1 QRA2 ///
>            _AGE_CAT _NUM_CAT _REGION_CAT _COMMUTING_ZONE _EDU_CAT _HH_INC_CAT ///
>            Q1 Q2 Q3 Q4new Q5new Q6new Q9_mean Q9_var ///
>            Q10_1 Q10_2 Q10_3 Q10_4 Q10_5 Q10_6 Q10_7 Q10_8 Q10_9 Q10_10 Q11 Q12new Q13new Q14new ///
>            Q25v2 Q25v2part2 Q31v2 Q31v2part2 C1_mean C1_var ///
>            Q26v2 Q26v2part2
{txt}
{com}.  
. keep ${c -(}keeplist{c )-}
{txt}
{com}. 
. *************************
. *** Merge with state level 
. *************************
. 
. rename _STATE state 
{res}{txt}
{com}. merge m:1 state year month using "${c -(}otherdata{c )-}stateM.dta",keep(match master)
{res}{txt}{p 0 7 2}
(note: variable
state was 
str2, now str20 to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
month was 
byte, now float to accommodate using data's values)
{p_end}

{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}          95,034
{txt}{col 9}from master{col 30}{res}          95,034{txt}  (_merge==1)
{col 9}from using{col 30}{res}               0{txt}  (_merge==2)

{col 5}matched{col 30}{res}               0{txt}  (_merge==3)
{col 5}{hline 41}

{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. unique state
{txt}Number of unique values of state is  {res}52
{txt}Number of records is  {res}95034

{com}. table state

{txt}{hline 10}{c TT}{hline 11}
state     {c |}
(2-digit  {c |}
code)     {c |}      Freq.
{hline 10}{c +}{hline 11}
       AK {c |}        {res}112
       {txt}AL {c |}      {res}1,222
       {txt}AR {c |}        {res}888
       {txt}AZ {c |}      {res}2,294
       {txt}CA {c |}      {res}8,962
       {txt}CO {c |}      {res}1,954
       {txt}CT {c |}      {res}1,177
       {txt}DC {c |}        {res}286
       {txt}DE {c |}        {res}241
       {txt}FL {c |}      {res}5,981
       {txt}GA {c |}      {res}2,400
       {txt}HI {c |}        {res}293
       {txt}IA {c |}      {res}1,062
       {txt}ID {c |}        {res}653
       {txt}IL {c |}      {res}4,080
       {txt}IN {c |}      {res}1,756
       {txt}KS {c |}        {res}862
       {txt}KY {c |}      {res}1,244
       {txt}LA {c |}      {res}1,013
       {txt}MA {c |}      {res}2,108
       {txt}MD {c |}      {res}1,702
       {txt}ME {c |}        {res}691
       {txt}MI {c |}      {res}3,421
       {txt}MN {c |}      {res}2,378
       {txt}MO {c |}      {res}1,937
       {txt}MS {c |}        {res}600
       {txt}MT {c |}        {res}311
       {txt}NC {c |}      {res}2,920
       {txt}ND {c |}        {res}272
       {txt}NE {c |}        {res}628
       {txt}NH {c |}        {res}528
       {txt}NJ {c |}      {res}3,266
       {txt}NM {c |}        {res}459
       {txt}NV {c |}        {res}774
       {txt}NY {c |}      {res}5,585
       {txt}OH {c |}      {res}3,872
       {txt}OK {c |}        {res}960
       {txt}OR {c |}      {res}1,712
       {txt}PA {c |}      {res}5,245
       {txt}RI {c |}        {res}260
       {txt}SC {c |}      {res}1,185
       {txt}SD {c |}        {res}247
       {txt}TN {c |}      {res}1,827
       {txt}TX {c |}      {res}6,767
       {txt}UT {c |}        {res}817
       {txt}VA {c |}      {res}2,356
       {txt}VT {c |}        {res}188
       {txt}WA {c |}      {res}2,706
       {txt}WI {c |}      {res}2,102
       {txt}WV {c |}        {res}382
       {txt}WY {c |}        {res}173
{txt}{hline 10}{c BT}{hline 11}

{com}. describe state year month 

              {txt}storage   display    value
variable name   type    format     label      variable label
{hline}
{p 0 48}{res}{bind:state          }{txt}{bind: str20   }{bind:{txt}%20s      }{space 1}{bind:         }{bind:  }{res}{res}state (2-digit code){p_end}
{p 0 48}{bind:year           }{txt}{bind: int     }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}{p_end}
{p 0 48}{bind:month          }{txt}{bind: float   }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}{p_end}

{com}. clear

. use "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData/stateM.dta"

. describe state year month 

              {txt}storage   display    value
variable name   type    format     label      variable label
{hline}
{p 0 48}{res}{bind:state          }{txt}{bind: str2    }{bind:{txt}%9s       }{space 1}{bind:         }{bind:  }{res}{res}state{p_end}
{p 0 48}{bind:year           }{txt}{bind: int     }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}year{p_end}
{p 0 48}{bind:month          }{txt}{bind: float   }{bind:{txt}%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}{p_end}

{com}. do "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/DoFile/Step01_CleaningSCE.do"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{txt}
{com}. label var Q41 "years of living in the current residence"
{txt}
{com}. label var Q42 "years of living in the current states"
{txt}
{com}. label var Q43 "own/rent/other a house(1/2/3)"
{txt}
{com}. label var Q43a "my/spounser/both's name under which current residence is owned/rent"
{txt}
{com}. label var Q44 "own other homes(1/0)"
{txt}
{com}. label var Q45b "health condition(1-5 from good to poor)"
{txt}
{com}. label var Q45new_1 ""
{txt}
{com}. label var Q45new_2 ""
{txt}
{com}. label var Q45new_3 ""
{txt}
{com}. label var Q45new_4 ""
{txt}
{com}. label var Q45new_5 ""
{txt}
{com}. label var Q45new_6 ""
{txt}
{com}. label var Q45new_7 ""
{txt}
{com}. label var Q45new_8 ""
{txt}
{com}. label var Q45new_9 ""
{txt}
{com}. label var Q46 "financial decision making of household(1-5, together to individual)"
{txt}
{com}. label var Q47 "total pre-tax household income from y-1 to y(1-11, low to high)"
{txt}
{com}. label var D1 "same household as last year(1/0)"
{txt}
{com}. label var D3 "date of moving to the current residence(month/year)"
{txt}
{com}. label var D6 "total pre-tax household income from y-1 to y(1-11,low to high)"
{txt}
{com}. label var D2new_1 "memeber in the current resident:spounse/partner"
{txt}
{com}. label var D2new_2 "memeber in the current resident: child >25"
{txt}
{com}. label var D2new_3 "memeber in the current resident: child 18-24"
{txt}
{com}. label var D2new_4 "memeber in the current resident: child 6-17"
{txt}
{com}. label var D2new_5 "memeber in the current resident: child <=5 "
{txt}
{com}. label var D2new_6 "memeber in the current resident: own/sponse's parents"
{txt}
{com}. label var D2new_7 "memeber in the current resident:other relatives"
{txt}
{com}. label var D2new_8 "memeber in the current resident:non-relatives"
{txt}
{com}. label var DSAME "same job as last year in survey"
{txt}
{com}. label var DQ38 "living as a partner or married with some one(1/0)"
{txt}
{com}. label var Q48 "interesting/uninteresting of the questions in the survey(1/0)"
{txt}
{com}. 
. 
. ** Only keep useful variables so that the data file is smaller. 
. 
. global keeplist date year month userid tenure weight ///        
>        Q24_cent25 Q24_cent50 Q24_cent75 Q24_var Q24_mean Q24_iqr ///
>            Q24_bin1 Q24_bin2 Q24_bin3 Q24_bin4 Q24_bin5 Q24_bin6 Q24_bin7 Q24_bin8 Q24_bin9 Q24_bin10 ///
>            Q32 Q33 Q34 Q35_1 Q35_2 Q35_3 Q35_4 Q35_5 Q35_6 Q36 Q37 Q38 ///
>            HH2_1 HH2_2 HH2_3 HH2_4 HH2_5 HH2_6 HH2_7 HH2_8 HH2_9 HH2_10 HH2_11 ///
>            _STATE Q41 Q42 Q43 Q43a Q44 Q45b ///
>            Q45new_1 Q45new_2 Q45new_3 Q45new_4 Q45new_5 Q45new_6 Q45new_7 Q45new_8 Q45new_9 ///
>            Q46 Q47 D1 D3 D6 D2new_1 D2new_2 D2new_3 D2new_4 D2new_5 D2new_6 D2new_7 D2new_8 D2newdk_1 DSAME DQ38 ///
>            DHH2_1 DHH2_2 DHH2_3 DHH2_4 DHH2_5 DHH2_6 DHH2_7 DHH2_8 DHH2_9 DHH2_10 DHH2_11 DHH2_11_other D5b Q48 QRA1 QRA2 ///
>            _AGE_CAT _NUM_CAT _REGION_CAT _COMMUTING_ZONE _EDU_CAT _HH_INC_CAT ///
>            Q1 Q2 Q3 Q4new Q5new Q6new Q9_mean Q9_var ///
>            Q10_1 Q10_2 Q10_3 Q10_4 Q10_5 Q10_6 Q10_7 Q10_8 Q10_9 Q10_10 Q11 Q12new Q13new Q14new ///
>            Q25v2 Q25v2part2 Q31v2 Q31v2part2 C1_mean C1_var ///
>            Q26v2 Q26v2part2
{txt}
{com}.  
. keep ${c -(}keeplist{c )-}
{txt}
{com}. 
. *************************
. *** Merge with state level 
. *************************
. 
. rename _STATE state 
{res}{txt}
{com}. merge m:1 state year month using "${c -(}otherdata{c )-}stateM.dta"
{res}{txt}{p 0 7 2}
(note: variable
state was 
str2, now str20 to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
month was 
byte, now float to accommodate using data's values)
{p_end}

{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}         121,656
{txt}{col 9}from master{col 30}{res}          95,034{txt}  (_merge==1)
{col 9}from using{col 30}{res}          26,622{txt}  (_merge==2)

{col 5}matched{col 30}{res}               0{txt}  (_merge==3)
{col 5}{hline 41}

{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. count 
{res}121656

{com}. do "/var/folders/k3/fzq0vzzx2b56ypvhsddgs7hr0000gn/T//SD02567.000000"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{txt}
{com}. label var Q41 "years of living in the current residence"
{txt}
{com}. label var Q42 "years of living in the current states"
{txt}
{com}. label var Q43 "own/rent/other a house(1/2/3)"
{txt}
{com}. label var Q43a "my/spounser/both's name under which current residence is owned/rent"
{txt}
{com}. label var Q44 "own other homes(1/0)"
{txt}
{com}. label var Q45b "health condition(1-5 from good to poor)"
{txt}
{com}. label var Q45new_1 ""
{txt}
{com}. label var Q45new_2 ""
{txt}
{com}. label var Q45new_3 ""
{txt}
{com}. label var Q45new_4 ""
{txt}
{com}. label var Q45new_5 ""
{txt}
{com}. label var Q45new_6 ""
{txt}
{com}. label var Q45new_7 ""
{txt}
{com}. label var Q45new_8 ""
{txt}
{com}. label var Q45new_9 ""
{txt}
{com}. label var Q46 "financial decision making of household(1-5, together to individual)"
{txt}
{com}. label var Q47 "total pre-tax household income from y-1 to y(1-11, low to high)"
{txt}
{com}. label var D1 "same household as last year(1/0)"
{txt}
{com}. label var D3 "date of moving to the current residence(month/year)"
{txt}
{com}. label var D6 "total pre-tax household income from y-1 to y(1-11,low to high)"
{txt}
{com}. label var D2new_1 "memeber in the current resident:spounse/partner"
{txt}
{com}. label var D2new_2 "memeber in the current resident: child >25"
{txt}
{com}. label var D2new_3 "memeber in the current resident: child 18-24"
{txt}
{com}. label var D2new_4 "memeber in the current resident: child 6-17"
{txt}
{com}. label var D2new_5 "memeber in the current resident: child <=5 "
{txt}
{com}. label var D2new_6 "memeber in the current resident: own/sponse's parents"
{txt}
{com}. label var D2new_7 "memeber in the current resident:other relatives"
{txt}
{com}. label var D2new_8 "memeber in the current resident:non-relatives"
{txt}
{com}. label var DSAME "same job as last year in survey"
{txt}
{com}. label var DQ38 "living as a partner or married with some one(1/0)"
{txt}
{com}. label var Q48 "interesting/uninteresting of the questions in the survey(1/0)"
{txt}
{com}. 
. 
. ** Only keep useful variables so that the data file is smaller. 
. 
. global keeplist date year month userid tenure weight ///        
>        Q24_cent25 Q24_cent50 Q24_cent75 Q24_var Q24_mean Q24_iqr ///
>            Q24_bin1 Q24_bin2 Q24_bin3 Q24_bin4 Q24_bin5 Q24_bin6 Q24_bin7 Q24_bin8 Q24_bin9 Q24_bin10 ///
>            Q32 Q33 Q34 Q35_1 Q35_2 Q35_3 Q35_4 Q35_5 Q35_6 Q36 Q37 Q38 ///
>            HH2_1 HH2_2 HH2_3 HH2_4 HH2_5 HH2_6 HH2_7 HH2_8 HH2_9 HH2_10 HH2_11 ///
>            _STATE Q41 Q42 Q43 Q43a Q44 Q45b ///
>            Q45new_1 Q45new_2 Q45new_3 Q45new_4 Q45new_5 Q45new_6 Q45new_7 Q45new_8 Q45new_9 ///
>            Q46 Q47 D1 D3 D6 D2new_1 D2new_2 D2new_3 D2new_4 D2new_5 D2new_6 D2new_7 D2new_8 D2newdk_1 DSAME DQ38 ///
>            DHH2_1 DHH2_2 DHH2_3 DHH2_4 DHH2_5 DHH2_6 DHH2_7 DHH2_8 DHH2_9 DHH2_10 DHH2_11 DHH2_11_other D5b Q48 QRA1 QRA2 ///
>            _AGE_CAT _NUM_CAT _REGION_CAT _COMMUTING_ZONE _EDU_CAT _HH_INC_CAT ///
>            Q1 Q2 Q3 Q4new Q5new Q6new Q9_mean Q9_var ///
>            Q10_1 Q10_2 Q10_3 Q10_4 Q10_5 Q10_6 Q10_7 Q10_8 Q10_9 Q10_10 Q11 Q12new Q13new Q14new ///
>            Q25v2 Q25v2part2 Q31v2 Q31v2part2 C1_mean C1_var ///
>            Q26v2 Q26v2part2
{txt}
{com}.  
. keep ${c -(}keeplist{c )-}
{txt}
{com}. 
. *************************
. *** Merge with state level 
. *************************
. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. count if state=="AL"
{err}state not found
{txt}{search r(111):r(111);}

{com}.  count if _STATE=="AL"
{res} 1222

{com}. clear

. use "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData/stateM.dta"

.  count if _STATE=="AL"
{err}_STATE not found
{txt}{search r(111):r(111);}

{com}.  count if state=="AL"
{res}  522

{com}. do "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/DoFile/Step01_CleaningSCE.do"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{txt}
{com}. label var Q41 "years of living in the current residence"
{txt}
{com}. label var Q42 "years of living in the current states"
{txt}
{com}. label var Q43 "own/rent/other a house(1/2/3)"
{txt}
{com}. label var Q43a "my/spounser/both's name under which current residence is owned/rent"
{txt}
{com}. label var Q44 "own other homes(1/0)"
{txt}
{com}. label var Q45b "health condition(1-5 from good to poor)"
{txt}
{com}. label var Q45new_1 ""
{txt}
{com}. label var Q45new_2 ""
{txt}
{com}. label var Q45new_3 ""
{txt}
{com}. label var Q45new_4 ""
{txt}
{com}. label var Q45new_5 ""
{txt}
{com}. label var Q45new_6 ""
{txt}
{com}. label var Q45new_7 ""
{txt}
{com}. label var Q45new_8 ""
{txt}
{com}. label var Q45new_9 ""
{txt}
{com}. label var Q46 "financial decision making of household(1-5, together to individual)"
{txt}
{com}. label var Q47 "total pre-tax household income from y-1 to y(1-11, low to high)"
{txt}
{com}. label var D1 "same household as last year(1/0)"
{txt}
{com}. label var D3 "date of moving to the current residence(month/year)"
{txt}
{com}. label var D6 "total pre-tax household income from y-1 to y(1-11,low to high)"
{txt}
{com}. label var D2new_1 "memeber in the current resident:spounse/partner"
{txt}
{com}. label var D2new_2 "memeber in the current resident: child >25"
{txt}
{com}. label var D2new_3 "memeber in the current resident: child 18-24"
{txt}
{com}. label var D2new_4 "memeber in the current resident: child 6-17"
{txt}
{com}. label var D2new_5 "memeber in the current resident: child <=5 "
{txt}
{com}. label var D2new_6 "memeber in the current resident: own/sponse's parents"
{txt}
{com}. label var D2new_7 "memeber in the current resident:other relatives"
{txt}
{com}. label var D2new_8 "memeber in the current resident:non-relatives"
{txt}
{com}. label var DSAME "same job as last year in survey"
{txt}
{com}. label var DQ38 "living as a partner or married with some one(1/0)"
{txt}
{com}. label var Q48 "interesting/uninteresting of the questions in the survey(1/0)"
{txt}
{com}. 
. 
. ** Only keep useful variables so that the data file is smaller. 
. 
. global keeplist date year month userid tenure weight ///        
>        Q24_cent25 Q24_cent50 Q24_cent75 Q24_var Q24_mean Q24_iqr ///
>            Q24_bin1 Q24_bin2 Q24_bin3 Q24_bin4 Q24_bin5 Q24_bin6 Q24_bin7 Q24_bin8 Q24_bin9 Q24_bin10 ///
>            Q32 Q33 Q34 Q35_1 Q35_2 Q35_3 Q35_4 Q35_5 Q35_6 Q36 Q37 Q38 ///
>            HH2_1 HH2_2 HH2_3 HH2_4 HH2_5 HH2_6 HH2_7 HH2_8 HH2_9 HH2_10 HH2_11 ///
>            _STATE Q41 Q42 Q43 Q43a Q44 Q45b ///
>            Q45new_1 Q45new_2 Q45new_3 Q45new_4 Q45new_5 Q45new_6 Q45new_7 Q45new_8 Q45new_9 ///
>            Q46 Q47 D1 D3 D6 D2new_1 D2new_2 D2new_3 D2new_4 D2new_5 D2new_6 D2new_7 D2new_8 D2newdk_1 DSAME DQ38 ///
>            DHH2_1 DHH2_2 DHH2_3 DHH2_4 DHH2_5 DHH2_6 DHH2_7 DHH2_8 DHH2_9 DHH2_10 DHH2_11 DHH2_11_other D5b Q48 QRA1 QRA2 ///
>            _AGE_CAT _NUM_CAT _REGION_CAT _COMMUTING_ZONE _EDU_CAT _HH_INC_CAT ///
>            Q1 Q2 Q3 Q4new Q5new Q6new Q9_mean Q9_var ///
>            Q10_1 Q10_2 Q10_3 Q10_4 Q10_5 Q10_6 Q10_7 Q10_8 Q10_9 Q10_10 Q11 Q12new Q13new Q14new ///
>            Q25v2 Q25v2part2 Q31v2 Q31v2part2 C1_mean C1_var ///
>            Q26v2 Q26v2part2
{txt}
{com}.  
. keep ${c -(}keeplist{c )-}
{txt}
{com}. 
. *************************
. *** Merge with state level 
. *************************
. 
. rename _STATE state 
{res}{txt}
{com}. 
. merge m:m year month using "${c -(}otherdata{c )-}stateM.dta"
{res}{txt}{p 0 7 2}
(note: variable
state was 
str2, now str20 to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
month was 
byte, now float to accommodate using data's values)
{p_end}

{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}          22,950
{txt}{col 9}from master{col 30}{res}               0{txt}  (_merge==1)
{col 9}from using{col 30}{res}          22,950{txt}  (_merge==2)

{col 5}matched{col 30}{res}          95,034{txt}  (_merge==3)
{col 5}{hline 41}

{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. use "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData/stateM.dta", clear

. gen state_str = totring(state)
{err}unknown function totring()
{txt}{search r(133):r(133);}

{com}. help tostring

. tostring state,replace
{txt}state already string; no {res}replace

{com}. help tostring

. tostring state,replace ignore(" ") 
{err}option {bf:ignore()} not allowed
{txt}{search r(198):r(198);}

{com}. tostring state, ignore(" ") replace
{err}option {bf:ignore()} not allowed
{txt}{search r(198):r(198);}

{com}. describe state

              {txt}storage   display    value
variable name   type    format     label      variable label
{hline}
{p 0 48}{res}{bind:state          }{txt}{bind: str2    }{bind:{txt}%9s       }{space 1}{bind:         }{bind:  }{res}{res}state{p_end}

{com}. do "/var/folders/k3/fzq0vzzx2b56ypvhsddgs7hr0000gn/T//SD02567.000000"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{txt}
{com}. label var Q41 "years of living in the current residence"
{txt}
{com}. label var Q42 "years of living in the current states"
{txt}
{com}. label var Q43 "own/rent/other a house(1/2/3)"
{txt}
{com}. label var Q43a "my/spounser/both's name under which current residence is owned/rent"
{txt}
{com}. label var Q44 "own other homes(1/0)"
{txt}
{com}. label var Q45b "health condition(1-5 from good to poor)"
{txt}
{com}. label var Q45new_1 ""
{txt}
{com}. label var Q45new_2 ""
{txt}
{com}. label var Q45new_3 ""
{txt}
{com}. label var Q45new_4 ""
{txt}
{com}. label var Q45new_5 ""
{txt}
{com}. label var Q45new_6 ""
{txt}
{com}. label var Q45new_7 ""
{txt}
{com}. label var Q45new_8 ""
{txt}
{com}. label var Q45new_9 ""
{txt}
{com}. label var Q46 "financial decision making of household(1-5, together to individual)"
{txt}
{com}. label var Q47 "total pre-tax household income from y-1 to y(1-11, low to high)"
{txt}
{com}. label var D1 "same household as last year(1/0)"
{txt}
{com}. label var D3 "date of moving to the current residence(month/year)"
{txt}
{com}. label var D6 "total pre-tax household income from y-1 to y(1-11,low to high)"
{txt}
{com}. label var D2new_1 "memeber in the current resident:spounse/partner"
{txt}
{com}. label var D2new_2 "memeber in the current resident: child >25"
{txt}
{com}. label var D2new_3 "memeber in the current resident: child 18-24"
{txt}
{com}. label var D2new_4 "memeber in the current resident: child 6-17"
{txt}
{com}. label var D2new_5 "memeber in the current resident: child <=5 "
{txt}
{com}. label var D2new_6 "memeber in the current resident: own/sponse's parents"
{txt}
{com}. label var D2new_7 "memeber in the current resident:other relatives"
{txt}
{com}. label var D2new_8 "memeber in the current resident:non-relatives"
{txt}
{com}. label var DSAME "same job as last year in survey"
{txt}
{com}. label var DQ38 "living as a partner or married with some one(1/0)"
{txt}
{com}. label var Q48 "interesting/uninteresting of the questions in the survey(1/0)"
{txt}
{com}. 
. 
. ** Only keep useful variables so that the data file is smaller. 
. 
. global keeplist date year month userid tenure weight ///        
>        Q24_cent25 Q24_cent50 Q24_cent75 Q24_var Q24_mean Q24_iqr ///
>            Q24_bin1 Q24_bin2 Q24_bin3 Q24_bin4 Q24_bin5 Q24_bin6 Q24_bin7 Q24_bin8 Q24_bin9 Q24_bin10 ///
>            Q32 Q33 Q34 Q35_1 Q35_2 Q35_3 Q35_4 Q35_5 Q35_6 Q36 Q37 Q38 ///
>            HH2_1 HH2_2 HH2_3 HH2_4 HH2_5 HH2_6 HH2_7 HH2_8 HH2_9 HH2_10 HH2_11 ///
>            _STATE Q41 Q42 Q43 Q43a Q44 Q45b ///
>            Q45new_1 Q45new_2 Q45new_3 Q45new_4 Q45new_5 Q45new_6 Q45new_7 Q45new_8 Q45new_9 ///
>            Q46 Q47 D1 D3 D6 D2new_1 D2new_2 D2new_3 D2new_4 D2new_5 D2new_6 D2new_7 D2new_8 D2newdk_1 DSAME DQ38 ///
>            DHH2_1 DHH2_2 DHH2_3 DHH2_4 DHH2_5 DHH2_6 DHH2_7 DHH2_8 DHH2_9 DHH2_10 DHH2_11 DHH2_11_other D5b Q48 QRA1 QRA2 ///
>            _AGE_CAT _NUM_CAT _REGION_CAT _COMMUTING_ZONE _EDU_CAT _HH_INC_CAT ///
>            Q1 Q2 Q3 Q4new Q5new Q6new Q9_mean Q9_var ///
>            Q10_1 Q10_2 Q10_3 Q10_4 Q10_5 Q10_6 Q10_7 Q10_8 Q10_9 Q10_10 Q11 Q12new Q13new Q14new ///
>            Q25v2 Q25v2part2 Q31v2 Q31v2part2 C1_mean C1_var ///
>            Q26v2 Q26v2part2
{txt}
{com}.  
. keep ${c -(}keeplist{c )-}
{txt}
{com}. 
. *************************
. *** Merge with state level 
. *************************
. 
. rename _STATE state 
{res}{txt}
{com}. 
. merge m:m state using "${c -(}otherdata{c )-}stateM.dta"
{res}{txt}{p 0 7 2}
(note: variable
state was 
str2, now str20 to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
month was 
byte, now float to accommodate using data's values)
{p_end}

{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}         121,656
{txt}{col 9}from master{col 30}{res}          95,034{txt}  (_merge==1)
{col 9}from using{col 30}{res}          26,622{txt}  (_merge==2)

{col 5}matched{col 30}{res}               0{txt}  (_merge==3)
{col 5}{hline 41}

{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. do "/var/folders/k3/fzq0vzzx2b56ypvhsddgs7hr0000gn/T//SD02567.000000"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{txt}
{com}. label var Q41 "years of living in the current residence"
{txt}
{com}. label var Q42 "years of living in the current states"
{txt}
{com}. label var Q43 "own/rent/other a house(1/2/3)"
{txt}
{com}. label var Q43a "my/spounser/both's name under which current residence is owned/rent"
{txt}
{com}. label var Q44 "own other homes(1/0)"
{txt}
{com}. label var Q45b "health condition(1-5 from good to poor)"
{txt}
{com}. label var Q45new_1 ""
{txt}
{com}. label var Q45new_2 ""
{txt}
{com}. label var Q45new_3 ""
{txt}
{com}. label var Q45new_4 ""
{txt}
{com}. label var Q45new_5 ""
{txt}
{com}. label var Q45new_6 ""
{txt}
{com}. label var Q45new_7 ""
{txt}
{com}. label var Q45new_8 ""
{txt}
{com}. label var Q45new_9 ""
{txt}
{com}. label var Q46 "financial decision making of household(1-5, together to individual)"
{txt}
{com}. label var Q47 "total pre-tax household income from y-1 to y(1-11, low to high)"
{txt}
{com}. label var D1 "same household as last year(1/0)"
{txt}
{com}. label var D3 "date of moving to the current residence(month/year)"
{txt}
{com}. label var D6 "total pre-tax household income from y-1 to y(1-11,low to high)"
{txt}
{com}. label var D2new_1 "memeber in the current resident:spounse/partner"
{txt}
{com}. label var D2new_2 "memeber in the current resident: child >25"
{txt}
{com}. label var D2new_3 "memeber in the current resident: child 18-24"
{txt}
{com}. label var D2new_4 "memeber in the current resident: child 6-17"
{txt}
{com}. label var D2new_5 "memeber in the current resident: child <=5 "
{txt}
{com}. label var D2new_6 "memeber in the current resident: own/sponse's parents"
{txt}
{com}. label var D2new_7 "memeber in the current resident:other relatives"
{txt}
{com}. label var D2new_8 "memeber in the current resident:non-relatives"
{txt}
{com}. label var DSAME "same job as last year in survey"
{txt}
{com}. label var DQ38 "living as a partner or married with some one(1/0)"
{txt}
{com}. label var Q48 "interesting/uninteresting of the questions in the survey(1/0)"
{txt}
{com}. 
. 
. ** Only keep useful variables so that the data file is smaller. 
. 
. global keeplist date year month userid tenure weight ///        
>        Q24_cent25 Q24_cent50 Q24_cent75 Q24_var Q24_mean Q24_iqr ///
>            Q24_bin1 Q24_bin2 Q24_bin3 Q24_bin4 Q24_bin5 Q24_bin6 Q24_bin7 Q24_bin8 Q24_bin9 Q24_bin10 ///
>            Q32 Q33 Q34 Q35_1 Q35_2 Q35_3 Q35_4 Q35_5 Q35_6 Q36 Q37 Q38 ///
>            HH2_1 HH2_2 HH2_3 HH2_4 HH2_5 HH2_6 HH2_7 HH2_8 HH2_9 HH2_10 HH2_11 ///
>            _STATE Q41 Q42 Q43 Q43a Q44 Q45b ///
>            Q45new_1 Q45new_2 Q45new_3 Q45new_4 Q45new_5 Q45new_6 Q45new_7 Q45new_8 Q45new_9 ///
>            Q46 Q47 D1 D3 D6 D2new_1 D2new_2 D2new_3 D2new_4 D2new_5 D2new_6 D2new_7 D2new_8 D2newdk_1 DSAME DQ38 ///
>            DHH2_1 DHH2_2 DHH2_3 DHH2_4 DHH2_5 DHH2_6 DHH2_7 DHH2_8 DHH2_9 DHH2_10 DHH2_11 DHH2_11_other D5b Q48 QRA1 QRA2 ///
>            _AGE_CAT _NUM_CAT _REGION_CAT _COMMUTING_ZONE _EDU_CAT _HH_INC_CAT ///
>            Q1 Q2 Q3 Q4new Q5new Q6new Q9_mean Q9_var ///
>            Q10_1 Q10_2 Q10_3 Q10_4 Q10_5 Q10_6 Q10_7 Q10_8 Q10_9 Q10_10 Q11 Q12new Q13new Q14new ///
>            Q25v2 Q25v2part2 Q31v2 Q31v2part2 C1_mean C1_var ///
>            Q26v2 Q26v2part2
{txt}
{com}.  
. keep ${c -(}keeplist{c )-}
{txt}
{com}. 
. *************************
. *** Merge with state level 
. *************************
. 
. rename _STATE state 
{res}{txt}
{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. duplicates drop state,force

{p 0 4}{txt}Duplicates in terms of {res} state{p_end}

{txt}(94982 observations deleted)

{com}. count 
{res}   52

{com}. merge 1:m state using "${c -(}otherdata{c )-}stateM.dta"
{res}{txt}{p 0 7 2}
(note: variable
state was 
str2, now str20 to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
month was 
byte, now float to accommodate using data's values)
{p_end}

{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}          26,674
{txt}{col 9}from master{col 30}{res}              52{txt}  (_merge==1)
{col 9}from using{col 30}{res}          26,622{txt}  (_merge==2)

{col 5}matched{col 30}{res}               0{txt}  (_merge==3)
{col 5}{hline 41}

{com}. clear

. use "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData/stateM.dta"

. levelsof stae
{err}variable stae not found
{txt}{search r(111):r(111);}

{com}. levelsof state
{txt}`"AK"' `"AL"' `"AR"' `"AZ"' `"CA"' `"CO"' `"CT"' `"DC"' `"DE"' `"FL"' `"GA"' `"HI"' `"IA"' `"ID"' `"IL"' `"IN"' `"KS"' `"KY"' `"LA"' `"MA"' `"MD"' `"ME"' `"MI"' `"MN"' `"MO"' `"MS"' `"MT"' `"NC"' `"ND"' `"NE"' `"NH"' `"NJ"' `"NM"' `"NV"' `"NY"' `"OH"' `"OK"' `"OR"' `"PA"' `"RI"' `"SC"' `"SD"' `"TN"' `"TX"' `"UT"' `"VA"' `"VT"' `"WA"' `"WI"' `"WV"' `"WY"'

{com}. clear

. do "/var/folders/k3/fzq0vzzx2b56ypvhsddgs7hr0000gn/T//SD02567.000000"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{txt}
{com}. label var Q41 "years of living in the current residence"
{txt}
{com}. label var Q42 "years of living in the current states"
{txt}
{com}. label var Q43 "own/rent/other a house(1/2/3)"
{txt}
{com}. label var Q43a "my/spounser/both's name under which current residence is owned/rent"
{txt}
{com}. label var Q44 "own other homes(1/0)"
{txt}
{com}. label var Q45b "health condition(1-5 from good to poor)"
{txt}
{com}. label var Q45new_1 ""
{txt}
{com}. label var Q45new_2 ""
{txt}
{com}. label var Q45new_3 ""
{txt}
{com}. label var Q45new_4 ""
{txt}
{com}. label var Q45new_5 ""
{txt}
{com}. label var Q45new_6 ""
{txt}
{com}. label var Q45new_7 ""
{txt}
{com}. label var Q45new_8 ""
{txt}
{com}. label var Q45new_9 ""
{txt}
{com}. label var Q46 "financial decision making of household(1-5, together to individual)"
{txt}
{com}. label var Q47 "total pre-tax household income from y-1 to y(1-11, low to high)"
{txt}
{com}. label var D1 "same household as last year(1/0)"
{txt}
{com}. label var D3 "date of moving to the current residence(month/year)"
{txt}
{com}. label var D6 "total pre-tax household income from y-1 to y(1-11,low to high)"
{txt}
{com}. label var D2new_1 "memeber in the current resident:spounse/partner"
{txt}
{com}. label var D2new_2 "memeber in the current resident: child >25"
{txt}
{com}. label var D2new_3 "memeber in the current resident: child 18-24"
{txt}
{com}. label var D2new_4 "memeber in the current resident: child 6-17"
{txt}
{com}. label var D2new_5 "memeber in the current resident: child <=5 "
{txt}
{com}. label var D2new_6 "memeber in the current resident: own/sponse's parents"
{txt}
{com}. label var D2new_7 "memeber in the current resident:other relatives"
{txt}
{com}. label var D2new_8 "memeber in the current resident:non-relatives"
{txt}
{com}. label var DSAME "same job as last year in survey"
{txt}
{com}. label var DQ38 "living as a partner or married with some one(1/0)"
{txt}
{com}. label var Q48 "interesting/uninteresting of the questions in the survey(1/0)"
{txt}
{com}. 
. 
. ** Only keep useful variables so that the data file is smaller. 
. 
. global keeplist date year month userid tenure weight ///        
>        Q24_cent25 Q24_cent50 Q24_cent75 Q24_var Q24_mean Q24_iqr ///
>            Q24_bin1 Q24_bin2 Q24_bin3 Q24_bin4 Q24_bin5 Q24_bin6 Q24_bin7 Q24_bin8 Q24_bin9 Q24_bin10 ///
>            Q32 Q33 Q34 Q35_1 Q35_2 Q35_3 Q35_4 Q35_5 Q35_6 Q36 Q37 Q38 ///
>            HH2_1 HH2_2 HH2_3 HH2_4 HH2_5 HH2_6 HH2_7 HH2_8 HH2_9 HH2_10 HH2_11 ///
>            _STATE Q41 Q42 Q43 Q43a Q44 Q45b ///
>            Q45new_1 Q45new_2 Q45new_3 Q45new_4 Q45new_5 Q45new_6 Q45new_7 Q45new_8 Q45new_9 ///
>            Q46 Q47 D1 D3 D6 D2new_1 D2new_2 D2new_3 D2new_4 D2new_5 D2new_6 D2new_7 D2new_8 D2newdk_1 DSAME DQ38 ///
>            DHH2_1 DHH2_2 DHH2_3 DHH2_4 DHH2_5 DHH2_6 DHH2_7 DHH2_8 DHH2_9 DHH2_10 DHH2_11 DHH2_11_other D5b Q48 QRA1 QRA2 ///
>            _AGE_CAT _NUM_CAT _REGION_CAT _COMMUTING_ZONE _EDU_CAT _HH_INC_CAT ///
>            Q1 Q2 Q3 Q4new Q5new Q6new Q9_mean Q9_var ///
>            Q10_1 Q10_2 Q10_3 Q10_4 Q10_5 Q10_6 Q10_7 Q10_8 Q10_9 Q10_10 Q11 Q12new Q13new Q14new ///
>            Q25v2 Q25v2part2 Q31v2 Q31v2part2 C1_mean C1_var ///
>            Q26v2 Q26v2part2
{txt}
{com}.  
. keep ${c -(}keeplist{c )-}
{txt}
{com}. 
. *************************
. *** Merge with state level 
. *************************
. 
. rename _STATE state 
{res}{txt}
{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. levelsof state
{txt}`"AK"' `"AL"' `"AR"' `"AZ"' `"CA"' `"CO"' `"CT"' `"DC"' `"DE"' `"FL"' `"GA"' `"HI"' `"IA"' `"ID"' `"IL"' `"IN"' `"KS"' `"KY"' `"LA"' `"MA"' `"MD"' `"ME"' `"MI"' `"MN"' `"MO"' `"MS"' `"MT"' `"NC"' `"ND"' `"NE"' `"NH"' `"NJ"' `"NM"' `"NV"' `"NY"' `"OH"' `"OK"' `"OR"' `"PA"' `"RI"' `"SC"' `"SD"' `"TN"' `"TX"' `"UT"' `"VA"' `"VT"' `"WA"' `"WI"' `"WV"' `"WY"'

{com}. use "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData/stateM.dta", clear

. clear

. 
. import excel "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData/statecode.xlsx", sheet("Sheet1") firstrow
{res}
{com}. save statecode.dta
{txt}file statecode.dta saved

{com}. do "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/DoFile/Step01_CleaningSCE.do"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{txt}
{com}. label var Q41 "years of living in the current residence"
{txt}
{com}. label var Q42 "years of living in the current states"
{txt}
{com}. label var Q43 "own/rent/other a house(1/2/3)"
{txt}
{com}. label var Q43a "my/spounser/both's name under which current residence is owned/rent"
{txt}
{com}. label var Q44 "own other homes(1/0)"
{txt}
{com}. label var Q45b "health condition(1-5 from good to poor)"
{txt}
{com}. label var Q45new_1 ""
{txt}
{com}. label var Q45new_2 ""
{txt}
{com}. label var Q45new_3 ""
{txt}
{com}. label var Q45new_4 ""
{txt}
{com}. label var Q45new_5 ""
{txt}
{com}. label var Q45new_6 ""
{txt}
{com}. label var Q45new_7 ""
{txt}
{com}. label var Q45new_8 ""
{txt}
{com}. label var Q45new_9 ""
{txt}
{com}. label var Q46 "financial decision making of household(1-5, together to individual)"
{txt}
{com}. label var Q47 "total pre-tax household income from y-1 to y(1-11, low to high)"
{txt}
{com}. label var D1 "same household as last year(1/0)"
{txt}
{com}. label var D3 "date of moving to the current residence(month/year)"
{txt}
{com}. label var D6 "total pre-tax household income from y-1 to y(1-11,low to high)"
{txt}
{com}. label var D2new_1 "memeber in the current resident:spounse/partner"
{txt}
{com}. label var D2new_2 "memeber in the current resident: child >25"
{txt}
{com}. label var D2new_3 "memeber in the current resident: child 18-24"
{txt}
{com}. label var D2new_4 "memeber in the current resident: child 6-17"
{txt}
{com}. label var D2new_5 "memeber in the current resident: child <=5 "
{txt}
{com}. label var D2new_6 "memeber in the current resident: own/sponse's parents"
{txt}
{com}. label var D2new_7 "memeber in the current resident:other relatives"
{txt}
{com}. label var D2new_8 "memeber in the current resident:non-relatives"
{txt}
{com}. label var DSAME "same job as last year in survey"
{txt}
{com}. label var DQ38 "living as a partner or married with some one(1/0)"
{txt}
{com}. label var Q48 "interesting/uninteresting of the questions in the survey(1/0)"
{txt}
{com}. 
. 
. ** Only keep useful variables so that the data file is smaller. 
. 
. global keeplist date year month userid tenure weight ///        
>        Q24_cent25 Q24_cent50 Q24_cent75 Q24_var Q24_mean Q24_iqr ///
>            Q24_bin1 Q24_bin2 Q24_bin3 Q24_bin4 Q24_bin5 Q24_bin6 Q24_bin7 Q24_bin8 Q24_bin9 Q24_bin10 ///
>            Q32 Q33 Q34 Q35_1 Q35_2 Q35_3 Q35_4 Q35_5 Q35_6 Q36 Q37 Q38 ///
>            HH2_1 HH2_2 HH2_3 HH2_4 HH2_5 HH2_6 HH2_7 HH2_8 HH2_9 HH2_10 HH2_11 ///
>            _STATE Q41 Q42 Q43 Q43a Q44 Q45b ///
>            Q45new_1 Q45new_2 Q45new_3 Q45new_4 Q45new_5 Q45new_6 Q45new_7 Q45new_8 Q45new_9 ///
>            Q46 Q47 D1 D3 D6 D2new_1 D2new_2 D2new_3 D2new_4 D2new_5 D2new_6 D2new_7 D2new_8 D2newdk_1 DSAME DQ38 ///
>            DHH2_1 DHH2_2 DHH2_3 DHH2_4 DHH2_5 DHH2_6 DHH2_7 DHH2_8 DHH2_9 DHH2_10 DHH2_11 DHH2_11_other D5b Q48 QRA1 QRA2 ///
>            _AGE_CAT _NUM_CAT _REGION_CAT _COMMUTING_ZONE _EDU_CAT _HH_INC_CAT ///
>            Q1 Q2 Q3 Q4new Q5new Q6new Q9_mean Q9_var ///
>            Q10_1 Q10_2 Q10_3 Q10_4 Q10_5 Q10_6 Q10_7 Q10_8 Q10_9 Q10_10 Q11 Q12new Q13new Q14new ///
>            Q25v2 Q25v2part2 Q31v2 Q31v2part2 C1_mean C1_var ///
>            Q26v2 Q26v2part2
{txt}
{com}.  
. keep ${c -(}keeplist{c )-}
{txt}
{com}. 
. *************************
. *** Merge with state level 
. *************************
. 
. rename _STATE state 
{res}{txt}
{com}. 
. 
. merge m:1 state using "${c -(}otherdata{c )-}statecode.dta"
{res}{err}{p 0 4 2}
file statecode.dta
not found
{p_end}
{txt}{search r(601):r(601);}

end of do-file

{search r(601):r(601);}

{com}. do "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/DoFile/Step00_PrepareStateData.do"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. import excel "${c -(}folder{c )-}laus.xlsx", sheet("Sheet1") firstrow clear
{res}{txt}
{com}. 
. gen month_new = .
{txt}(26622 missing values generated)

{com}. replace month_new =1 if month=="Jan"
{txt}(2244 real changes made)

{com}. replace month_new = 2 if month =="Feb"
{txt}(2244 real changes made)

{com}. replace month_new = 3 if month=="Mar"
{txt}(2244 real changes made)

{com}. replace month_new = 4 if month=="Apr"
{txt}(2244 real changes made)

{com}. replace month_new = 5 if month == "May"
{txt}(2244 real changes made)

{com}. replace month_new = 6 if month =="Jun"
{txt}(2244 real changes made)

{com}. replace month_new = 7 if month=="Jul"
{txt}(2193 real changes made)

{com}. replace month_new = 8 if month =="Aug"
{txt}(2193 real changes made)

{com}. replace month_new = 9 if month=="Sep"
{txt}(2193 real changes made)

{com}. replace month_new =10 if month=="Oct"
{txt}(2193 real changes made)

{com}. replace month_new = 11 if month =="Nov"
{txt}(2193 real changes made)

{com}. replace month_new = 12 if month =="Dec"
{txt}(2193 real changes made)

{com}. drop month
{txt}
{com}. rename month_new month
{res}{txt}
{com}. order state year month
{txt}
{com}. 
. rename state statename 
{res}{txt}
{com}. rename stateabbr state
{res}{txt}
{com}. save stateM.dta,replace
{txt}file stateM.dta saved

{com}. 
. import excel "${c -(}folder{c )-}data_quarter.xlsx", sheet("Sheet1") firstrow clear
{res}{txt}
{com}. 
. expand 3
{txt}(14076 observations created)

{com}. sort state year quarter
{txt}
{com}. bysort state year quarter: gen month =(quarter-1)*3+_n
{txt}
{com}. order state statecode year quarter month
{txt}
{com}. 
. merge 1:1 state year month using "${c -(}folder{c )-}stateM.dta", keep(match master using) 
{res}
{txt}{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}           5,508
{txt}{col 9}from master{col 30}{res}               0{txt}  (_merge==1)
{col 9}from using{col 30}{res}           5,508{txt}  (_merge==2)

{col 5}matched{col 30}{res}          21,114{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename _merge state_merge
{res}{txt}
{com}. 
. ******************
. ** date       ****
. ******************
. 
. save stateM,replace 
{txt}file stateM.dta saved

{com}. 
. 
. import excel "${c -(}folder{c )-}statecode.xlsx", sheet("Sheet1") firstrow clear 
{res}{txt}
{com}. save statecode.dta
{err}{p 0 4 2}
file statecode.dta
already exists
{p_end}
{txt}{search r(602):r(602);}

end of do-file

{search r(602):r(602);}

{com}. do "/var/folders/k3/fzq0vzzx2b56ypvhsddgs7hr0000gn/T//SD02567.000000"
{txt}
{com}. 
. import excel "${c -(}folder{c )-}statecode.xlsx", sheet("Sheet1") firstrow clear 
{res}{txt}
{com}. save "${c -(}folder{c )-}statecode.dta",replace 
{txt}file /Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData/statecode.dta saved

{com}. 
{txt}end of do-file

{com}. clear

. do "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/DoFile/Step01_CleaningSCE.do"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{txt}
{com}. label var Q41 "years of living in the current residence"
{txt}
{com}. label var Q42 "years of living in the current states"
{txt}
{com}. label var Q43 "own/rent/other a house(1/2/3)"
{txt}
{com}. label var Q43a "my/spounser/both's name under which current residence is owned/rent"
{txt}
{com}. label var Q44 "own other homes(1/0)"
{txt}
{com}. label var Q45b "health condition(1-5 from good to poor)"
{txt}
{com}. label var Q45new_1 ""
{txt}
{com}. label var Q45new_2 ""
{txt}
{com}. label var Q45new_3 ""
{txt}
{com}. label var Q45new_4 ""
{txt}
{com}. label var Q45new_5 ""
{txt}
{com}. label var Q45new_6 ""
{txt}
{com}. label var Q45new_7 ""
{txt}
{com}. label var Q45new_8 ""
{txt}
{com}. label var Q45new_9 ""
{txt}
{com}. label var Q46 "financial decision making of household(1-5, together to individual)"
{txt}
{com}. label var Q47 "total pre-tax household income from y-1 to y(1-11, low to high)"
{txt}
{com}. label var D1 "same household as last year(1/0)"
{txt}
{com}. label var D3 "date of moving to the current residence(month/year)"
{txt}
{com}. label var D6 "total pre-tax household income from y-1 to y(1-11,low to high)"
{txt}
{com}. label var D2new_1 "memeber in the current resident:spounse/partner"
{txt}
{com}. label var D2new_2 "memeber in the current resident: child >25"
{txt}
{com}. label var D2new_3 "memeber in the current resident: child 18-24"
{txt}
{com}. label var D2new_4 "memeber in the current resident: child 6-17"
{txt}
{com}. label var D2new_5 "memeber in the current resident: child <=5 "
{txt}
{com}. label var D2new_6 "memeber in the current resident: own/sponse's parents"
{txt}
{com}. label var D2new_7 "memeber in the current resident:other relatives"
{txt}
{com}. label var D2new_8 "memeber in the current resident:non-relatives"
{txt}
{com}. label var DSAME "same job as last year in survey"
{txt}
{com}. label var DQ38 "living as a partner or married with some one(1/0)"
{txt}
{com}. label var Q48 "interesting/uninteresting of the questions in the survey(1/0)"
{txt}
{com}. 
. 
. ** Only keep useful variables so that the data file is smaller. 
. 
. global keeplist date year month userid tenure weight ///        
>        Q24_cent25 Q24_cent50 Q24_cent75 Q24_var Q24_mean Q24_iqr ///
>            Q24_bin1 Q24_bin2 Q24_bin3 Q24_bin4 Q24_bin5 Q24_bin6 Q24_bin7 Q24_bin8 Q24_bin9 Q24_bin10 ///
>            Q32 Q33 Q34 Q35_1 Q35_2 Q35_3 Q35_4 Q35_5 Q35_6 Q36 Q37 Q38 ///
>            HH2_1 HH2_2 HH2_3 HH2_4 HH2_5 HH2_6 HH2_7 HH2_8 HH2_9 HH2_10 HH2_11 ///
>            _STATE Q41 Q42 Q43 Q43a Q44 Q45b ///
>            Q45new_1 Q45new_2 Q45new_3 Q45new_4 Q45new_5 Q45new_6 Q45new_7 Q45new_8 Q45new_9 ///
>            Q46 Q47 D1 D3 D6 D2new_1 D2new_2 D2new_3 D2new_4 D2new_5 D2new_6 D2new_7 D2new_8 D2newdk_1 DSAME DQ38 ///
>            DHH2_1 DHH2_2 DHH2_3 DHH2_4 DHH2_5 DHH2_6 DHH2_7 DHH2_8 DHH2_9 DHH2_10 DHH2_11 DHH2_11_other D5b Q48 QRA1 QRA2 ///
>            _AGE_CAT _NUM_CAT _REGION_CAT _COMMUTING_ZONE _EDU_CAT _HH_INC_CAT ///
>            Q1 Q2 Q3 Q4new Q5new Q6new Q9_mean Q9_var ///
>            Q10_1 Q10_2 Q10_3 Q10_4 Q10_5 Q10_6 Q10_7 Q10_8 Q10_9 Q10_10 Q11 Q12new Q13new Q14new ///
>            Q25v2 Q25v2part2 Q31v2 Q31v2part2 C1_mean C1_var ///
>            Q26v2 Q26v2part2
{txt}
{com}.  
. keep ${c -(}keeplist{c )-}
{txt}
{com}. 
. *************************
. *** Merge with state level 
. *************************
. 
. rename _STATE state 
{res}{txt}
{com}. 
. 
. merge m:1 state using "${c -(}otherdata{c )-}statecode.dta"
{res}{err}{p 0 4 2}
file statecode.dta
not found
{p_end}
{txt}{search r(601):r(601);}

end of do-file

{search r(601):r(601);}

{com}. do "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/DoFile/Step01_CleaningSCE.do"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{txt}
{com}. label var Q41 "years of living in the current residence"
{txt}
{com}. label var Q42 "years of living in the current states"
{txt}
{com}. label var Q43 "own/rent/other a house(1/2/3)"
{txt}
{com}. label var Q43a "my/spounser/both's name under which current residence is owned/rent"
{txt}
{com}. label var Q44 "own other homes(1/0)"
{txt}
{com}. label var Q45b "health condition(1-5 from good to poor)"
{txt}
{com}. label var Q45new_1 ""
{txt}
{com}. label var Q45new_2 ""
{txt}
{com}. label var Q45new_3 ""
{txt}
{com}. label var Q45new_4 ""
{txt}
{com}. label var Q45new_5 ""
{txt}
{com}. label var Q45new_6 ""
{txt}
{com}. label var Q45new_7 ""
{txt}
{com}. label var Q45new_8 ""
{txt}
{com}. label var Q45new_9 ""
{txt}
{com}. label var Q46 "financial decision making of household(1-5, together to individual)"
{txt}
{com}. label var Q47 "total pre-tax household income from y-1 to y(1-11, low to high)"
{txt}
{com}. label var D1 "same household as last year(1/0)"
{txt}
{com}. label var D3 "date of moving to the current residence(month/year)"
{txt}
{com}. label var D6 "total pre-tax household income from y-1 to y(1-11,low to high)"
{txt}
{com}. label var D2new_1 "memeber in the current resident:spounse/partner"
{txt}
{com}. label var D2new_2 "memeber in the current resident: child >25"
{txt}
{com}. label var D2new_3 "memeber in the current resident: child 18-24"
{txt}
{com}. label var D2new_4 "memeber in the current resident: child 6-17"
{txt}
{com}. label var D2new_5 "memeber in the current resident: child <=5 "
{txt}
{com}. label var D2new_6 "memeber in the current resident: own/sponse's parents"
{txt}
{com}. label var D2new_7 "memeber in the current resident:other relatives"
{txt}
{com}. label var D2new_8 "memeber in the current resident:non-relatives"
{txt}
{com}. label var DSAME "same job as last year in survey"
{txt}
{com}. label var DQ38 "living as a partner or married with some one(1/0)"
{txt}
{com}. label var Q48 "interesting/uninteresting of the questions in the survey(1/0)"
{txt}
{com}. 
. 
. ** Only keep useful variables so that the data file is smaller. 
. 
. global keeplist date year month userid tenure weight ///        
>        Q24_cent25 Q24_cent50 Q24_cent75 Q24_var Q24_mean Q24_iqr ///
>            Q24_bin1 Q24_bin2 Q24_bin3 Q24_bin4 Q24_bin5 Q24_bin6 Q24_bin7 Q24_bin8 Q24_bin9 Q24_bin10 ///
>            Q32 Q33 Q34 Q35_1 Q35_2 Q35_3 Q35_4 Q35_5 Q35_6 Q36 Q37 Q38 ///
>            HH2_1 HH2_2 HH2_3 HH2_4 HH2_5 HH2_6 HH2_7 HH2_8 HH2_9 HH2_10 HH2_11 ///
>            _STATE Q41 Q42 Q43 Q43a Q44 Q45b ///
>            Q45new_1 Q45new_2 Q45new_3 Q45new_4 Q45new_5 Q45new_6 Q45new_7 Q45new_8 Q45new_9 ///
>            Q46 Q47 D1 D3 D6 D2new_1 D2new_2 D2new_3 D2new_4 D2new_5 D2new_6 D2new_7 D2new_8 D2newdk_1 DSAME DQ38 ///
>            DHH2_1 DHH2_2 DHH2_3 DHH2_4 DHH2_5 DHH2_6 DHH2_7 DHH2_8 DHH2_9 DHH2_10 DHH2_11 DHH2_11_other D5b Q48 QRA1 QRA2 ///
>            _AGE_CAT _NUM_CAT _REGION_CAT _COMMUTING_ZONE _EDU_CAT _HH_INC_CAT ///
>            Q1 Q2 Q3 Q4new Q5new Q6new Q9_mean Q9_var ///
>            Q10_1 Q10_2 Q10_3 Q10_4 Q10_5 Q10_6 Q10_7 Q10_8 Q10_9 Q10_10 Q11 Q12new Q13new Q14new ///
>            Q25v2 Q25v2part2 Q31v2 Q31v2part2 C1_mean C1_var ///
>            Q26v2 Q26v2part2
{txt}
{com}.  
. keep ${c -(}keeplist{c )-}
{txt}
{com}. 
. *************************
. *** Merge with state level 
. *************************
. 
. rename _STATE state 
{res}{txt}
{com}. 
. 
. merge m:1 state using "${c -(}otherfolder{c )-}statecode.dta"
{res}
{txt}{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}             176
{txt}{col 9}from master{col 30}{res}             175{txt}  (_merge==1)
{col 9}from using{col 30}{res}               1{txt}  (_merge==2)

{col 5}matched{col 30}{res}          94,859{txt}  (_merge==3)
{col 5}{hline 41}

{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. clear

. use "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData/statecode.dta"

. clear

. use "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData/stateM.dta"

. do "/var/folders/k3/fzq0vzzx2b56ypvhsddgs7hr0000gn/T//SD02567.000000"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{txt}
{com}. label var Q41 "years of living in the current residence"
{txt}
{com}. label var Q42 "years of living in the current states"
{txt}
{com}. label var Q43 "own/rent/other a house(1/2/3)"
{txt}
{com}. label var Q43a "my/spounser/both's name under which current residence is owned/rent"
{txt}
{com}. label var Q44 "own other homes(1/0)"
{txt}
{com}. label var Q45b "health condition(1-5 from good to poor)"
{txt}
{com}. label var Q45new_1 ""
{txt}
{com}. label var Q45new_2 ""
{txt}
{com}. label var Q45new_3 ""
{txt}
{com}. label var Q45new_4 ""
{txt}
{com}. label var Q45new_5 ""
{txt}
{com}. label var Q45new_6 ""
{txt}
{com}. label var Q45new_7 ""
{txt}
{com}. label var Q45new_8 ""
{txt}
{com}. label var Q45new_9 ""
{txt}
{com}. label var Q46 "financial decision making of household(1-5, together to individual)"
{txt}
{com}. label var Q47 "total pre-tax household income from y-1 to y(1-11, low to high)"
{txt}
{com}. label var D1 "same household as last year(1/0)"
{txt}
{com}. label var D3 "date of moving to the current residence(month/year)"
{txt}
{com}. label var D6 "total pre-tax household income from y-1 to y(1-11,low to high)"
{txt}
{com}. label var D2new_1 "memeber in the current resident:spounse/partner"
{txt}
{com}. label var D2new_2 "memeber in the current resident: child >25"
{txt}
{com}. label var D2new_3 "memeber in the current resident: child 18-24"
{txt}
{com}. label var D2new_4 "memeber in the current resident: child 6-17"
{txt}
{com}. label var D2new_5 "memeber in the current resident: child <=5 "
{txt}
{com}. label var D2new_6 "memeber in the current resident: own/sponse's parents"
{txt}
{com}. label var D2new_7 "memeber in the current resident:other relatives"
{txt}
{com}. label var D2new_8 "memeber in the current resident:non-relatives"
{txt}
{com}. label var DSAME "same job as last year in survey"
{txt}
{com}. label var DQ38 "living as a partner or married with some one(1/0)"
{txt}
{com}. label var Q48 "interesting/uninteresting of the questions in the survey(1/0)"
{txt}
{com}. 
. 
. ** Only keep useful variables so that the data file is smaller. 
. 
. global keeplist date year month userid tenure weight ///        
>        Q24_cent25 Q24_cent50 Q24_cent75 Q24_var Q24_mean Q24_iqr ///
>            Q24_bin1 Q24_bin2 Q24_bin3 Q24_bin4 Q24_bin5 Q24_bin6 Q24_bin7 Q24_bin8 Q24_bin9 Q24_bin10 ///
>            Q32 Q33 Q34 Q35_1 Q35_2 Q35_3 Q35_4 Q35_5 Q35_6 Q36 Q37 Q38 ///
>            HH2_1 HH2_2 HH2_3 HH2_4 HH2_5 HH2_6 HH2_7 HH2_8 HH2_9 HH2_10 HH2_11 ///
>            _STATE Q41 Q42 Q43 Q43a Q44 Q45b ///
>            Q45new_1 Q45new_2 Q45new_3 Q45new_4 Q45new_5 Q45new_6 Q45new_7 Q45new_8 Q45new_9 ///
>            Q46 Q47 D1 D3 D6 D2new_1 D2new_2 D2new_3 D2new_4 D2new_5 D2new_6 D2new_7 D2new_8 D2newdk_1 DSAME DQ38 ///
>            DHH2_1 DHH2_2 DHH2_3 DHH2_4 DHH2_5 DHH2_6 DHH2_7 DHH2_8 DHH2_9 DHH2_10 DHH2_11 DHH2_11_other D5b Q48 QRA1 QRA2 ///
>            _AGE_CAT _NUM_CAT _REGION_CAT _COMMUTING_ZONE _EDU_CAT _HH_INC_CAT ///
>            Q1 Q2 Q3 Q4new Q5new Q6new Q9_mean Q9_var ///
>            Q10_1 Q10_2 Q10_3 Q10_4 Q10_5 Q10_6 Q10_7 Q10_8 Q10_9 Q10_10 Q11 Q12new Q13new Q14new ///
>            Q25v2 Q25v2part2 Q31v2 Q31v2part2 C1_mean C1_var ///
>            Q26v2 Q26v2part2
{txt}
{com}.  
. keep ${c -(}keeplist{c )-}
{txt}
{com}. 
. *************************
. *** Merge with state level 
. *************************
. 
. rename _STATE state 
{res}{txt}
{com}. 
. 
. merge m:1 state using "${c -(}otherfolder{c )-}statecode.dta"
{res}
{txt}{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}             176
{txt}{col 9}from master{col 30}{res}             175{txt}  (_merge==1)
{col 9}from using{col 30}{res}               1{txt}  (_merge==2)

{col 5}matched{col 30}{res}          94,859{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename _merge state_code_merge 
{res}{txt}
{com}. 
. merge m:1 statecode year month using "${c -(}otherfolder{c )-}stateM.dta",keep(master match) 
{res}{txt}{p 0 7 2}
(note: variable
month was 
byte, now float to accommodate using data's values)
{p_end}
{err}{p 0 4 2}
variable{err}s{err} statecode
year
month
do not uniquely identify observations in the
using data
{p_end}
{txt}{search r(459):r(459);}

end of do-file

{search r(459):r(459);}

{com}. use "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData/stateM.dta", clear

. duplicates report statecode year month 

{p 0 4}{txt}Duplicates in terms of {res} statecode year month{p_end}

{txt}{hline 10}{c TT}{hline 27}
   copies {c |} observations       surplus
{hline 10}{c +}{hline 27}
        1 {c |}        {res}21114             0
       {txt}51 {c |}         {res}5508          5400
{txt}{hline 10}{c BT}{hline 27}

{com}. duplicates drop statecode year month,force

{p 0 4}{txt}Duplicates in terms of {res} statecode year month{p_end}

{txt}(5400 observations deleted)

{com}. do "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/DoFile/Step00_PrepareStateData.do"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. import excel "${c -(}folder{c )-}laus.xlsx", sheet("Sheet1") firstrow clear
{res}{txt}
{com}. 
. gen month_new = .
{txt}(26622 missing values generated)

{com}. replace month_new =1 if month=="Jan"
{txt}(2244 real changes made)

{com}. replace month_new = 2 if month =="Feb"
{txt}(2244 real changes made)

{com}. replace month_new = 3 if month=="Mar"
{txt}(2244 real changes made)

{com}. replace month_new = 4 if month=="Apr"
{txt}(2244 real changes made)

{com}. replace month_new = 5 if month == "May"
{txt}(2244 real changes made)

{com}. replace month_new = 6 if month =="Jun"
{txt}(2244 real changes made)

{com}. replace month_new = 7 if month=="Jul"
{txt}(2193 real changes made)

{com}. replace month_new = 8 if month =="Aug"
{txt}(2193 real changes made)

{com}. replace month_new = 9 if month=="Sep"
{txt}(2193 real changes made)

{com}. replace month_new =10 if month=="Oct"
{txt}(2193 real changes made)

{com}. replace month_new = 11 if month =="Nov"
{txt}(2193 real changes made)

{com}. replace month_new = 12 if month =="Dec"
{txt}(2193 real changes made)

{com}. drop month
{txt}
{com}. rename month_new month
{res}{txt}
{com}. order state year month
{txt}
{com}. 
. rename state statename 
{res}{txt}
{com}. rename stateabbr state
{res}{txt}
{com}. save stateM.dta,replace
{txt}file stateM.dta saved

{com}. 
. import excel "${c -(}folder{c )-}data_quarter.xlsx", sheet("Sheet1") firstrow clear
{res}{txt}
{com}. 
. expand 3
{txt}(14076 observations created)

{com}. sort state year quarter
{txt}
{com}. bysort state year quarter: gen month =(quarter-1)*3+_n
{txt}
{com}. order state statecode year quarter month
{txt}
{com}. 
. merge 1:1 state year month using "${c -(}folder{c )-}stateM.dta", keep(match master using) 
{res}
{txt}{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}           5,508
{txt}{col 9}from master{col 30}{res}               0{txt}  (_merge==1)
{col 9}from using{col 30}{res}           5,508{txt}  (_merge==2)

{col 5}matched{col 30}{res}          21,114{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename _merge state_merge
{res}{txt}
{com}. 
. duplicates drop statecode year month,force

{p 0 4}{txt}Duplicates in terms of {res} statecode year month{p_end}

{txt}(5400 observations deleted)

{com}. save "${c -(}folder{c )-}stateM.dta",replace 
{txt}file /Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData/stateM.dta saved

{com}. 
. 
. ******************
. ** date       ****
. ******************
. 
. import excel "${c -(}folder{c )-}statecode.xlsx", sheet("Sheet1") firstrow clear 
{res}{txt}
{com}. save "${c -(}folder{c )-}statecode.dta",replace 
{txt}file /Users/Myworld/Dropbox/IncExpProject/WorkingFolder/OtherData/statecode.dta saved

{com}. 
{txt}end of do-file

{com}. do "/var/folders/k3/fzq0vzzx2b56ypvhsddgs7hr0000gn/T//SD02567.000000"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{txt}
{com}. label var Q41 "years of living in the current residence"
{txt}
{com}. label var Q42 "years of living in the current states"
{txt}
{com}. label var Q43 "own/rent/other a house(1/2/3)"
{txt}
{com}. label var Q43a "my/spounser/both's name under which current residence is owned/rent"
{txt}
{com}. label var Q44 "own other homes(1/0)"
{txt}
{com}. label var Q45b "health condition(1-5 from good to poor)"
{txt}
{com}. label var Q45new_1 ""
{txt}
{com}. label var Q45new_2 ""
{txt}
{com}. label var Q45new_3 ""
{txt}
{com}. label var Q45new_4 ""
{txt}
{com}. label var Q45new_5 ""
{txt}
{com}. label var Q45new_6 ""
{txt}
{com}. label var Q45new_7 ""
{txt}
{com}. label var Q45new_8 ""
{txt}
{com}. label var Q45new_9 ""
{txt}
{com}. label var Q46 "financial decision making of household(1-5, together to individual)"
{txt}
{com}. label var Q47 "total pre-tax household income from y-1 to y(1-11, low to high)"
{txt}
{com}. label var D1 "same household as last year(1/0)"
{txt}
{com}. label var D3 "date of moving to the current residence(month/year)"
{txt}
{com}. label var D6 "total pre-tax household income from y-1 to y(1-11,low to high)"
{txt}
{com}. label var D2new_1 "memeber in the current resident:spounse/partner"
{txt}
{com}. label var D2new_2 "memeber in the current resident: child >25"
{txt}
{com}. label var D2new_3 "memeber in the current resident: child 18-24"
{txt}
{com}. label var D2new_4 "memeber in the current resident: child 6-17"
{txt}
{com}. label var D2new_5 "memeber in the current resident: child <=5 "
{txt}
{com}. label var D2new_6 "memeber in the current resident: own/sponse's parents"
{txt}
{com}. label var D2new_7 "memeber in the current resident:other relatives"
{txt}
{com}. label var D2new_8 "memeber in the current resident:non-relatives"
{txt}
{com}. label var DSAME "same job as last year in survey"
{txt}
{com}. label var DQ38 "living as a partner or married with some one(1/0)"
{txt}
{com}. label var Q48 "interesting/uninteresting of the questions in the survey(1/0)"
{txt}
{com}. 
. 
. ** Only keep useful variables so that the data file is smaller. 
. 
. global keeplist date year month userid tenure weight ///        
>        Q24_cent25 Q24_cent50 Q24_cent75 Q24_var Q24_mean Q24_iqr ///
>            Q24_bin1 Q24_bin2 Q24_bin3 Q24_bin4 Q24_bin5 Q24_bin6 Q24_bin7 Q24_bin8 Q24_bin9 Q24_bin10 ///
>            Q32 Q33 Q34 Q35_1 Q35_2 Q35_3 Q35_4 Q35_5 Q35_6 Q36 Q37 Q38 ///
>            HH2_1 HH2_2 HH2_3 HH2_4 HH2_5 HH2_6 HH2_7 HH2_8 HH2_9 HH2_10 HH2_11 ///
>            _STATE Q41 Q42 Q43 Q43a Q44 Q45b ///
>            Q45new_1 Q45new_2 Q45new_3 Q45new_4 Q45new_5 Q45new_6 Q45new_7 Q45new_8 Q45new_9 ///
>            Q46 Q47 D1 D3 D6 D2new_1 D2new_2 D2new_3 D2new_4 D2new_5 D2new_6 D2new_7 D2new_8 D2newdk_1 DSAME DQ38 ///
>            DHH2_1 DHH2_2 DHH2_3 DHH2_4 DHH2_5 DHH2_6 DHH2_7 DHH2_8 DHH2_9 DHH2_10 DHH2_11 DHH2_11_other D5b Q48 QRA1 QRA2 ///
>            _AGE_CAT _NUM_CAT _REGION_CAT _COMMUTING_ZONE _EDU_CAT _HH_INC_CAT ///
>            Q1 Q2 Q3 Q4new Q5new Q6new Q9_mean Q9_var ///
>            Q10_1 Q10_2 Q10_3 Q10_4 Q10_5 Q10_6 Q10_7 Q10_8 Q10_9 Q10_10 Q11 Q12new Q13new Q14new ///
>            Q25v2 Q25v2part2 Q31v2 Q31v2part2 C1_mean C1_var ///
>            Q26v2 Q26v2part2
{txt}
{com}.  
. keep ${c -(}keeplist{c )-}
{txt}
{com}. 
. *************************
. *** Merge with state level 
. *************************
. 
. rename _STATE state 
{res}{txt}
{com}. 
. 
. merge m:1 state using "${c -(}otherfolder{c )-}statecode.dta"
{res}
{txt}{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}             176
{txt}{col 9}from master{col 30}{res}             175{txt}  (_merge==1)
{col 9}from using{col 30}{res}               1{txt}  (_merge==2)

{col 5}matched{col 30}{res}          94,859{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename _merge state_code_merge 
{res}{txt}
{com}. 
. merge m:1 statecode year month using "${c -(}otherfolder{c )-}stateM.dta",keep(master match) 
{res}{txt}{p 0 7 2}
(note: variable
month was 
byte, now float to accommodate using data's values)
{p_end}
(label _merge already defined)

{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}             176
{txt}{col 9}from master{col 30}{res}             176{txt}  (_merge==1)
{col 9}from using{col 30}{res}               0{txt}  (_merge==2)

{col 5}matched{col 30}{res}          94,859{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename _merge stateM_merge 
{res}{txt}
{com}. ddd
{err}unrecognized command:  ddd
{txt}{search r(199):r(199);}

end of do-file

{search r(199):r(199);}

{com}. table state if stateM_merge ==1

{txt}{hline 10}{c TT}{hline 11}
state     {c |}
(2-digit  {c |}
code)     {c |}      Freq.
{hline 10}{c +}{hline 11}
       PR {c |}          {res}1
{txt}{hline 10}{c BT}{hline 11}

{com}. do "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/DoFile/Step01_CleaningSCE.do"
{txt}
{com}. ****************************************************
. ***   This do files cleans SCE individual density **
. ***   forecasts and moments. It exclude the top and *
. ***   bottom 5 percentiles of mean and uncertainty. *
. ***   It also plots histograms of mean forecast and *
. ***   uncertainty. **********************************
. *****************************************************
. 
. 
. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global otherfolder "${c -(}mainfolder{c )-}/OtherData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. 
. 
. use "${c -(}folder{c )-}/SCE/NYFED_SCE_2013.dta",clear
{txt}
{com}. append using "${c -(}folder{c )-}/SCE/NYFED_SCE_2014_2016.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str48 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q13new was 
byte, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q19 was 
int, now double to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
byte, now int to accommodate using data's values)
{p_end}

{com}. append using  "${c -(}folder{c )-}/SCE/NYFED_SCE_post2016new.dta",force
{txt}{p 0 7 2}
(note: variable
DHH2_11_other was str83 in the using data, but will be
byte now)
{p_end}
{p 0 7 2}
(note: variable
Q3 was 
byte, now int to accommodate using data's values)
{p_end}
{p 0 7 2}
(note: variable
Q32 was 
int, now double to accommodate using data's values)
{p_end}

{com}. 
. 
. sort date
{txt}
{com}. unique userid
{txt}Number of unique values of userid is  {res}13713
{txt}Number of records is  {res}95034
{txt}
{com}. 
. ********************
. *** Date format ****
. ********************
. gen date_str = string(date)
{txt}
{com}. gen year = substr(date_str,1,4)
{txt}
{com}. gen month = substr(date_str,5,2)
{txt}
{com}. gen date2=year+"m"+month
{txt}
{com}. gen date3= monthly(date2,"YM")
{txt}
{com}. format date3 %tm
{txt}
{com}. drop date_str date2 date
{txt}
{com}. rename date3 date
{res}{txt}
{com}. destring year, replace
{txt}year has all characters numeric; {res}replaced {txt}as {res}int
{txt}
{com}. destring month, replace 
{txt}month has all characters numeric; {res}replaced {txt}as {res}byte
{txt}
{com}. order date year month
{txt}
{com}. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month
{txt}
{com}. 
. **********************
. ** Label variables ***
. **********************
. 
. label var Q1 "finance better or worse(5 vals) from y-1 to y"
{txt}
{com}. label var Q2 "finance better or worse(5 vals) from y to y+1"
{txt}
{com}. label var Q3 "chance of moving (%)"
{txt}
{com}. label var Q4new "chance of UE higher from y to y+1(0-1)"
{txt}
{com}. label var Q5new "chance of saving interest rate higher from y to y+1(%)"
{txt}
{com}. label var Q6new "chance of stock market up from y to y+1(%)"
{txt}
{com}. label var Q8v2 "inflation or deflation from y to y+1 (1/0)"
{txt}
{com}. label var Q8v2part2 "inflation(or deflation) from y to y+1 (%) "
{txt}
{com}. label var Q9_cent25 "25 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent50 "50 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_cent75 "75 percentile of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_var "var of inflation from y to y+1"
{txt}
{com}. label var Q9_iqr "25/75 inter-quantile range of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_mean "mean of inflation from y to y+1(%)"
{txt}
{com}. label var Q9_probdeflation "prob of deflation from y to y+1 (0-1)"
{txt}
{com}. label var Q9_bin1 "density: >12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin2 "density: 8%-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin3 "density: 4%-8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin4 "density: 2%-4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin5 "density: 0%-2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin6 "density: -2%-0% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin7 "density: -4%- -2% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin8 "density: -8%--4% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin9 "density: -12%- -8% inflation from y to y+1(%)"
{txt}
{com}. label var Q9_bin10 "density: <-12% inflation from y to y+1(%)"
{txt}
{com}. label var Q9bv2 "inflation or deflation from y+1 to y+2 (1/0)"
{txt}
{com}. label var Q9bv2part2 "inflation(or deflation) from y+1 to y+2 (%)"
{txt}
{com}. label var Q9c_cent25 "25 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent50 "50 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_cent75 "75 percentile of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_var "var of inflation from y+1 to y+2"
{txt}
{com}. label var Q9c_mean "mean of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_iqr "25/75 inter-quantile range of inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_probdeflation "prob of deflation from y+1 to y+2 (0-1)"
{txt}
{com}. label var Q9c_bin1 "density: >12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin2 "density: 8%-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin3 "density: 4%-8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin4 "density: 2%-4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin5 "density: 0%-2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin6 "density: -2%-0% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin7 "density: -4%- -2% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin8 "density: -8%--4% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin9 "density: -12%- -8% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q9c_bin10 "density: <-12% inflation from y+1 to y+2(%)"
{txt}
{com}. label var Q10_1 "current emp situations:full-time"
{txt}
{com}. label var Q10_2 "current emp situations:part-time"
{txt}
{com}. label var Q10_3 "current emp situations: not working but wants to work"
{txt}
{com}. label var Q10_4 "current emp situations: temporary laid-off"
{txt}
{com}. label var Q10_5 "current emp situations: on sick or other leave"
{txt}
{com}. label var Q10_6 "current emp situations: permanently disabled/unable to work"
{txt}
{com}. label var Q10_7 "current emp situations: retiree or early retiree"
{txt}
{com}. label var Q10_8 "current emp situations: student or in training"
{txt}
{com}. label var Q10_9 "current emp situations: homemaker"
{txt}
{com}. label var Q10_10 "current emp situations: others"
{txt}
{com}. label var Q11 "number of jobs"
{txt}
{com}. label var Q12new "work for someone or self-employed(1/0)"
{txt}
{com}. label var ES1_1 ""
{txt}
{com}. label var ES1_2 ""
{txt}
{com}. label var ES1_3 ""
{txt}
{com}. label var ES1_4 ""
{txt}
{com}. label var ES2 ""
{txt}
{com}. label var ES3new ""
{txt}
{com}. label var ES4 ""
{txt}
{com}. label var ES5 ""
{txt}
{com}. label var Q13new "chance of losing job from y to y+1(%)"
{txt}
{com}. label var Q14new "chance of voluntarily leaving the job from y to y+1(%)"
{txt}
{com}. label var Q15 "currently looking for a job (1/0)"
{txt}
{com}. label var Q16 "duration of unemployment (months)"
{txt}
{com}. label var Q17new "chance of finding and accepting a job from y to y+1(%)"
{txt}
{com}. label var Q18new "chance of finding and accepting a job from m to m+3"
{txt}
{com}. label var Q19 "duration of out of work(%)"
{txt}
{com}. label var Q20new "chance of starting looking for a job from y to y+1(%)"
{txt}
{com}. label var Q21new "chance of starting looking for a job from m to m+3(%)"
{txt}
{com}. label var Q22new "chance of finding a new job if losing the current one within 3 months"
{txt}
{com}. label var Q23v2 "earning increase/decrease from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q23v2part2 "change of earning from the same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent25 "25 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent50 "50 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_cent75 "75 percentile of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_var "var of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_mean "mean of earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_iqr "25/75 inter-quantile range of earning growth of same job/time/place from y to y+1(%)"
{txt}note: label truncated to 80 characters

{com}. label var Q24_probdeflation "???"
{txt}
{com}. label var Q24_bin1 ">12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin2 "8%-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin3 "4%-8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin4 "2%-4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin5 "0-2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin6 "-2%-0 earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin7 "-4%- -2% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin8 "-8% - -4% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin9 "-12%- -8% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q24_bin10 "<-12% earning growth of same job/time/place from y to y+1(%)"
{txt}
{com}. label var Q25v2 "increase/decrease of total household income from y to y+1(1/0)"
{txt}
{com}. label var Q25v2part2 "increase of total household income from y to y+1(%)"
{txt}
{com}. label var Q26v2 "increase/decrease of total household spending from y to y+1(1/0)"
{txt}
{com}. label var Q26v2part2 "increase of total household spending from y to y+1(%)"
{txt}
{com}. label var Q27v2 "increase/decrease of total household tax payment given the same income (1/0)"
{txt}
{com}. label var Q27v2part2 "increase of total household tax payment given the same income (%)"
{txt}
{com}. label var Q28 "easier/harder to get credit/loan from y-1 to y(1-5)"
{txt}
{com}. label var Q29 "easier/harder to get credit/loan from y to y+1(1-5)"
{txt}
{com}. label var Q30new "chance of non-payment of debt from m to m+3(%)"
{txt}
{com}. label var Q31v2 "increase/decrease of nationwide house price(1/0)"
{txt}
{com}. label var Q31v2part2 "increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent25 "25 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent50 "50 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_cent75 "75 percentile of increase of nationwide house price(%)"
{txt}
{com}. label var C1_var "var of increase of nationwide house price"
{txt}
{com}. label var C1_mean "mean of increase of nationwide house price(%)"
{txt}
{com}. label var C1_iqr "25/75 inter-quantile range  of increase of nationwide house price(%)"
{txt}
{com}. label var C1_probdeflation "??"
{txt}
{com}. label var C1_bin1 ">12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin2 "8%-12% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin3 "4%-8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin4 "2%-4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin5 "0-2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin6 "-2%-0% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin7 "-4%- -2% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin8 "-8%- -4% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin9 "-12%- -8% increase in nationwide house price(%)"
{txt}
{com}. label var C1_bin10 "<-12% increase in nationwide house price(%)"
{txt}
{com}. label var C2 "increase/decrease in nationwide house price from y+1 to y+2(1/0)"
{txt}
{com}. label var C2part2 "increase in nationwide house price from y+1 to y+2(%)"
{txt}
{com}. label var C3 "increase/decrease of U.S. gov debt from y to y+1(1/0)"
{txt}
{com}. label var C3part2"increase of U.S. gov debt from y to y+1(%)"
{txt}
{com}. label var C4_1 "increase of a gallon of gas from y to y+1(%)"
{txt}
{com}. label var C4_2 "increase of food price from y to y+1(%)"
{txt}
{com}. label var C4_3 "increase of a medical care from y to y+1(%)"
{txt}
{com}. label var C4_4 "increase of college education from y to y+1(%)"
{txt}
{com}. label var C4_5 "increase of price of renting a typical house/apt from y to y+1(%)"
{txt}
{com}. label var C4_6  "increase of gold price from y to y+1(%)"
{txt}
{com}. label var QNUM1 "num q 1: (correct if ==150)"
{txt}
{com}. label var QNUM2 ""
{txt}
{com}. label var QNUM3 ""
{txt}
{com}. label var QNUM5 ""
{txt}
{com}. label var QNUM6 ""
{txt}
{com}. label var QNUM8 ""
{txt}
{com}. label var QNUM9 ""
{txt}
{com}. label var Q32 "age(in years)"
{txt}
{com}. label var Q33 "gender"
{txt}
{com}. label var Q34 "hispanic/latino/spanish(1/0)"
{txt}
{com}. label var Q35_1 "race: white"
{txt}
{com}. label var Q35_2 "race: black/african american"
{txt}
{com}. label var Q35_3 "race: american indian/alaska native"
{txt}
{com}. label var Q35_4 "race: asian"
{txt}
{com}. label var Q35_5 "race: native hawaiian or other pacific islander"
{txt}
{com}. label var Q35_6 "race: other"
{txt}
{com}. label var Q36 "education (1-8 low to high, 9 other)"
{txt}
{com}. label var Q37 "months of current work"
{txt}
{com}. label var Q38 "living with partner/not (1/0)"
{txt}
{com}. label var HH2_1 "emp of partner: full-time for someone"
{txt}
{com}. label var HH2_2 "emp of partner: part-time for someone"
{txt}
{com}. label var HH2_3 "emp of partner: self-employed"
{txt}
{com}. label var HH2_4 "emp of partner: not working but wants to work"
{txt}
{com}. label var HH2_5 "emp of partner: temporary laid-off"
{txt}
{com}. label var HH2_6 "emp of partner: on sick or other leave"
{txt}
{com}. label var HH2_7 "emp of partner: permanently disabled/unable to work"
{txt}
{com}. label var HH2_8 "emp of partner: retiree or early retiree"
{txt}
{com}. label var HH2_9 "emp of partner: student or in training"
{txt}
{com}. label var HH2_10 "emp of partner: homemaker"
{txt}
{com}. label var HH2_10 "emp of partner: other"
{txt}
{com}. label var _STATE "state (2-digit code)"
{txt}
{com}. label var Q41 "years of living in the current residence"
{txt}
{com}. label var Q42 "years of living in the current states"
{txt}
{com}. label var Q43 "own/rent/other a house(1/2/3)"
{txt}
{com}. label var Q43a "my/spounser/both's name under which current residence is owned/rent"
{txt}
{com}. label var Q44 "own other homes(1/0)"
{txt}
{com}. label var Q45b "health condition(1-5 from good to poor)"
{txt}
{com}. label var Q45new_1 ""
{txt}
{com}. label var Q45new_2 ""
{txt}
{com}. label var Q45new_3 ""
{txt}
{com}. label var Q45new_4 ""
{txt}
{com}. label var Q45new_5 ""
{txt}
{com}. label var Q45new_6 ""
{txt}
{com}. label var Q45new_7 ""
{txt}
{com}. label var Q45new_8 ""
{txt}
{com}. label var Q45new_9 ""
{txt}
{com}. label var Q46 "financial decision making of household(1-5, together to individual)"
{txt}
{com}. label var Q47 "total pre-tax household income from y-1 to y(1-11, low to high)"
{txt}
{com}. label var D1 "same household as last year(1/0)"
{txt}
{com}. label var D3 "date of moving to the current residence(month/year)"
{txt}
{com}. label var D6 "total pre-tax household income from y-1 to y(1-11,low to high)"
{txt}
{com}. label var D2new_1 "memeber in the current resident:spounse/partner"
{txt}
{com}. label var D2new_2 "memeber in the current resident: child >25"
{txt}
{com}. label var D2new_3 "memeber in the current resident: child 18-24"
{txt}
{com}. label var D2new_4 "memeber in the current resident: child 6-17"
{txt}
{com}. label var D2new_5 "memeber in the current resident: child <=5 "
{txt}
{com}. label var D2new_6 "memeber in the current resident: own/sponse's parents"
{txt}
{com}. label var D2new_7 "memeber in the current resident:other relatives"
{txt}
{com}. label var D2new_8 "memeber in the current resident:non-relatives"
{txt}
{com}. label var DSAME "same job as last year in survey"
{txt}
{com}. label var DQ38 "living as a partner or married with some one(1/0)"
{txt}
{com}. label var Q48 "interesting/uninteresting of the questions in the survey(1/0)"
{txt}
{com}. 
. 
. ** Only keep useful variables so that the data file is smaller. 
. 
. global keeplist date year month userid tenure weight ///        
>        Q24_cent25 Q24_cent50 Q24_cent75 Q24_var Q24_mean Q24_iqr ///
>            Q24_bin1 Q24_bin2 Q24_bin3 Q24_bin4 Q24_bin5 Q24_bin6 Q24_bin7 Q24_bin8 Q24_bin9 Q24_bin10 ///
>            Q32 Q33 Q34 Q35_1 Q35_2 Q35_3 Q35_4 Q35_5 Q35_6 Q36 Q37 Q38 ///
>            HH2_1 HH2_2 HH2_3 HH2_4 HH2_5 HH2_6 HH2_7 HH2_8 HH2_9 HH2_10 HH2_11 ///
>            _STATE Q41 Q42 Q43 Q43a Q44 Q45b ///
>            Q45new_1 Q45new_2 Q45new_3 Q45new_4 Q45new_5 Q45new_6 Q45new_7 Q45new_8 Q45new_9 ///
>            Q46 Q47 D1 D3 D6 D2new_1 D2new_2 D2new_3 D2new_4 D2new_5 D2new_6 D2new_7 D2new_8 D2newdk_1 DSAME DQ38 ///
>            DHH2_1 DHH2_2 DHH2_3 DHH2_4 DHH2_5 DHH2_6 DHH2_7 DHH2_8 DHH2_9 DHH2_10 DHH2_11 DHH2_11_other D5b Q48 QRA1 QRA2 ///
>            _AGE_CAT _NUM_CAT _REGION_CAT _COMMUTING_ZONE _EDU_CAT _HH_INC_CAT ///
>            Q1 Q2 Q3 Q4new Q5new Q6new Q9_mean Q9_var ///
>            Q10_1 Q10_2 Q10_3 Q10_4 Q10_5 Q10_6 Q10_7 Q10_8 Q10_9 Q10_10 Q11 Q12new Q13new Q14new ///
>            Q25v2 Q25v2part2 Q31v2 Q31v2part2 C1_mean C1_var ///
>            Q26v2 Q26v2part2
{txt}
{com}.  
. keep ${c -(}keeplist{c )-}
{txt}
{com}. 
. *************************
. *** Merge with state level 
. *************************
. 
. rename _STATE state 
{res}{txt}
{com}. 
. 
. merge m:1 state using "${c -(}otherfolder{c )-}statecode.dta"
{res}
{txt}{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}             176
{txt}{col 9}from master{col 30}{res}             175{txt}  (_merge==1)
{col 9}from using{col 30}{res}               1{txt}  (_merge==2)

{col 5}matched{col 30}{res}          94,859{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename _merge state_code_merge 
{res}{txt}
{com}. 
. merge m:1 statecode year month using "${c -(}otherfolder{c )-}stateM.dta",keep(master match) 
{res}{txt}{p 0 7 2}
(note: variable
month was 
byte, now float to accommodate using data's values)
{p_end}
(label _merge already defined)

{col 5}Result{col 38}# of obs.
{col 5}{hline 41}
{col 5}not matched{col 30}{res}             176
{txt}{col 9}from master{col 30}{res}             176{txt}  (_merge==1)
{col 9}from using{col 30}{res}               0{txt}  (_merge==2)

{col 5}matched{col 30}{res}          94,859{txt}  (_merge==3)
{col 5}{hline 41}

{com}. rename _merge stateM_merge 
{res}{txt}
{com}. 
. *************************
. *** Exclude outliers ****
. *************************
. 
. local Moments Q24_mean Q24_var Q9_mean Q9_var 
{txt}
{com}. 
. foreach var in `Moments'{c -(}
{txt}  2{com}.       egen `var'pl=pctile(`var'),p(5)
{txt}  3{com}.           egen `var'pu=pctile(`var'),p(95)
{txt}  4{com}.           replace `var' = . if `var' <`var'pl | (`var' >`var'pu & `var'!=.)
{txt}  5{com}. {c )-}
{txt}(6114 real changes made, 6114 to missing)
(6195 real changes made, 6195 to missing)
(8887 real changes made, 8887 to missing)
(7131 real changes made, 7131 to missing)

{com}. 
. 
. foreach var in Q24{c -(}
{txt}  2{com}. foreach mom in mean var{c -(}
{txt}  3{com}.     * nominal 
.      egen `var'_`mom'p75 =pctile(`var'_`mom'),p(75) by(year month)
{txt}  4{com}.          egen `var'_`mom'p25 =pctile(`var'_`mom'),p(25) by(year month)
{txt}  5{com}.          egen `var'_`mom'p50 =pctile(`var'_`mom'),p(50) by(year month)
{txt}  6{com}.          local lb: variable label `var'_`mom'
{txt}  7{com}.          label var `var'_`mom'p75 "`lb': 75 pctile"
{txt}  8{com}.          label var `var'_`mom'p25 "`lb': 25 pctile"
{txt}  9{com}.          label var `var'_`mom'p50 "`lb': 50 pctile"
{txt} 10{com}. {c )-}
{txt} 11{com}. {c )-}
{txt}(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)
(1 missing value generated)

{com}. 
. 
. *************************
. *** Nominal to real *****
. *************************
. gen Q24_rmean = Q24_mean - Q9_mean 
{txt}(42912 missing values generated)

{com}. label var Q24_rmean "mean of real earning growth of same job/time/place from y to y+1(%) "
{txt}
{com}. 
. gen Q24_rvar = Q24_var + Q9_var 
{txt}(41669 missing values generated)

{com}. label var Q24_rvar "variance of real earning growth of same job/time/place from y to y+1(%) "
{txt}
{com}. 
. *************************
. *** Other Measures *****
. *************************
. 
. 
. egen Q24_sd = sd(Q24_mean), by(date)
{txt}(1 missing value generated)

{com}. gen Q24_disg = Q24_sd^2
{txt}(1 missing value generated)

{com}. label var Q24_disg "Disagreements of 1-yr-ahead expted income growth"
{txt}
{com}. 
. 
. egen Q24_rsd = sd(Q24_rmean), by(date)
{txt}(1 missing value generated)

{com}. gen Q24_rdisg = Q24_rsd^2
{txt}(1 missing value generated)

{com}. label var Q24_rdisg "Disagreements of 1-yr-ahead real expted income growth"
{txt}
{com}. 
. 
. ***************************************************
. **** Fill the age/education for the same household
. *************************************************
. 
. 
. sort userid date 
{txt}
{com}. 
. replace Q32 = Q32[_n-1] if Q32==. & userid == userid[_n-1] 
{txt}(81273 real changes made)

{com}. replace Q36 = Q36[_n-1] if Q36==. & userid == userid[_n-1]
{txt}(81312 real changes made)

{com}. replace Q33 = Q33[_n-1] if Q33==. & userid == userid[_n-1] & D1==1
{txt}(67679 real changes made)

{com}. replace Q47 = Q47[_n-1] if Q47==. & userid ==userid[_n-1] & D1 ==1 
{txt}(66958 real changes made)

{com}. 
. ***************************************************
. **** Winsorization
. *************************************************
. 
. drop if Q32 > 70 | Q32 < 20 /*age greater than 100 */ 
{txt}(9183 observations deleted)

{com}. 
. ***************************************************
. **** create cohort 
. *************************************************
. 
. gen byear = year - Q32
{txt}
{com}. label var byear "year of birth"
{txt}
{com}. 
. egen byear_gr = cut(byear), group(5)
{txt}
{com}. label var byear_gr "cohort by year of birth"
{txt}
{com}. 
. label define byear_grlb 0 "1952" 1 "1961" 2 "1970" 3 "1980" 4 "1998"
{txt}
{com}. label value byear_gr byear_grlb
{txt}
{com}. 
. save "${c -(}folder{c )-}/SCE/IncExpSCEProbIndM",replace 
{txt}file /Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData//SCE/IncExpSCEProbIndM.dta saved

{com}. 
. 
. 
. ***************************************
. **   Histograms of Moments  ***********
. ** Maybe replaced by kernel desntiy **
. ***************************************
. 
. * for forecasting
. 
. gen SCE_mean = .
{txt}(85852 missing values generated)

{com}. gen SCE_var = .
{txt}(85852 missing values generated)

{com}. 
. /*
> * Kernal density plot only 
> 
> label var Q24_mean "1-yr-ahead forecast of income growth "
> 
>  foreach var in SCE{c -(}
>  foreach mom in mean{c -(}
>     replace `var'_`mom' = Q24_`mom'
>         local lb: variable label Q24_`mom'
>     twoway (kdensity `var'_`mom',lcolor(red) lwidth(thick) ), ///
>                by(year,title("Distribution of `lb'",size(med)) note("")) xtitle("Mean forecast") ///
>                    ytitle("Fraction of population")
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
> {c )-}
> {c )-}
> 
> * Kernal density plot only 
> 
> 
> label var Q24_var "1-yr-ahead uncertainty of income growth"
> 
> foreach mom in var{c -(}
> foreach var in SCE{c -(}
>     replace `var'_`mom' = Q24_`mom'
>         local lb: variable label Q24_`mom'
>     twoway (kdensity `var'_`mom',lcolor(blue) lwidth(thick)), ///
>                by(year,title("Distribution of `lb'",size(med)) note("")) xtitle("Uncertainty") ///
>                    ytitle("Fraction of population")
>         graph export "${c -(}sum_graph_folder{c )-}/hist/`var'`mom'_hist", as(png) replace 
> {c )-}
> {c )-}
> 
> */
. 
. *************************
. *** Population SCE ******
. *************************
. 
. local Moments Q24_mean Q24_var Q24_iqr Q24_cent50 Q24_disg 
{txt}
{com}. local rMoments Q24_rmean Q24_rvar Q24_rdisg 
{txt}
{com}. local MomentsMom Q24_meanp25 Q24_meanp50 Q24_meanp75 Q24_varp25 Q24_varp50 Q24_varp75
{txt}
{com}. 
. 
. collapse (mean) `Moments' `rMoments' `MomentsMom', by(date year month)
{txt}
{com}. 
. label var Q24_mean "Average 1-yr-ahead expected earning growth(%)"
{txt}
{com}. label var Q24_var "Average Uncertainty of 1-yr-ahead expected earning growth"
{txt}
{com}. label var Q24_iqr "Average 25/75 IQR of 1-yr-ahead expected earning growth(%)"
{txt}
{com}. label var Q24_cent50 "Average Median of 1-yr-ahead expected earning growth(%)"
{txt}
{com}. label var Q24_disg "Disagreements of 1-yr-ahead expected earning growth"
{txt}
{com}. 
. 
. label var Q24_rmean "Average 1-yr-ahead expected real earning growth(%)"
{txt}
{com}. label var Q24_rvar "Average Uncertainty of 1-yr-ahead real expected earning growth"
{txt}
{com}. label var Q24_rdisg "Disagreements of 1-yr-ahead expected real earning growth"
{txt}
{com}. 
. save "${c -(}folder{c )-}/SCE/IncExpSCEProbPopM",replace 
{txt}file /Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData//SCE/IncExpSCEProbPopM.dta saved

{com}. 
. 
. 
. 
{txt}end of do-file

{com}. clear

. use "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData/SCE/IncExpSCEProbIndM.dta"

. xtset userid date
{res}{txt}{col 8}panel variable:  {res}userid (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month

{com}. xtreg Q24_var wage_growth
{err}variable wage_growth not found
{txt}{search r(111):r(111);}

{com}. hist wagegrowth
{txt}(bin={res}49{txt}, start={res}-7.94{txt}, width={res}.37204082{txt})
{res}
{com}. xtreg Q24_var wagegrowth
{res}
{txt}Random-effects GLS regression                   Number of obs      = {res}    55383
{txt}Group variable: {res}userid                          {txt}Number of groups   = {res}     9259

{txt}R-sq:  within  = {res}0.0000                         {txt}Obs per group: min = {res}        1
{txt}       between = {res}0.0001                                        {txt}avg = {res}      6.0
{txt}       overall = {res}0.0000                                        {txt}max = {res}       12

                                                {txt}Wald chi2({res}1{txt})       = {res}     0.11
{txt}corr(u_i, X)   = {res}0{txt} (assumed)                    Prob > chi2        =    {res}0.7371

{txt}{hline 13}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 1}     Q24_var{col 14}{c |}      Coef.{col 26}   Std. Err.{col 38}      z{col 46}   P>|z|{col 54}     [95% Con{col 67}f. Interval]
{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{space 2}wagegrowth {c |}{col 14}{res}{space 2} .0063499{col 26}{space 2} .0189137{col 37}{space 1}    0.34{col 46}{space 3}0.737{col 54}{space 4}-.0307204{col 67}{space 3} .0434201
{txt}{space 7}_cons {c |}{col 14}{res}{space 2}  6.06858{col 26}{space 2} .1133554{col 37}{space 1}   53.54{col 46}{space 3}0.000{col 54}{space 4} 5.846407{col 67}{space 3} 6.290752
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
     sigma_u {c |} {res} 8.8985709
     {txt}sigma_e {c |} {res} 8.1245025
         {txt}rho {c |} {res} .54537789{txt}   (fraction of variance due to u_i)
{hline 13}{c BT}{hline 64}

{com}. xtreg Q24_var wage_growth, fe
{err}variable wage_growth not found
{txt}{search r(111):r(111);}

{com}. xtreg Q24_var wagegrowth, fe

{txt}Fixed-effects (within) regression               Number of obs      = {res}    55383
{txt}Group variable: {res}userid                          {txt}Number of groups   = {res}     9259

{txt}R-sq:  within  = {res}0.0000                         {txt}Obs per group: min = {res}        1
{txt}       between = {res}0.0001                                        {txt}avg = {res}      6.0
{txt}       overall = {res}0.0000                                        {txt}max = {res}       12

                                                {txt}F({res}1{txt},{res}46123{txt})         = {res}     0.04
{txt}corr(u_i, Xb)  = {res}0.0015                         {txt}Prob > F           =    {res}0.8472

{txt}{hline 13}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 1}     Q24_var{col 14}{c |}      Coef.{col 26}   Std. Err.{col 38}      t{col 46}   P>|t|{col 54}     [95% Con{col 67}f. Interval]
{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{space 2}wagegrowth {c |}{col 14}{res}{space 2} .0037658{col 26}{space 2} .0195459{col 37}{space 1}    0.19{col 46}{space 3}0.847{col 54}{space 4}-.0345445{col 67}{space 3} .0420761
{txt}{space 7}_cons {c |}{col 14}{res}{space 2} 5.495986{col 26}{space 2}  .061073{col 37}{space 1}   89.99{col 46}{space 3}0.000{col 54}{space 4} 5.376282{col 67}{space 3}  5.61569
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
     sigma_u {c |} {res} 10.118015
     {txt}sigma_e {c |} {res} 8.1245025
         {txt}rho {c |} {res}  .6079888{txt}   (fraction of variance due to u_i)
{hline 13}{c BT}{hline 64}
F test that all u_i=0:     F({res}9258{txt}, {res}46123{txt}) = {res}    6.13         {txt}Prob > F = {res}0.0000

{com}. preserve

. collapse Q24_var Q24_iqr unemp_rate wagegrowth, by(state date)

. scatter Q24_var wagegrowth
{res}
{com}. scatter Q24_var unemp_rate
{res}
{com}. reg Q24_var unemp_rate

      {txt}Source {c |}       SS       df       MS              Number of obs ={res}    3529
{txt}{hline 13}{char +}{hline 30}           F(  1,  3527) ={res}   13.20
    {txt}   Model {char |} {res} 328.310465     1  328.310465           {txt}Prob > F      = {res} 0.0003
    {txt}Residual {char |} {res} 87748.0647  3527  24.8789523           {txt}R-squared     = {res} 0.0037
{txt}{hline 13}{char +}{hline 30}           Adj R-squared = {res} 0.0034
    {txt}   Total {char |} {res} 88076.3752  3528   24.964959           {txt}Root MSE      = {res} 4.9879

{txt}{hline 13}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 1}     Q24_var{col 14}{c |}      Coef.{col 26}   Std. Err.{col 38}      t{col 46}   P>|t|{col 54}     [95% Con{col 67}f. Interval]
{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{space 2}unemp_rate {c |}{col 14}{res}{space 2} .2185486{col 26}{space 2} .0601619{col 37}{space 1}    3.63{col 46}{space 3}0.000{col 54}{space 4} .1005929{col 67}{space 3} .3365043
{txt}{space 7}_cons {c |}{col 14}{res}{space 2} 4.224869{col 26}{space 2} .3011905{col 37}{space 1}   14.03{col 46}{space 3}0.000{col 54}{space 4} 3.634344{col 67}{space 3} 4.815394
{txt}{hline 13}{c BT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}
{com}. reg Q24_var wagegrowth

      {txt}Source {c |}       SS       df       MS              Number of obs ={res}    3529
{txt}{hline 13}{char +}{hline 30}           F(  1,  3527) ={res}    0.49
    {txt}   Model {char |} {res} 12.2571051     1  12.2571051           {txt}Prob > F      = {res} 0.4836
    {txt}Residual {char |} {res} 88064.1181  3527   24.968562           {txt}R-squared     = {res} 0.0001
{txt}{hline 13}{char +}{hline 30}           Adj R-squared = {res}-0.0001
    {txt}   Total {char |} {res} 88076.3752  3528   24.964959           {txt}Root MSE      = {res} 4.9969

{txt}{hline 13}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 1}     Q24_var{col 14}{c |}      Coef.{col 26}   Std. Err.{col 38}      t{col 46}   P>|t|{col 54}     [95% Con{col 67}f. Interval]
{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{space 2}wagegrowth {c |}{col 14}{res}{space 2}-.0278811{col 26}{space 2} .0397935{col 37}{space 1}   -0.70{col 46}{space 3}0.484{col 54}{space 4}-.1059016{col 67}{space 3} .0501395
{txt}{space 7}_cons {c |}{col 14}{res}{space 2} 5.345428{col 26}{space 2} .1303908{col 37}{space 1}   41.00{col 46}{space 3}0.000{col 54}{space 4} 5.089779{col 67}{space 3} 5.601077
{txt}{hline 13}{c BT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}
{com}. xtset statecode date
{err}variable statecode not found
{txt}{search r(111):r(111);}

{com}. xtset statecode state
{err}variable statecode not found
{txt}{search r(111):r(111);}

{com}. xtset state date
{err}varlist:  state:  string variable not allowed
{txt}{search r(109):r(109);}

{com}. restore

. collapse Q24_var Q24_iqr unemp_rate wagegrowth, by(statecode date)

. xtset statecode date
{res}{txt}{col 8}panel variable:  {res}statecode (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}date, 2013m6 to 2019m5, but with gaps
{txt}{col 17}delta:  {res}1 month

{com}. gen unemp_rate_gr = unemp_rate - l1.unemp_rate
{txt}(133 missing values generated)

{com}. scatter Q24_iqr  unemp_rate_gr 
{res}
{com}. reg Q24_iqr  unemp_rate_gr 

      {txt}Source {c |}       SS       df       MS              Number of obs ={res}    3487
{txt}{hline 13}{char +}{hline 30}           F(  1,  3485) ={res}    1.61
    {txt}   Model {char |} {res} 3.83575541     1  3.83575541           {txt}Prob > F      = {res} 0.2043
    {txt}Residual {char |} {res} 8292.97446  3485  2.37961965           {txt}R-squared     = {res} 0.0005
{txt}{hline 13}{char +}{hline 30}           Adj R-squared = {res} 0.0002
    {txt}   Total {char |} {res} 8296.81022  3486  2.38003736           {txt}Root MSE      = {res} 1.5426

{txt}{hline 14}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 1}      Q24_iqr{col 15}{c |}      Coef.{col 27}   Std. Err.{col 39}      t{col 47}   P>|t|{col 55}     [95% Con{col 68}f. Interval]
{hline 14}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
unemp_rate_gr {c |}{col 15}{res}{space 2} .5594258{col 27}{space 2} .4406267{col 38}{space 1}    1.27{col 47}{space 3}0.204{col 55}{space 4}-.3044867{col 68}{space 3} 1.423338
{txt}{space 8}_cons {c |}{col 15}{res}{space 2} 3.053517{col 27}{space 2} .0329748{col 38}{space 1}   92.60{col 47}{space 3}0.000{col 55}{space 4} 2.988865{col 68}{space 3} 3.118169
{txt}{hline 14}{c BT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}
{com}. reg Q24_var l1.wagegrowth

      {txt}Source {c |}       SS       df       MS              Number of obs ={res}    3471
{txt}{hline 13}{char +}{hline 30}           F(  1,  3469) ={res}    3.87
    {txt}   Model {char |} {res}  97.215289     1   97.215289           {txt}Prob > F      = {res} 0.0491
    {txt}Residual {char |} {res} 87064.9688  3469   25.098002           {txt}R-squared     = {res} 0.0011
{txt}{hline 13}{char +}{hline 30}           Adj R-squared = {res} 0.0008
    {txt}   Total {char |} {res} 87162.1841  3470   25.118785           {txt}Root MSE      = {res} 5.0098

{txt}{hline 13}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 1}     Q24_var{col 14}{c |}      Coef.{col 26}   Std. Err.{col 38}      t{col 46}   P>|t|{col 54}     [95% Con{col 67}f. Interval]
{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{space 2}wagegrowth {c |}
{space 9}L1. {c |}{col 14}{res}{space 2}-.0790625{col 26}{space 2} .0401719{col 37}{space 1}   -1.97{col 46}{space 3}0.049{col 54}{space 4}-.1578256{col 67}{space 3}-.0002995
{txt}{space 12} {c |}
{space 7}_cons {c |}{col 14}{res}{space 2}  5.48787{col 26}{space 2} .1312888{col 37}{space 1}   41.80{col 46}{space 3}0.000{col 54}{space 4} 5.230459{col 67}{space 3} 5.745281
{txt}{hline 13}{c BT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}
{com}. reg Q24_var l2.wagegrowth

      {txt}Source {c |}       SS       df       MS              Number of obs ={res}    3419
{txt}{hline 13}{char +}{hline 30}           F(  1,  3417) ={res}    6.76
    {txt}   Model {char |} {res} 165.792999     1  165.792999           {txt}Prob > F      = {res} 0.0094
    {txt}Residual {char |} {res} 83851.1923  3417  24.5394183           {txt}R-squared     = {res} 0.0020
{txt}{hline 13}{char +}{hline 30}           Adj R-squared = {res} 0.0017
    {txt}   Total {char |} {res} 84016.9853  3418  24.5807447           {txt}Root MSE      = {res} 4.9537

{txt}{hline 13}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 1}     Q24_var{col 14}{c |}      Coef.{col 26}   Std. Err.{col 38}      t{col 46}   P>|t|{col 54}     [95% Con{col 67}f. Interval]
{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{space 2}wagegrowth {c |}
{space 9}L2. {c |}{col 14}{res}{space 2}-.1037366{col 26}{space 2} .0399099{col 37}{space 1}   -2.60{col 46}{space 3}0.009{col 54}{space 4}-.1819863{col 67}{space 3}-.0254868
{txt}{space 12} {c |}
{space 7}_cons {c |}{col 14}{res}{space 2} 5.548061{col 26}{space 2} .1299405{col 37}{space 1}   42.70{col 46}{space 3}0.000{col 54}{space 4} 5.293292{col 67}{space 3}  5.80283
{txt}{hline 13}{c BT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}
{com}. reg Q24_var l3.wagegrowth

      {txt}Source {c |}       SS       df       MS              Number of obs ={res}    3365
{txt}{hline 13}{char +}{hline 30}           F(  1,  3363) ={res}    6.29
    {txt}   Model {char |} {res} 148.641706     1  148.641706           {txt}Prob > F      = {res} 0.0122
    {txt}Residual {char |} {res} 79493.0372  3363  23.6375371           {txt}R-squared     = {res} 0.0019
{txt}{hline 13}{char +}{hline 30}           Adj R-squared = {res} 0.0016
    {txt}   Total {char |} {res} 79641.6789  3364  23.6746965           {txt}Root MSE      = {res} 4.8618

{txt}{hline 13}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 1}     Q24_var{col 14}{c |}      Coef.{col 26}   Std. Err.{col 38}      t{col 46}   P>|t|{col 54}     [95% Con{col 67}f. Interval]
{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{space 2}wagegrowth {c |}
{space 9}L3. {c |}{col 14}{res}{space 2}-.0985079{col 26}{space 2} .0392828{col 37}{space 1}   -2.51{col 46}{space 3}0.012{col 54}{space 4}-.1755285{col 67}{space 3}-.0214874
{txt}{space 12} {c |}
{space 7}_cons {c |}{col 14}{res}{space 2} 5.517825{col 26}{space 2} .1282472{col 37}{space 1}   43.02{col 46}{space 3}0.000{col 54}{space 4} 5.266375{col 67}{space 3} 5.769275
{txt}{hline 13}{c BT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{res}
{com}. xtreg Q24_var l2.wagegrowth,fe

{txt}Fixed-effects (within) regression               Number of obs      = {res}     3419
{txt}Group variable: {res}statecode                       {txt}Number of groups   = {res}       51

{txt}R-sq:  within  = {res}0.0019                         {txt}Obs per group: min = {res}       35
{txt}       between = {res}0.0021                                        {txt}avg = {res}     67.0
{txt}       overall = {res}0.0020                                        {txt}max = {res}       70

                                                {txt}F({res}1{txt},{res}3367{txt})          = {res}     6.49
{txt}corr(u_i, Xb)  = {res}0.0031                         {txt}Prob > F           =    {res}0.0109

{txt}{hline 13}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 1}     Q24_var{col 14}{c |}      Coef.{col 26}   Std. Err.{col 38}      t{col 46}   P>|t|{col 54}     [95% Con{col 67}f. Interval]
{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{space 2}wagegrowth {c |}
{space 9}L2. {c |}{col 14}{res}{space 2}-.1020824{col 26}{space 2} .0400719{col 37}{space 1}   -2.55{col 46}{space 3}0.011{col 54}{space 4}-.1806501{col 67}{space 3}-.0235147
{txt}{space 12} {c |}
{space 7}_cons {c |}{col 14}{res}{space 2} 5.543977{col 26}{space 2} .1291501{col 37}{space 1}   42.93{col 46}{space 3}0.000{col 54}{space 4} 5.290757{col 67}{space 3} 5.797198
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
     sigma_u {c |} {res} 1.1760555
     {txt}sigma_e {c |} {res} 4.8548237
         {txt}rho {c |} {res} .05542976{txt}   (fraction of variance due to u_i)
{hline 13}{c BT}{hline 64}
F test that all u_i=0:     F({res}50{txt}, {res}3367{txt}) = {res}    3.81            {txt}Prob > F = {res}0.0000

{com}. xtreg Q24_var l2.wagegrowth i.date,fe

{txt}Fixed-effects (within) regression               Number of obs      = {res}     3419
{txt}Group variable: {res}statecode                       {txt}Number of groups   = {res}       51

{txt}R-sq:  within  = {res}0.0217                         {txt}Obs per group: min = {res}       35
{txt}       between = {res}0.0010                                        {txt}avg = {res}     67.0
{txt}       overall = {res}0.0201                                        {txt}max = {res}       70

                                                {txt}F({res}70{txt},{res}3298{txt})         = {res}     1.05
{txt}corr(u_i, Xb)  = {res}-0.0114                        {txt}Prob > F           =    {res}0.3756

{txt}{hline 13}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 1}     Q24_var{col 14}{c |}      Coef.{col 26}   Std. Err.{col 38}      t{col 46}   P>|t|{col 54}     [95% Con{col 67}f. Interval]
{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{space 2}wagegrowth {c |}
{space 9}L2. {c |}{col 14}{res}{space 2}-.1911412{col 26}{space 2} .0799645{col 37}{space 1}   -2.39{col 46}{space 3}0.017{col 54}{space 4}-.3479263{col 67}{space 3} -.034356
{txt}{space 12} {c |}
{space 8}date {c |}
{space 8}644  {c |}{col 14}{res}{space 2} 1.505868{col 26}{space 2} 1.030453{col 37}{space 1}    1.46{col 46}{space 3}0.144{col 54}{space 4}-.5145246{col 67}{space 3} 3.526261
{txt}{space 8}645  {c |}{col 14}{res}{space 2} 1.809624{col 26}{space 2} .9880601{col 37}{space 1}    1.83{col 46}{space 3}0.067{col 54}{space 4}-.1276487{col 67}{space 3} 3.746898
{txt}{space 8}646  {c |}{col 14}{res}{space 2} .4848774{col 26}{space 2}   .99754{col 37}{space 1}    0.49{col 46}{space 3}0.627{col 54}{space 4}-1.470983{col 67}{space 3} 2.440738
{txt}{space 8}647  {c |}{col 14}{res}{space 2}-.1883193{col 26}{space 2}  1.00586{col 37}{space 1}   -0.19{col 46}{space 3}0.851{col 54}{space 4}-2.160493{col 67}{space 3} 1.783854
{txt}{space 8}648  {c |}{col 14}{res}{space 2} .9950613{col 26}{space 2}  1.00142{col 37}{space 1}    0.99{col 46}{space 3}0.320{col 54}{space 4}-.9684071{col 67}{space 3}  2.95853
{txt}{space 8}649  {c |}{col 14}{res}{space 2} 1.090515{col 26}{space 2}  1.00586{col 37}{space 1}    1.08{col 46}{space 3}0.278{col 54}{space 4}-.8816587{col 67}{space 3} 3.062689
{txt}{space 8}650  {c |}{col 14}{res}{space 2} .4563488{col 26}{space 2} 1.002306{col 37}{space 1}    0.46{col 46}{space 3}0.649{col 54}{space 4}-1.508857{col 67}{space 3} 2.421554
{txt}{space 8}651  {c |}{col 14}{res}{space 2} .7293524{col 26}{space 2} .9974345{col 37}{space 1}    0.73{col 46}{space 3}0.465{col 54}{space 4}-1.226301{col 67}{space 3} 2.685006
{txt}{space 8}652  {c |}{col 14}{res}{space 2}-.2405351{col 26}{space 2} .9974345{col 37}{space 1}   -0.24{col 46}{space 3}0.809{col 54}{space 4}-2.196189{col 67}{space 3} 1.715118
{txt}{space 8}653  {c |}{col 14}{res}{space 2} .6611128{col 26}{space 2} .9974976{col 37}{space 1}    0.66{col 46}{space 3}0.508{col 54}{space 4}-1.294664{col 67}{space 3}  2.61689
{txt}{space 8}654  {c |}{col 14}{res}{space 2}-.3525425{col 26}{space 2} 1.007935{col 37}{space 1}   -0.35{col 46}{space 3}0.727{col 54}{space 4}-2.328784{col 67}{space 3} 1.623699
{txt}{space 8}655  {c |}{col 14}{res}{space 2} .8006098{col 26}{space 2} 1.002634{col 37}{space 1}    0.80{col 46}{space 3}0.425{col 54}{space 4}-1.165239{col 67}{space 3} 2.766458
{txt}{space 8}656  {c |}{col 14}{res}{space 2}  .376611{col 26}{space 2} .9992228{col 37}{space 1}    0.38{col 46}{space 3}0.706{col 54}{space 4}-1.582549{col 67}{space 3} 2.335771
{txt}{space 8}657  {c |}{col 14}{res}{space 2} .2867827{col 26}{space 2} .9992228{col 37}{space 1}    0.29{col 46}{space 3}0.774{col 54}{space 4}-1.672377{col 67}{space 3} 2.245942
{txt}{space 8}658  {c |}{col 14}{res}{space 2} 1.120236{col 26}{space 2} .9992228{col 37}{space 1}    1.12{col 46}{space 3}0.262{col 54}{space 4}-.8389236{col 67}{space 3} 3.079396
{txt}{space 8}659  {c |}{col 14}{res}{space 2} .2462819{col 26}{space 2} 1.006621{col 37}{space 1}    0.24{col 46}{space 3}0.807{col 54}{space 4}-1.727384{col 67}{space 3} 2.219948
{txt}{space 8}660  {c |}{col 14}{res}{space 2}-.3234044{col 26}{space 2} 1.011637{col 37}{space 1}   -0.32{col 46}{space 3}0.749{col 54}{space 4}-2.306905{col 67}{space 3} 1.660096
{txt}{space 8}661  {c |}{col 14}{res}{space 2} -.260255{col 26}{space 2} 1.016461{col 37}{space 1}   -0.26{col 46}{space 3}0.798{col 54}{space 4}-2.253213{col 67}{space 3} 1.732703
{txt}{space 8}662  {c |}{col 14}{res}{space 2} .2524943{col 26}{space 2} .9975489{col 37}{space 1}    0.25{col 46}{space 3}0.800{col 54}{space 4}-1.703383{col 67}{space 3} 2.208372
{txt}{space 8}663  {c |}{col 14}{res}{space 2} .4608254{col 26}{space 2}    .9926{col 37}{space 1}    0.46{col 46}{space 3}0.642{col 54}{space 4}-1.485349{col 67}{space 3}    2.407
{txt}{space 8}664  {c |}{col 14}{res}{space 2} .0701219{col 26}{space 2} .9975489{col 37}{space 1}    0.07{col 46}{space 3}0.944{col 54}{space 4}-1.885756{col 67}{space 3}    2.026
{txt}{space 8}665  {c |}{col 14}{res}{space 2} .0316942{col 26}{space 2} .9934223{col 37}{space 1}    0.03{col 46}{space 3}0.975{col 54}{space 4}-1.916093{col 67}{space 3} 1.979481
{txt}{space 8}666  {c |}{col 14}{res}{space 2} .0199338{col 26}{space 2} .9934223{col 37}{space 1}    0.02{col 46}{space 3}0.984{col 54}{space 4}-1.927853{col 67}{space 3} 1.967721
{txt}{space 8}667  {c |}{col 14}{res}{space 2} .1763803{col 26}{space 2} .9981294{col 37}{space 1}    0.18{col 46}{space 3}0.860{col 54}{space 4}-1.780636{col 67}{space 3} 2.133396
{txt}{space 8}668  {c |}{col 14}{res}{space 2}-.9071761{col 26}{space 2} .9929897{col 37}{space 1}   -0.91{col 46}{space 3}0.361{col 54}{space 4}-2.854115{col 67}{space 3} 1.039762
{txt}{space 8}669  {c |}{col 14}{res}{space 2}-1.126817{col 26}{space 2}  1.00307{col 37}{space 1}   -1.12{col 46}{space 3}0.261{col 54}{space 4} -3.09352{col 67}{space 3} .8398871
{txt}{space 8}670  {c |}{col 14}{res}{space 2}-.1495214{col 26}{space 2} .9929897{col 37}{space 1}   -0.15{col 46}{space 3}0.880{col 54}{space 4} -2.09646{col 67}{space 3} 1.797417
{txt}{space 8}671  {c |}{col 14}{res}{space 2} .7442131{col 26}{space 2} 1.012087{col 37}{space 1}    0.74{col 46}{space 3}0.462{col 54}{space 4} -1.24017{col 67}{space 3} 2.728596
{txt}{space 8}672  {c |}{col 14}{res}{space 2}-1.021511{col 26}{space 2} 1.007126{col 37}{space 1}   -1.01{col 46}{space 3}0.311{col 54}{space 4}-2.996166{col 67}{space 3} .9531451
{txt}{space 8}673  {c |}{col 14}{res}{space 2}-.2661524{col 26}{space 2} 1.021989{col 37}{space 1}   -0.26{col 46}{space 3}0.795{col 54}{space 4} -2.26995{col 67}{space 3} 1.737645
{txt}{space 8}674  {c |}{col 14}{res}{space 2}-.4081549{col 26}{space 2} 1.019646{col 37}{space 1}   -0.40{col 46}{space 3}0.689{col 54}{space 4}-2.407357{col 67}{space 3} 1.591048
{txt}{space 8}675  {c |}{col 14}{res}{space 2} 1.162702{col 26}{space 2} 1.019588{col 37}{space 1}    1.14{col 46}{space 3}0.254{col 54}{space 4}-.8363869{col 67}{space 3}  3.16179
{txt}{space 8}676  {c |}{col 14}{res}{space 2} .1215793{col 26}{space 2} 1.014425{col 37}{space 1}    0.12{col 46}{space 3}0.905{col 54}{space 4}-1.867388{col 67}{space 3} 2.110546
{txt}{space 8}677  {c |}{col 14}{res}{space 2} .7906361{col 26}{space 2} .9977641{col 37}{space 1}    0.79{col 46}{space 3}0.428{col 54}{space 4}-1.165663{col 67}{space 3} 2.746936
{txt}{space 8}678  {c |}{col 14}{res}{space 2} 2.221094{col 26}{space 2} .9975181{col 37}{space 1}    2.23{col 46}{space 3}0.026{col 54}{space 4} .2652771{col 67}{space 3} 4.176912
{txt}{space 8}679  {c |}{col 14}{res}{space 2} .3379088{col 26}{space 2} .9975181{col 37}{space 1}    0.34{col 46}{space 3}0.735{col 54}{space 4}-1.617909{col 67}{space 3} 2.293726
{txt}{space 8}680  {c |}{col 14}{res}{space 2} .1890616{col 26}{space 2} 1.030061{col 37}{space 1}    0.18{col 46}{space 3}0.854{col 54}{space 4}-1.830561{col 67}{space 3} 2.208684
{txt}{space 8}681  {c |}{col 14}{res}{space 2} 1.222999{col 26}{space 2} 1.037599{col 37}{space 1}    1.18{col 46}{space 3}0.239{col 54}{space 4}-.8114054{col 67}{space 3} 3.257403
{txt}{space 8}682  {c |}{col 14}{res}{space 2} 1.010486{col 26}{space 2}  1.04181{col 37}{space 1}    0.97{col 46}{space 3}0.332{col 54}{space 4}-1.032175{col 67}{space 3} 3.053146
{txt}{space 8}683  {c |}{col 14}{res}{space 2} -.341149{col 26}{space 2} 1.044158{col 37}{space 1}   -0.33{col 46}{space 3}0.744{col 54}{space 4}-2.388412{col 67}{space 3} 1.706114
{txt}{space 8}684  {c |}{col 14}{res}{space 2}  .238663{col 26}{space 2} 1.038189{col 37}{space 1}    0.23{col 46}{space 3}0.818{col 54}{space 4}-1.796897{col 67}{space 3} 2.274223
{txt}{space 8}685  {c |}{col 14}{res}{space 2}-.4920485{col 26}{space 2} 1.038189{col 37}{space 1}   -0.47{col 46}{space 3}0.636{col 54}{space 4}-2.527608{col 67}{space 3} 1.543511
{txt}{space 8}686  {c |}{col 14}{res}{space 2}  1.55689{col 26}{space 2} 1.059415{col 37}{space 1}    1.47{col 46}{space 3}0.142{col 54}{space 4}-.5202868{col 67}{space 3} 3.634067
{txt}{space 8}687  {c |}{col 14}{res}{space 2} 1.103531{col 26}{space 2} 1.059415{col 37}{space 1}    1.04{col 46}{space 3}0.298{col 54}{space 4}-.9736462{col 67}{space 3} 3.180708
{txt}{space 8}688  {c |}{col 14}{res}{space 2} 1.428794{col 26}{space 2} 1.059415{col 37}{space 1}    1.35{col 46}{space 3}0.178{col 54}{space 4} -.648383{col 67}{space 3} 3.505971
{txt}{space 8}689  {c |}{col 14}{res}{space 2} .4156384{col 26}{space 2} 1.000528{col 37}{space 1}    0.42{col 46}{space 3}0.678{col 54}{space 4}-1.546079{col 67}{space 3} 2.377356
{txt}{space 8}690  {c |}{col 14}{res}{space 2}-.1998955{col 26}{space 2} 1.000439{col 37}{space 1}   -0.20{col 46}{space 3}0.842{col 54}{space 4}-2.161441{col 67}{space 3} 1.761649
{txt}{space 8}691  {c |}{col 14}{res}{space 2} .5871635{col 26}{space 2} .9955695{col 37}{space 1}    0.59{col 46}{space 3}0.555{col 54}{space 4}-1.364833{col 67}{space 3}  2.53916
{txt}{space 8}692  {c |}{col 14}{res}{space 2}-.9565873{col 26}{space 2} 1.017877{col 37}{space 1}   -0.94{col 46}{space 3}0.347{col 54}{space 4}-2.952323{col 67}{space 3} 1.039148
{txt}{space 8}693  {c |}{col 14}{res}{space 2}-.9322537{col 26}{space 2} 1.022781{col 37}{space 1}   -0.91{col 46}{space 3}0.362{col 54}{space 4}-2.937604{col 67}{space 3} 1.073096
{txt}{space 8}694  {c |}{col 14}{res}{space 2}-.5263438{col 26}{space 2} 1.017877{col 37}{space 1}   -0.52{col 46}{space 3}0.605{col 54}{space 4}-2.522079{col 67}{space 3} 1.469392
{txt}{space 8}695  {c |}{col 14}{res}{space 2}-.0109857{col 26}{space 2} .9984782{col 37}{space 1}   -0.01{col 46}{space 3}0.991{col 54}{space 4}-1.968685{col 67}{space 3} 1.946714
{txt}{space 8}696  {c |}{col 14}{res}{space 2} .7267627{col 26}{space 2} .9984782{col 37}{space 1}    0.73{col 46}{space 3}0.467{col 54}{space 4}-1.230937{col 67}{space 3} 2.684462
{txt}{space 8}697  {c |}{col 14}{res}{space 2} .3734674{col 26}{space 2} .9984782{col 37}{space 1}    0.37{col 46}{space 3}0.708{col 54}{space 4}-1.584232{col 67}{space 3} 2.331167
{txt}{space 8}698  {c |}{col 14}{res}{space 2} .0083977{col 26}{space 2} 1.002938{col 37}{space 1}    0.01{col 46}{space 3}0.993{col 54}{space 4}-1.958046{col 67}{space 3} 1.974841
{txt}{space 8}699  {c |}{col 14}{res}{space 2} 1.002512{col 26}{space 2} .9979422{col 37}{space 1}    1.00{col 46}{space 3}0.315{col 54}{space 4}-.9541367{col 67}{space 3} 2.959161
{txt}{space 8}700  {c |}{col 14}{res}{space 2} .7874947{col 26}{space 2} 1.002938{col 37}{space 1}    0.79{col 46}{space 3}0.432{col 54}{space 4}-1.178949{col 67}{space 3} 2.753938
{txt}{space 8}701  {c |}{col 14}{res}{space 2} 1.646645{col 26}{space 2} 1.011727{col 37}{space 1}    1.63{col 46}{space 3}0.104{col 54}{space 4}-.3370325{col 67}{space 3} 3.630322
{txt}{space 8}702  {c |}{col 14}{res}{space 2}-.4373208{col 26}{space 2} 1.006288{col 37}{space 1}   -0.43{col 46}{space 3}0.664{col 54}{space 4}-2.410334{col 67}{space 3} 1.535692
{txt}{space 8}703  {c |}{col 14}{res}{space 2}  .142235{col 26}{space 2} 1.006288{col 37}{space 1}    0.14{col 46}{space 3}0.888{col 54}{space 4}-1.830778{col 67}{space 3} 2.115248
{txt}{space 8}704  {c |}{col 14}{res}{space 2}-.2178074{col 26}{space 2} 1.006877{col 37}{space 1}   -0.22{col 46}{space 3}0.829{col 54}{space 4}-2.191975{col 67}{space 3}  1.75636
{txt}{space 8}705  {c |}{col 14}{res}{space 2} .8378895{col 26}{space 2} 1.001647{col 37}{space 1}    0.84{col 46}{space 3}0.403{col 54}{space 4}-1.126022{col 67}{space 3} 2.801802
{txt}{space 8}706  {c |}{col 14}{res}{space 2}  .375682{col 26}{space 2} 1.001765{col 37}{space 1}    0.38{col 46}{space 3}0.708{col 54}{space 4}-1.588462{col 67}{space 3} 2.339826
{txt}{space 8}707  {c |}{col 14}{res}{space 2}-.1117168{col 26}{space 2} 1.008793{col 37}{space 1}   -0.11{col 46}{space 3}0.912{col 54}{space 4}-2.089641{col 67}{space 3} 1.866208
{txt}{space 8}708  {c |}{col 14}{res}{space 2} .1936098{col 26}{space 2} 1.008793{col 37}{space 1}    0.19{col 46}{space 3}0.848{col 54}{space 4}-1.784315{col 67}{space 3} 2.171534
{txt}{space 8}709  {c |}{col 14}{res}{space 2}-.0949988{col 26}{space 2} 1.008793{col 37}{space 1}   -0.09{col 46}{space 3}0.925{col 54}{space 4}-2.072923{col 67}{space 3} 1.882926
{txt}{space 8}710  {c |}{col 14}{res}{space 2}-.0186413{col 26}{space 2} .9987486{col 37}{space 1}   -0.02{col 46}{space 3}0.985{col 54}{space 4}-1.976871{col 67}{space 3} 1.939589
{txt}{space 8}711  {c |}{col 14}{res}{space 2}  -.52429{col 26}{space 2} .9987486{col 37}{space 1}   -0.52{col 46}{space 3}0.600{col 54}{space 4} -2.48252{col 67}{space 3}  1.43394
{txt}{space 8}712  {c |}{col 14}{res}{space 2} .7078219{col 26}{space 2} .9987486{col 37}{space 1}    0.71{col 46}{space 3}0.479{col 54}{space 4}-1.250408{col 67}{space 3} 2.666052
{txt}{space 12} {c |}
{space 7}_cons {c |}{col 14}{res}{space 2} 5.459312{col 26}{space 2} .7337453{col 37}{space 1}    7.44{col 46}{space 3}0.000{col 54}{space 4} 4.020669{col 67}{space 3} 6.897954
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
     sigma_u {c |} {res} 1.1838006
     {txt}sigma_e {c |} {res} 4.8564809
         {txt}rho {c |} {res} .05608499{txt}   (fraction of variance due to u_i)
{hline 13}{c BT}{hline 64}
F test that all u_i=0:     F({res}50{txt}, {res}3298{txt}) = {res}    3.84            {txt}Prob > F = {res}0.0000

{com}. xtreg Q24_iqr l2.wagegrowth i.date,fe

{txt}Fixed-effects (within) regression               Number of obs      = {res}     3433
{txt}Group variable: {res}statecode                       {txt}Number of groups   = {res}       51

{txt}R-sq:  within  = {res}0.0176                         {txt}Obs per group: min = {res}       37
{txt}       between = {res}0.0038                                        {txt}avg = {res}     67.3
{txt}       overall = {res}0.0169                                        {txt}max = {res}       70

                                                {txt}F({res}70{txt},{res}3312{txt})         = {res}     0.85
{txt}corr(u_i, Xb)  = {res}0.0133                         {txt}Prob > F           =    {res}0.8153

{txt}{hline 13}{c TT}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{col 1}     Q24_iqr{col 14}{c |}      Coef.{col 26}   Std. Err.{col 38}      t{col 46}   P>|t|{col 54}     [95% Con{col 67}f. Interval]
{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
{space 2}wagegrowth {c |}
{space 9}L2. {c |}{col 14}{res}{space 2}-.0597059{col 26}{space 2} .0234308{col 37}{space 1}   -2.55{col 46}{space 3}0.011{col 54}{space 4}-.1056463{col 67}{space 3}-.0137656
{txt}{space 12} {c |}
{space 8}date {c |}
{space 8}644  {c |}{col 14}{res}{space 2}  .519515{col 26}{space 2} .3010267{col 37}{space 1}    1.73{col 46}{space 3}0.084{col 54}{space 4}-.0707022{col 67}{space 3} 1.109732
{txt}{space 8}645  {c |}{col 14}{res}{space 2} .4122381{col 26}{space 2} .2903728{col 37}{space 1}    1.42{col 46}{space 3}0.156{col 54}{space 4}-.1570901{col 67}{space 3} .9815664
{txt}{space 8}646  {c |}{col 14}{res}{space 2} .2906952{col 26}{space 2} .2917749{col 37}{space 1}    1.00{col 46}{space 3}0.319{col 54}{space 4}-.2813822{col 67}{space 3} .8627726
{txt}{space 8}647  {c |}{col 14}{res}{space 2} .0186964{col 26}{space 2} .2955925{col 37}{space 1}    0.06{col 46}{space 3}0.950{col 54}{space 4}-.5608661{col 67}{space 3} .5982589
{txt}{space 8}648  {c |}{col 14}{res}{space 2} .1711332{col 26}{space 2} .2942802{col 37}{space 1}    0.58{col 46}{space 3}0.561{col 54}{space 4}-.4058563{col 67}{space 3} .7481228
{txt}{space 8}649  {c |}{col 14}{res}{space 2}  .246396{col 26}{space 2} .2955925{col 37}{space 1}    0.83{col 46}{space 3}0.405{col 54}{space 4}-.3331666{col 67}{space 3} .8259585
{txt}{space 8}650  {c |}{col 14}{res}{space 2} .2504115{col 26}{space 2} .2945505{col 37}{space 1}    0.85{col 46}{space 3}0.395{col 54}{space 4}-.3271079{col 67}{space 3} .8279308
{txt}{space 8}651  {c |}{col 14}{res}{space 2} .0480413{col 26}{space 2}  .293119{col 37}{space 1}    0.16{col 46}{space 3}0.870{col 54}{space 4}-.5266714{col 67}{space 3}  .622754
{txt}{space 8}652  {c |}{col 14}{res}{space 2} .0126596{col 26}{space 2}  .293119{col 37}{space 1}    0.04{col 46}{space 3}0.966{col 54}{space 4}-.5620531{col 67}{space 3} .5873723
{txt}{space 8}653  {c |}{col 14}{res}{space 2}  .211779{col 26}{space 2} .2931481{col 37}{space 1}    0.72{col 46}{space 3}0.470{col 54}{space 4}-.3629908{col 67}{space 3} .7865487
{txt}{space 8}654  {c |}{col 14}{res}{space 2} .0350314{col 26}{space 2} .2946563{col 37}{space 1}    0.12{col 46}{space 3}0.905{col 54}{space 4}-.5426955{col 67}{space 3} .6127583
{txt}{space 8}655  {c |}{col 14}{res}{space 2} .1106467{col 26}{space 2} .2946563{col 37}{space 1}    0.38{col 46}{space 3}0.707{col 54}{space 4}-.4670802{col 67}{space 3} .6883736
{txt}{space 8}656  {c |}{col 14}{res}{space 2} .2324921{col 26}{space 2} .2936494{col 37}{space 1}    0.79{col 46}{space 3}0.429{col 54}{space 4}-.3432606{col 67}{space 3} .8082448
{txt}{space 8}657  {c |}{col 14}{res}{space 2} .2142959{col 26}{space 2} .2936494{col 37}{space 1}    0.73{col 46}{space 3}0.466{col 54}{space 4}-.3614568{col 67}{space 3} .7900486
{txt}{space 8}658  {c |}{col 14}{res}{space 2} .4839906{col 26}{space 2} .2936494{col 37}{space 1}    1.65{col 46}{space 3}0.099{col 54}{space 4}-.0917622{col 67}{space 3} 1.059743
{txt}{space 8}659  {c |}{col 14}{res}{space 2} .2630583{col 26}{space 2}  .294437{col 37}{space 1}    0.89{col 46}{space 3}0.372{col 54}{space 4}-.3142386{col 67}{space 3} .8403553
{txt}{space 8}660  {c |}{col 14}{res}{space 2} .3047796{col 26}{space 2} .2958582{col 37}{space 1}    1.03{col 46}{space 3}0.303{col 54}{space 4}-.2753037{col 67}{space 3}  .884863
{txt}{space 8}661  {c |}{col 14}{res}{space 2} .0668618{col 26}{space 2} .2972228{col 37}{space 1}    0.22{col 46}{space 3}0.822{col 54}{space 4}-.5158972{col 67}{space 3} .6496208
{txt}{space 8}662  {c |}{col 14}{res}{space 2} .2123367{col 26}{space 2} .2931621{col 37}{space 1}    0.72{col 46}{space 3}0.469{col 54}{space 4}-.3624606{col 67}{space 3}  .787134
{txt}{space 8}663  {c |}{col 14}{res}{space 2} .0514792{col 26}{space 2}  .291709{col 37}{space 1}    0.18{col 46}{space 3}0.860{col 54}{space 4}-.5204689{col 67}{space 3} .6234272
{txt}{space 8}664  {c |}{col 14}{res}{space 2} .0790572{col 26}{space 2}  .291709{col 37}{space 1}    0.27{col 46}{space 3}0.786{col 54}{space 4}-.4928909{col 67}{space 3} .6510052
{txt}{space 8}665  {c |}{col 14}{res}{space 2}-.0659774{col 26}{space 2} .2919481{col 37}{space 1}   -0.23{col 46}{space 3}0.821{col 54}{space 4}-.6383944{col 67}{space 3} .5064395
{txt}{space 8}666  {c |}{col 14}{res}{space 2}-.1448683{col 26}{space 2} .2919481{col 37}{space 1}   -0.50{col 46}{space 3}0.620{col 54}{space 4}-.7172852{col 67}{space 3} .4275487
{txt}{space 8}667  {c |}{col 14}{res}{space 2}  .028307{col 26}{space 2} .2933331{col 37}{space 1}    0.10{col 46}{space 3}0.923{col 54}{space 4}-.5468255{col 67}{space 3} .6034395
{txt}{space 8}668  {c |}{col 14}{res}{space 2}-.1912851{col 26}{space 2}  .291822{col 37}{space 1}   -0.66{col 46}{space 3}0.512{col 54}{space 4}-.7634547{col 67}{space 3} .3808846
{txt}{space 8}669  {c |}{col 14}{res}{space 2} .0523049{col 26}{space 2} .2932624{col 37}{space 1}    0.18{col 46}{space 3}0.858{col 54}{space 4} -.522689{col 67}{space 3} .6272987
{txt}{space 8}670  {c |}{col 14}{res}{space 2}  .064154{col 26}{space 2}  .291822{col 37}{space 1}    0.22{col 46}{space 3}0.826{col 54}{space 4}-.5080157{col 67}{space 3} .6363237
{txt}{space 8}671  {c |}{col 14}{res}{space 2}  .043262{col 26}{space 2}  .295949{col 37}{space 1}    0.15{col 46}{space 3}0.884{col 54}{space 4}-.5369994{col 67}{space 3} .6235234
{txt}{space 8}672  {c |}{col 14}{res}{space 2} .0787071{col 26}{space 2}  .295949{col 37}{space 1}    0.27{col 46}{space 3}0.790{col 54}{space 4}-.5015543{col 67}{space 3} .6589685
{txt}{space 8}673  {c |}{col 14}{res}{space 2} .1163062{col 26}{space 2} .2988881{col 37}{space 1}    0.39{col 46}{space 3}0.697{col 54}{space 4}-.4697179{col 67}{space 3} .7023302
{txt}{space 8}674  {c |}{col 14}{res}{space 2}-.2496367{col 26}{space 2} .2996239{col 37}{space 1}   -0.83{col 46}{space 3}0.405{col 54}{space 4}-.8371034{col 67}{space 3}   .33783
{txt}{space 8}675  {c |}{col 14}{res}{space 2}  .074528{col 26}{space 2}   .29809{col 37}{space 1}    0.25{col 46}{space 3}0.803{col 54}{space 4}-.5099313{col 67}{space 3} .6589873
{txt}{space 8}676  {c |}{col 14}{res}{space 2} .1652743{col 26}{space 2}   .29809{col 37}{space 1}    0.55{col 46}{space 3}0.579{col 54}{space 4}-.4191851{col 67}{space 3} .7497336
{txt}{space 8}677  {c |}{col 14}{res}{space 2} .4274768{col 26}{space 2} .2932217{col 37}{space 1}    1.46{col 46}{space 3}0.145{col 54}{space 4}-.1474374{col 67}{space 3} 1.002391
{txt}{space 8}678  {c |}{col 14}{res}{space 2} .6179712{col 26}{space 2} .2917805{col 37}{space 1}    2.12{col 46}{space 3}0.034{col 54}{space 4}  .045883{col 67}{space 3}  1.19006
{txt}{space 8}679  {c |}{col 14}{res}{space 2} .3238033{col 26}{space 2} .2931524{col 37}{space 1}    1.10{col 46}{space 3}0.269{col 54}{space 4}-.2509748{col 67}{space 3} .8985815
{txt}{space 8}680  {c |}{col 14}{res}{space 2} .3224691{col 26}{space 2}  .302668{col 37}{space 1}    1.07{col 46}{space 3}0.287{col 54}{space 4}-.2709661{col 67}{space 3} .9159043
{txt}{space 8}681  {c |}{col 14}{res}{space 2}  .274195{col 26}{space 2} .3048676{col 37}{space 1}    0.90{col 46}{space 3}0.369{col 54}{space 4}-.3235529{col 67}{space 3} .8719429
{txt}{space 8}682  {c |}{col 14}{res}{space 2} .7097001{col 26}{space 2} .3061185{col 37}{space 1}    2.32{col 46}{space 3}0.020{col 54}{space 4} .1094995{col 67}{space 3} 1.309901
{txt}{space 8}683  {c |}{col 14}{res}{space 2}-.0581927{col 26}{space 2} .3067804{col 37}{space 1}   -0.19{col 46}{space 3}0.850{col 54}{space 4} -.659691{col 67}{space 3} .5433055
{txt}{space 8}684  {c |}{col 14}{res}{space 2} .0141047{col 26}{space 2} .3050278{col 37}{space 1}    0.05{col 46}{space 3}0.963{col 54}{space 4}-.5839574{col 67}{space 3} .6121668
{txt}{space 8}685  {c |}{col 14}{res}{space 2} .1537312{col 26}{space 2} .3050278{col 37}{space 1}    0.50{col 46}{space 3}0.614{col 54}{space 4} -.444331{col 67}{space 3} .7517933
{txt}{space 8}686  {c |}{col 14}{res}{space 2}  .515548{col 26}{space 2} .3112473{col 37}{space 1}    1.66{col 46}{space 3}0.098{col 54}{space 4}-.0947085{col 67}{space 3} 1.125804
{txt}{space 8}687  {c |}{col 14}{res}{space 2} .6087697{col 26}{space 2} .3112473{col 37}{space 1}    1.96{col 46}{space 3}0.051{col 54}{space 4}-.0014868{col 67}{space 3} 1.219026
{txt}{space 8}688  {c |}{col 14}{res}{space 2} .4989254{col 26}{space 2} .3112473{col 37}{space 1}    1.60{col 46}{space 3}0.109{col 54}{space 4} -.111331{col 67}{space 3} 1.109182
{txt}{space 8}689  {c |}{col 14}{res}{space 2} .5741294{col 26}{space 2} .2940332{col 37}{space 1}    1.95{col 46}{space 3}0.051{col 54}{space 4}-.0023758{col 67}{space 3} 1.150635
{txt}{space 8}690  {c |}{col 14}{res}{space 2} .3473471{col 26}{space 2} .2925762{col 37}{space 1}    1.19{col 46}{space 3}0.235{col 54}{space 4}-.2263013{col 67}{space 3} .9209956
{txt}{space 8}691  {c |}{col 14}{res}{space 2} .1706863{col 26}{space 2} .2925762{col 37}{space 1}    0.58{col 46}{space 3}0.560{col 54}{space 4}-.4029622{col 67}{space 3} .7443347
{txt}{space 8}692  {c |}{col 14}{res}{space 2} .0776282{col 26}{space 2} .2990861{col 37}{space 1}    0.26{col 46}{space 3}0.795{col 54}{space 4}-.5087841{col 67}{space 3} .6640405
{txt}{space 8}693  {c |}{col 14}{res}{space 2} .0099495{col 26}{space 2} .2990861{col 37}{space 1}    0.03{col 46}{space 3}0.973{col 54}{space 4}-.5764628{col 67}{space 3} .5963618
{txt}{space 8}694  {c |}{col 14}{res}{space 2} .1872324{col 26}{space 2} .2990861{col 37}{space 1}    0.63{col 46}{space 3}0.531{col 54}{space 4}-.3991799{col 67}{space 3} .7736447
{txt}{space 8}695  {c |}{col 14}{res}{space 2}-.0239493{col 26}{space 2} .2934268{col 37}{space 1}   -0.08{col 46}{space 3}0.935{col 54}{space 4}-.5992656{col 67}{space 3}  .551367
{txt}{space 8}696  {c |}{col 14}{res}{space 2} .0511186{col 26}{space 2} .2934268{col 37}{space 1}    0.17{col 46}{space 3}0.862{col 54}{space 4}-.5241977{col 67}{space 3} .6264348
{txt}{space 8}697  {c |}{col 14}{res}{space 2} .1146068{col 26}{space 2} .2934268{col 37}{space 1}    0.39{col 46}{space 3}0.696{col 54}{space 4}-.4607095{col 67}{space 3} .6899231
{txt}{space 8}698  {c |}{col 14}{res}{space 2} .2963721{col 26}{space 2} .2947407{col 37}{space 1}    1.01{col 46}{space 3}0.315{col 54}{space 4}-.2815201{col 67}{space 3} .8742644
{txt}{space 8}699  {c |}{col 14}{res}{space 2} .3046878{col 26}{space 2} .2932701{col 37}{space 1}    1.04{col 46}{space 3}0.299{col 54}{space 4}-.2703212{col 67}{space 3} .8796968
{txt}{space 8}700  {c |}{col 14}{res}{space 2} .2587032{col 26}{space 2} .2947407{col 37}{space 1}    0.88{col 46}{space 3}0.380{col 54}{space 4} -.319189{col 67}{space 3} .8365955
{txt}{space 8}701  {c |}{col 14}{res}{space 2} .3551441{col 26}{space 2} .2973265{col 37}{space 1}    1.19{col 46}{space 3}0.232{col 54}{space 4}-.2278181{col 67}{space 3} .9381063
{txt}{space 8}702  {c |}{col 14}{res}{space 2} .5585558{col 26}{space 2} .2957275{col 37}{space 1}    1.89{col 46}{space 3}0.059{col 54}{space 4}-.0212713{col 67}{space 3} 1.138383
{txt}{space 8}703  {c |}{col 14}{res}{space 2} .3996303{col 26}{space 2} .2957275{col 37}{space 1}    1.35{col 46}{space 3}0.177{col 54}{space 4}-.1801968{col 67}{space 3} .9794575
{txt}{space 8}704  {c |}{col 14}{res}{space 2} .1744667{col 26}{space 2} .2958998{col 37}{space 1}    0.59{col 46}{space 3}0.555{col 54}{space 4}-.4056984{col 67}{space 3} .7546318
{txt}{space 8}705  {c |}{col 14}{res}{space 2} .3168498{col 26}{space 2} .2943628{col 37}{space 1}    1.08{col 46}{space 3}0.282{col 54}{space 4}-.2603017{col 67}{space 3} .8940012
{txt}{space 8}706  {c |}{col 14}{res}{space 2} .3480598{col 26}{space 2} .2943936{col 37}{space 1}    1.18{col 46}{space 3}0.237{col 54}{space 4} -.229152{col 67}{space 3} .9252715
{txt}{space 8}707  {c |}{col 14}{res}{space 2} .0690381{col 26}{space 2} .2964545{col 37}{space 1}    0.23{col 46}{space 3}0.816{col 54}{space 4}-.5122144{col 67}{space 3} .6502906
{txt}{space 8}708  {c |}{col 14}{res}{space 2} .2154429{col 26}{space 2} .2964545{col 37}{space 1}    0.73{col 46}{space 3}0.467{col 54}{space 4}-.3658097{col 67}{space 3} .7966954
{txt}{space 8}709  {c |}{col 14}{res}{space 2} .1962433{col 26}{space 2} .2964545{col 37}{space 1}    0.66{col 46}{space 3}0.508{col 54}{space 4}-.3850092{col 67}{space 3} .7774958
{txt}{space 8}710  {c |}{col 14}{res}{space 2} .2914867{col 26}{space 2} .2935114{col 37}{space 1}    0.99{col 46}{space 3}0.321{col 54}{space 4}-.2839954{col 67}{space 3} .8669687
{txt}{space 8}711  {c |}{col 14}{res}{space 2} .2250931{col 26}{space 2} .2935114{col 37}{space 1}    0.77{col 46}{space 3}0.443{col 54}{space 4} -.350389{col 67}{space 3} .8005751
{txt}{space 8}712  {c |}{col 14}{res}{space 2} .1698927{col 26}{space 2} .2935114{col 37}{space 1}    0.58{col 46}{space 3}0.563{col 54}{space 4}-.4055893{col 67}{space 3} .7453748
{txt}{space 12} {c |}
{space 7}_cons {c |}{col 14}{res}{space 2}  2.96634{col 26}{space 2} .2156038{col 37}{space 1}   13.76{col 46}{space 3}0.000{col 54}{space 4}  2.54361{col 67}{space 3} 3.389071
{txt}{hline 13}{c +}{hline 11}{hline 11}{hline 9}{hline 8}{hline 13}{hline 12}
     sigma_u {c |} {res} .58171259
     {txt}sigma_e {c |} {res} 1.4272459
         {txt}rho {c |} {res} .14245459{txt}   (fraction of variance due to u_i)
{hline 13}{c BT}{hline 64}
F test that all u_i=0:     F({res}50{txt}, {res}3312{txt}) = {res}    9.81            {txt}Prob > F = {res}0.0000

{com}. clear

. do "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/DoFile/Step04_PopSCEAnalysis.do"
{txt}
{com}. clear
{txt}
{com}. global mainfolder "/Users/Myworld/Dropbox/IncExpProject/WorkingFolder"
{txt}
{com}. global folder "${c -(}mainfolder{c )-}/SurveyData/"
{txt}
{com}. global sum_graph_folder "${c -(}mainfolder{c )-}/Graphs/pop"
{txt}
{com}. global sum_table_folder "${c -(}mainfolder{c )-}/Tables"
{txt}
{com}. 
. cd ${c -(}folder{c )-}
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. pwd
{res}/Users/Myworld/Dropbox/IncExpProject/WorkingFolder/SurveyData
{txt}
{com}. set more off 
{txt}
{com}. capture log close
{smcl}
{com}{sf}{ul off}